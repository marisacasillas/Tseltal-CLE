)
View(seg.info)
aclew2child_id <- all.data %>%
select(aclew_id, child_id) %>%
distinct()
aclew2child_id
View(aclew2child_id)
all.clips <- expand.grid(
aclew_id = unique(ptcp.info$aclew_id),
segment_num = c(1:9),
tier = c("CHI", "OTR")) %>%
full_join(aclew2child_id)
all.clips <- expand.grid(
aclew_id = unique(ptcp.info$aclew_id),
segment_num = c(1:9),
tier = c("CHI", "OTR")) %>%
full_join(aclew2child_id, by = "aclew_id")
View(all.clips)
seg.lvl.summary <- all.data %>%
filter(tier == "OTR" | tier == "CHI") %>%
group_by(child_id, tier, segment_num, seg_start_tod) %>%
summarize(
tot.spch.min = sum(dur)/60000,
min.p.hr = tot.spch.min*12
) %>%
full_join(all.clips, by = c("segment_num", "aclew_id", "tier")) %>%
left_join(ptcp.info, by = c("aclew_id" = "lab_internal_subject_id"))
seg.lvl.summary <- all.data %>%
filter(tier == "OTR" | tier == "CHI") %>%
group_by(child_id, tier, segment_num, seg_start_tod) %>%
summarize(
tot.spch.min = sum(dur)/60000,
min.p.hr = tot.spch.min*12
)
unique(seg.lvl.summary$child_id)
length(unique(seg.lvl.summary$child_id))
length(unique(all.clips$child_id))
unique(all.clips$child_id)
all.clips <- expand.grid(
aclew_id = unique(ptcp.info$aclew_id),
segment_num = c(1:9),
tier = c("CHI", "OTR")) %>%
full_join(aclew2child_id, by = "aclew_id") %>%
filter(!is.na(child_id))
# Create summaries, adding in zeroes for annotated clips with no speech
# ... at the clip level and
seg.lvl.summary <- all.data %>%
filter(tier == "OTR" | tier == "CHI") %>%
group_by(child_id, tier, segment_num, seg_start_tod) %>%
summarize(
tot.spch.min = sum(dur)/60000,
min.p.hr = tot.spch.min*12
) %>%
full_join(all.clips, by = c("segment_num", "aclew_id", "tier")) %>%
left_join(ptcp.info, by = c("aclew_id" = "lab_internal_subject_id")) %>%
left_join(seg.info, by = c("child_id", "seg_start_tod", "segment_num")) %>%
replace_na(list(tot.spch.min = 0, min.p.hr = 0)) %>%
arrange(aclew_id, tier, segment_num)
# ... at the clip level and
seg.lvl.summary <- all.data %>%
filter(tier == "OTR" | tier == "CHI") %>%
group_by(child_id, tier, segment_num, seg_start_tod) %>%
summarize(
tot.spch.min = sum(dur)/60000,
min.p.hr = tot.spch.min*12
) %>%
full_join(all.clips, by = c("segment_num", "child_id", "tier")) %>%
left_join(ptcp.info, by = c("aclew_id" = "lab_internal_subject_id")) %>%
left_join(seg.info, by = c("child_id", "seg_start_tod", "segment_num")) %>%
replace_na(list(tot.spch.min = 0, min.p.hr = 0)) %>%
arrange(aclew_id, tier, segment_num)
# ... then with averages across clips at the recording level
rec.lvl.summary <- seg.lvl.summary %>%
group_by(child_id, tier) %>%
summarize(
mean.mph = mean(min.p.hr),
median.mph = median(min.p.hr),
min.mph = min(min.p.hr),
max.mph = max(min.p.hr),
sd.mph = sd(min.p.hr)
) %>%
left_join(ptcp.info, by = c("child_id" = "lab_internal_subject_id"))
rec.lvl.summary.otr <- subset(rec.lvl.summary, tier == "OTR")
mean.tph <- mean(rec.lvl.summary.otr$mean.mph)
median.tph <- median(rec.lvl.summary.otr$median.mph)
mean.median.tph <- mean(rec.lvl.summary.otr$median.mph)
min.tph <- min(rec.lvl.summary.otr$mean.mph)
max.tph <- max(rec.lvl.summary.otr$mean.mph)
mean.tph
median.tph
mean.median.tph
min.tph
max.tph
ggplot(data = seg.lvl.summary,
aes(x = min.p.hr)) +
facet_grid(~ tier) +
geom_histogram()
ggplot(data = seg.lvl.summary,
aes(x = age_mo_round, y = min.p.hr, color = aclew_id)) +
facet_grid(~ tier) +
geom_smooth(method = "lm", color = "gray") +
geom_boxplot(outlier.fill = NA) +
geom_jitter() +
scale_x_continuous(limits = c(0,40)) +
scale_y_continuous(limits = c(0,30)) + # cuts off a few clear outliers
# scale_y_continuous(limits = c(0,60)) +
labs(x = "Age (months)", y = "TCDS min/hr") +
guides(color = "none") +
theme_apa()
ggplot(data = seg.lvl.summary,
aes(x = age_mo_round, y = min.p.hr, color = aclew_id)) +
facet_grid(~ tier) +
geom_smooth(method = "lm", color = "gray") +
geom_boxplot(outlier.fill = NA) +
geom_jitter() +
scale_x_continuous(limits = c(0,40)) +
scale_y_continuous(limits = c(0,30)) + # cuts off a few clear outliers
# scale_y_continuous(limits = c(0,60)) +
labs(x = "Age (months)", y = "TCDS min/hr") +
guides(color = "none") +
theme_apa()
ggplot(data = seg.lvl.summary,
aes(x = age_mo_round, y = min.p.hr, color = aclew_id)) +
facet_grid(~ tier)
ggplot(data = seg.lvl.summary,
aes(x = age_mo_round, y = min.p.hr, color = aclew_id)) +
facet_grid(~ tier) +
geom_smooth(method = "lm", color = "gray")
ggplot(data = seg.lvl.summary,
aes(x = age_mo_round, y = min.p.hr, color = aclew_id)) +
facet_grid(~ tier) +
# geom_smooth(method = "lm", color = "gray") +
geom_boxplot(outlier.fill = NA)
seg.lvl.summary$age_mo_round
seg.lvl.summary <- all.data %>%
filter(tier == "OTR" | tier == "CHI") %>%
group_by(child_id, tier, segment_num, seg_start_tod) %>%
summarize(
tot.spch.min = sum(dur)/60000,
min.p.hr = tot.spch.min*12
) %>%
full_join(all.clips, by = c("segment_num", "child_id", "tier"))
seg.lvl.summary <- all.data %>%
filter(tier == "OTR" | tier == "CHI") %>%
group_by(child_id, tier, segment_num, seg_start_tod) %>%
summarize(
tot.spch.min = sum(dur)/60000,
min.p.hr = tot.spch.min*12
) %>%
full_join(all.clips, by = c("segment_num", "child_id", "tier")) %>%
left_join(ptcp.info)
seg.lvl.summary <- all.data %>%
filter(tier == "OTR" | tier == "CHI") %>%
group_by(child_id, tier, segment_num, seg_start_tod) %>%
summarize(
tot.spch.min = sum(dur)/60000,
min.p.hr = tot.spch.min*12
) %>%
full_join(all.clips, by = c("segment_num", "child_id", "tier")) %>%
left_join(ptcp.info, by = "aclew_id") %>%
left_join(seg.info)
# Create summaries, adding in zeroes for annotated clips with no speech
# ... at the clip level and
seg.lvl.summary <- all.data %>%
filter(tier == "OTR" | tier == "CHI") %>%
group_by(child_id, tier, segment_num, seg_start_tod) %>%
summarize(
tot.spch.min = sum(dur)/60000,
min.p.hr = tot.spch.min*12
) %>%
full_join(all.clips, by = c("segment_num", "child_id", "tier")) %>%
left_join(ptcp.info, by = "aclew_id") %>%
left_join(seg.info, by = c("child_id", "seg_start_tod", "segment_num")) %>%
replace_na(list(tot.spch.min = 0, min.p.hr = 0)) %>%
arrange(aclew_id, tier, segment_num)
# ... then with averages across clips at the recording level
rec.lvl.summary <- seg.lvl.summary %>%
group_by(child_id, tier) %>%
summarize(
mean.mph = mean(min.p.hr),
median.mph = median(min.p.hr),
min.mph = min(min.p.hr),
max.mph = max(min.p.hr),
sd.mph = sd(min.p.hr)
) %>%
left_join(ptcp.info, by = c("child_id" = "lab_internal_subject_id"))
rec.lvl.summary.otr <- subset(rec.lvl.summary, tier == "OTR")
mean.tph <- mean(rec.lvl.summary.otr$mean.mph)
median.tph <- median(rec.lvl.summary.otr$median.mph)
mean.median.tph <- mean(rec.lvl.summary.otr$median.mph)
min.tph <- min(rec.lvl.summary.otr$mean.mph)
max.tph <- max(rec.lvl.summary.otr$mean.mph)
ggplot(data = seg.lvl.summary,
aes(x = min.p.hr)) +
facet_grid(~ tier) +
geom_histogram()
ggplot(data = seg.lvl.summary,
aes(x = age_mo_round, y = min.p.hr, color = aclew_id)) +
facet_grid(~ tier) +
geom_smooth(method = "lm", color = "gray") +
geom_boxplot(outlier.fill = NA) +
geom_jitter() +
scale_x_continuous(limits = c(0,40)) +
scale_y_continuous(limits = c(0,30)) + # cuts off a few clear outliers
# scale_y_continuous(limits = c(0,60)) +
labs(x = "Age (months)", y = "TCDS min/hr") +
guides(color = "none") +
theme_apa()
ggplot(data = seg.lvl.summary,
aes(x = age_mo_round, y = min.p.hr, color = aclew_id)) +
facet_grid(~ tier) +
geom_smooth(method = "lm", color = "gray") +
geom_boxplot(outlier.fill = NA) +
geom_jitter() +
scale_x_continuous(limits = c(0,40),
breaks = seq(0,40,5)) +
scale_y_continuous(limits = c(0,30),
breaks = seq(0,30,5)) + # cuts off a few clear outliers
# scale_y_continuous(limits = c(0,60),
# breaks = seq(0,60,5)) +
coord_cartesian(xlim = c(0,40), ylim = c(0,30)) +
labs(x = "Age (months)", y = "TCDS min/hr") +
guides(color = "none") +
theme_apa()
all.spch.mph.plot <- ggplot(data = seg.lvl.summary,
aes(x = age_mo_round, y = min.p.hr, color = aclew_id)) +
facet_grid(~ tier) +
geom_smooth(method = "lm", color = "gray") +
geom_boxplot(outlier.fill = NA) +
geom_jitter() +
scale_x_continuous(limits = c(0,40),
breaks = seq(0,40,5)) +
scale_y_continuous(limits = c(0,30),
breaks = seq(0,30,5)) + # cuts off a few clear outliers
# scale_y_continuous(limits = c(0,60),
# breaks = seq(0,60,5)) +
coord_cartesian(xlim = c(0,40), ylim = c(0,30)) +
labs(x = "Age (months)", y = "min/hr") +
guides(color = "none") +
theme_apa()
all.spch.mph.plot
otr.m <- lmer(min.p.hr ~
age_mo_round * mat_ed + (1|child_id),
data = subset(seg.lvl.summary, tier == "OTR"))
tcds.random.distribution <- ggplot(seg.lvl.summary,
aes(round(min.p.hr,0))) +
geom_histogram(binwidth = 2) +
ylab("# of clips") +
xlab ("TCDS min/hr") +
basic.theme
tcds.random.distribution
## TCDS ####
tcds.random.distribution <- ggplot(subset(seg.lvl.summary, tier == "OTR"),
aes(round(min.p.hr,0))) +
geom_histogram(binwidth = 2) +
ylab("# of clips") +
xlab ("TCDS min/hr") +
basic.theme
tcds.random.distribution''
tcds.random.distribution
sd(round(subset(seg.lvl.summary, tier == "OTR")$min.p.hr,0))^2
mean(round(subset(seg.lvl.summary, tier == "OTR")$min.p.hr,0))
#sd(round(subset(seg.lvl.summary, tier == "OTR")$min.p.hr,0))^2
#mean(round(subset(seg.lvl.summary, tier == "OTR")$min.p.hr,0))
# mean is much smaller than variance
tds.rand.zinb <- glmmTMB(round(min.p.hr,0) ~
age_mo_round *
mat_ed +
(1|child_id),
data=subset(seg.lvl.summary, tier == "OTR"),
ziformula=~age_mo_round,
family="nbinom1")
unique(seg.lvl.summary$child_id)
ptcp.info <- read_csv(ptcp.info.file, col_types = cols())
library(papaja)
library(ggplot2)
library(tidyverse)
library(viridis)
library(grid)
library(gridExtra)
library(lme4)
library(glmmTMB)
library(DHARMa)
# library(bbmle)
library(broom.mixed)
source("../0-Helper.R")
library(ggpubr)
plot.path <- "plots/"
clip.dur.min <- 5
# Read in utterance data and metadata
utt.info <- read_csv("all.CHI.OTR.utterances.csv")
# Read in utterance data and metadata
utt.info <- read_csv("all.CHI.OTR.utterances.csv")
clip.info <- read_csv("all.annotated.clips.csv")
rec.info <- read_csv("metadata/rec-metadata.csv") %>%
filter(source != "ACLEW") %>%
select(recording, age, sex, aclew_id)
# Create full matrix of annotated clips for CHI and OTR tiers
all.clips.CHIOTR.tiers <- bind_rows(
mutate(clip.info, tier.name = "CHI"),
mutate(clip.info, tier.name = "OTR")
)
r1 <- read_csv("metadata/rec-metadata.csv")
r1
m1 <- read_csv("metadata/ACLEW_list_of_corpora.csv")
m1
m1 <- select(m1, c(lab_internal_subject_id, mat_ed, number_older_sibs, mother_dob, household_size))
m1
r2 <- left_join(r1, m1)
r2 <- left_join(r1, m1, by = ("recording" = "lab_internal_subject_id", "mot_edu" = "mat_ed", "mot_age" = "mother_dob", "n_oldersibs" = "number_older_sibs", "n_hshld" = "household_size"))
r2 <-  r1 %>% left_join(m1, by = c("recording" = "lab_internal_subject_id", "mot_edu" = "mat_ed", "mot_age" = "mother_dob", "n_oldersibs" = "number_older_sibs", "n_hshld" = "household_size"))
View)r2
View(r2)
names(r1)
r2 <-  r1 %>% left_join(m1, by = c("recording" = "lab_internal_subject_id", "mot_edu" = "mat_ed") %>% View()
r2 <-  r1 %>% left_join(m1, by = c("recording" = "lab_internal_subject_id", "mot_edu" = "mat_ed")) %>% View()
r1$recording
m1$lab_internal_subject_id
View(r1)
r2 <-  r1 %>% left_join(m1, by = c("recording" = "lab_internal_subject_id", "mot_edu" = "mat_ed")) %>% View()
r1 %>% left_join(m1, by = c("lab_internal_subject_id" = "recording"))
r2 <-  r1 %>% left_join(m1, by = c("recording" = "lab_internal_subject_id")) %>% View()
rec.info <- read_csv("metadata/rec-metadata.csv") %>% left_join(m1, by = c("recording" = "lab_internal_subject_id"))
View(rec.info)
write_csv(rec.info, "rec.info.new.csv")
# Read in utterance data and metadata
utt.info <- read_csv("all.CHI.OTR.utterances.csv")
clip.info <- read_csv("all.annotated.clips.csv")
rec.info <- read_csv("metadata/rec-metadata.csv") %>%
filter(source != "ACLEW") %>%
select(recording, age, sex, aclew_id)
View(read_csv("metadata/rec-metadata.csv") %>%
filter(source != "ACLEW"))
rec.info <- read_csv("metadata/rec-metadata.csv") %>%
filter(source != "ACLEW") %>%
select(recording, age, sex,
mat_ed, number_older_sibs, mother_dob, household_size, aclew_id)
# Create full matrix of annotated clips for CHI and OTR tiers
all.clips.CHIOTR.tiers <- bind_rows(
mutate(clip.info, tier.name = "CHI"),
mutate(clip.info, tier.name = "OTR")
)
# Compute ptcp info standards
rec.info.stds <- rec.info %>%
mutate(
tchiyr.m = mean(age),
motyr.m = mean(mother_dob),
nsb.m = mean(number_older_sibs),
hsz.m = mean(household_size),
tchiyr.sd = sd(age),
motyr.sd = sd(mother_age),
nsb.sd = sd(number_older_sibs),
hsz.sd = sd(household_size),
tchiyr.std = ((age - tchiyr.m)/tchiyr.sd),
chisx.std = recode_factor(
sex, "M" = "M", "F" = "F"),
)
# Compute ptcp info standards
rec.info.stds <- rec.info %>%
mutate(
tchiyr.m = mean(age),
motyr.m = mean(mother_dob),
nsb.m = mean(number_older_sibs),
hsz.m = mean(household_size),
tchiyr.sd = sd(age),
motyr.sd = sd(mother_dob),
nsb.sd = sd(number_older_sibs),
hsz.sd = sd(household_size),
tchiyr.std = ((age - tchiyr.m)/tchiyr.sd),
chisx.std = recode_factor(
sex, "M" = "M", "F" = "F"),
)
mother_dob
rec.info.stds
View(rec.info.stds)
60/clip.dur.min
# Create summaries, adding in zeroes for annotated clips with no speech
# ... at the clip level and
clip.summary <- utt.info %>%
group_by(recording, tier.name, clip.onset) %>%
summarize(
tot.spch.min = sum(dur.sec)/60,
min.p.hr = tot.spch.min*(60/clip.dur.min)
) %>%
full_join(all.clips.CHIOTR.tiers,
by = c("recording", "tier.name", "clip.onset")) %>%
full_join(rec.info.stds, by = "recording") %>%
replace_na(list(tot.spch.min = 0, min.p.hr = 0)) %>%
arrange(aclew_id, tier.name, segment.num) %>%
# add non-zero marker
mutate(
nz.spch = ifelse(min.p.hr > 0, 1, 0)
) %>%
# add standardized/recoded predictors
mutate(
mated.std = recode_factor(mat_ed,
"none" = "none",
"primary" = "primary",
"secondary" = "secondary",
"preparatory" = "preparatory"),
mated.bin = recode_factor(mat_ed,
"none" = "0-5", "primary" = "0-5",
"secondary" = "6+", "preparatory" = "6+"),
motyr.std = ((mother_dob - motyr.m)/motyr.sd),
nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
hsz.std = ((household_size - hsz.m)/hsz.sd)#,
#   stthr.std = (start.hr - 12)/12,
#   stthr.tri = ifelse(start.hr < 11, "morning",
#                      ifelse(start.hr > 13, "afternoon", "midday"))
)
View(clip.summary)
clip.summary <- utt.info %>%
group_by(recording, tier.name, clip.onset) %>%
summarize(
tot.spch.min = sum(dur.sec)/60,
min.p.hr = tot.spch.min*(60/clip.dur.min)
) %>%
full_join(all.clips.CHIOTR.tiers,
by = c("recording", "tier.name", "clip.onset")) %>%
full_join(rec.info.stds, by = "recording") %>%
replace_na(list(tot.spch.min = 0, min.p.hr = 0)) %>%
arrange(aclew_id, tier.name, segment.num) %>%
# add non-zero marker
mutate(
nz.spch = ifelse(min.p.hr > 0, 1, 0)
)
# Create summaries, adding in zeroes for annotated clips with no speech
# ... at the clip level and
clip.summary <- utt.info %>%
group_by(recording, tier.name, clip.onset) %>%
summarize(
tot.spch.min = sum(dur.sec)/60,
min.p.hr = tot.spch.min*(60/clip.dur.min)
) %>%
full_join(all.clips.CHIOTR.tiers,
by = c("recording", "tier.name", "clip.onset")) %>%
full_join(rec.info.stds, by = "recording") %>%
replace_na(list(tot.spch.min = 0, min.p.hr = 0)) %>%
arrange(aclew_id, tier.name, segment.num) %>%
# add non-zero marker
mutate(
nz.spch = ifelse(min.p.hr > 0, 1, 0)
) %>%
# add standardized/recoded predictors
mutate(
mated.std = recode_factor(mat_ed,
"none" = "none",
"primary" = "primary",
"secondary" = "secondary",
"preparatory" = "preparatory"),
mated.bin = recode_factor(mat_ed,
"none" = "0-5", "primary" = "0-5",
"secondary" = "6+", "preparatory" = "6+"),
motyr.std = ((mother_dob - motyr.m)/motyr.sd),
nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
hsz.std = ((household_size - hsz.m)/hsz.sd)#,
#   stthr.std = (start.hr - 12)/12,
#   stthr.tri = ifelse(start.hr < 11, "morning",
#                      ifelse(start.hr > 13, "afternoon", "midday"))
)
range(clip.summary$clip.onset)
# ... then with averages across clips at the recording level
rec.summary <- clip.summary %>%
group_by(aclew_id, tier.name,
mated.std, mated.bin, motyr.std, nsb.std, hsz.std) %>%
summarize(
mean.mph = mean(min.p.hr),
median.mph = median(min.p.hr),
min.mph = min(min.p.hr),
max.mph = max(min.p.hr),
sd.mph = sd(min.p.hr),
total.clips = n()
) %>%
left_join(rec.info.stds, by = "aclew_id")
View(rec.summary)
# corr btwn OTR and CHI at clip and recording levels
clip.CHI.OTR.rates <- clip.summary %>%
select(-tot.spch.min, -nz.spch) %>%
pivot_wider(names_from = "tier.name", values_from = "min.p.hr")
rec.CHI.OTR.rates <- rec.summary %>%
select(-median.mph, -min.mph, -max.mph, -sd.mph, -total.clips) %>%
pivot_wider(names_from = "tier.name", values_from = "mean.mph")
OTR.mean <- mean(rec.CHI.OTR.rates$OTR)
OTR.sd <- sd(rec.CHI.OTR.rates$OTR)
rec.CHI.OTR.rates <- rec.CHI.OTR.rates %>%
mutate(
Tertile = factor(case_when(
OTR <= OTR.mean - OTR.sd ~ "low TCDS",
OTR >= OTR.mean + OTR.sd ~ "high TCDS",
TRUE ~ "middle TCDS"
), levels = c("low TCDS", "middle TCDS", "high TCDS"))
)
View(clip.CHI.OTR.rates)
View(rec.CHI.OTR.rates)
OTR.mean <- mean(rec.CHI.OTR.rates$OTR)
OTR.sd <- sd(rec.CHI.OTR.rates$OTR)
rec.CHI.OTR.rates <- rec.CHI.OTR.rates %>%
mutate(
Tertile = factor(case_when(
OTR <= OTR.mean - OTR.sd ~ "low TCDS",
OTR >= OTR.mean + OTR.sd ~ "high TCDS",
TRUE ~ "middle TCDS"
), levels = c("low TCDS", "middle TCDS", "high TCDS"))
)
rec.summary.otr <- subset(rec.summary, tier.name == "OTR")
mean.tph <- mean(rec.summary.otr$mean.mph)
median.tph <- median(rec.summary.otr$median.mph)
mean.median.tph <- mean(rec.summary.otr$median.mph)
min.tph <- min(rec.summary.otr$mean.mph)
max.tph <- max(rec.summary.otr$mean.mph)
mean.tph
mean.median.tph
