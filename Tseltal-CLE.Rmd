---
title             : "Early language experience in a Tseltal Mayan village"
shorttitle        : "Early language experience in a Tseltal Mayan village"

author: 
  - name          : "Marisa Casillas"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "P.O. Box 310, 6500 AH Nijmegen, The Netherlands"
    email         : "Marisa.Casillas@mpi.nl"
  - name          : "Penelope Brown"
    affiliation   : "1"
  - name          : "Stephen C. Levinson"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "Max Planck Institute for Psycholinguistics"
#  - id            : "2"
#    institution   : "Cambridge University"

#author_note: |
#  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

abstract: |
  Daylong at-home audio recordings from 10 Tseltal Mayan children (0;2–3;0) were analyzed for how often children engaged in verbal interaction with others and whether their speech environment changed with age, time of day, household size, and number of speakers present. Tseltal children were infrequently directly spoken to, with most directed speech coming from adults, and no increase with age. Most directed speech came in the mornings or afternoons, and interactional peaks took the form of ~1-minute bursts of turn taking. An initial analysis of children’s vocal development suggested that, despite relatively little directed speech, Tseltal children develop early language skills on a similar timescale to Western children. Multiple proposals for how Tseltal children might learn language efficiently are discussed.

keywords          : "Child-directed speech, linguistic input, non-WEIRD, vocal maturity, turn taking, interaction, Mayan"
wordcount         : "10225 (8549 not including references)"

bibliography      : ["Tseltal-CLE.bib"]

figsintext        : yes
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : yes
mask              : no

class             : "man"
output            : papaja::apa6_pdf
---

<!--
Revision checklist
- intro
  - get rid of direct equivalency argument
    - "[we should expect] onsets of some basic language measures such as first words or combining words at reasonable ages" & "Mayan children sampled in this study showed patterns of language emergence or onset times that crudely align with what is seen in other samples"
  - find a new way to talk about theoretical implications
  - justify vocal maturity measure
    - focus on milestones beyond babbling
    - make predictions for each bit separately
  - justify time of day more: "what should be made of the description of hours in the day when children were most likely to be exposed to speech?"
  - clarify: “linguistic evidence to support first language acquisition”
- methods
  - be clearer about how/why these data were chosen ("to ask about the age-related changes in language input")
  - briefly describe how long it takes
  - add information about infant age estimates
- results
  - pare down to TCDS/ODS and vocal maturity
    - make sure figures are tables are clearly explained
  - add pointer to CBR data (Cychosz et al) and voc rate for other kids
- discussion
  - get rid of direct equivalency argument
    - be more specific when talking about 'robustness' (or don't use it); reviewer points out that it doesn't apply to volubility
  - mention that onset != usage
    - we need more detailed measures of phonological, lexical, and syntactic growth to better understand the input effect in Tseltal >> still to come
- appendices
  - add more context where it might be critically helpful
- abstract (do last!!)
  - update in-line with other changes
-->

```{r load_packages, include=FALSE, echo=FALSE, warning=FALSE}
library(papaja)
library(ggplot2)
library(tidyverse)
library(viridis)
library(grid)
library(gridExtra)
library(ggpirate)
library(lme4)
library(glmmTMB)
library(DHARMa)
library(bbmle)
library(broom.mixed)
source("0-Helper.R")
```

```{r analysis_presets, include=FALSE}
options(scipen=999)
data.path <- "transcripts/anon/" # text files exported from ELAN
metadata.path <- "metadata/"
plot.path <- "plots/" # output plots
shiny.input.path <- "shiny_input/"
shiny.input.img.path <- "www/"
seg.index.file <- paste0(metadata.path, "Segment-order-inventory.csv")
ptcp.info.file <- paste0(metadata.path, "recording-info.csv")
comparison.file <- paste0(metadata.path, "comparison_studies.csv")
samplelabels <- c("High activity  ", "Random  ")
col.sample.bu <- list(
  scale_fill_manual(labels=samplelabels, values=viridis(2)),
  scale_color_manual(labels=samplelabels, values=viridis(2)))
col.sample.bu3 <- list(
  scale_fill_manual(labels=samplelabels, values=viridis(3)),
  scale_color_manual(labels=samplelabels, values=viridis(3)))
allowed.overlap <- 1000 #ms
allowed.gap <- 2000 #ms
waking.hours <- 14
```

# Introduction {#intro}
A great deal of work in developmental language science revolves around one central question: what kind of linguistic experience (and how much) is needed to support first language acquisition? In pursuing this topic, many researchers have fixed their sights on the speech addressed to children. In several languages, child-directed speech (CDS, speech designed for and directed toward a child recipient) has been demonstrated to be distinct from adult-directed speech (ADS) in that it is linguistically adapted for young listeners [e.g., @soderstrom2007beyond], interactionally rich [@bruner1983childs], preferred by infants [@manybabies2017], and facilitates early word learning [@cartmill2013quality; @hoff2003specificity; @rowe2008child; @weisleder2013talking]. Due in part to its strong positive association with vocabulary size---a linguistic skill with economic value in modern post-industrial societies---CDS has also gained significant attention as a tool for 'successful' language development [REFS].

Outside of these contexts, however, the role of CDS in typical language development is less clear. In any given linguistic community, the vast majority of children acquire the linguistic system and language behaviors needed for successful communication in the context in which they are raised [REFS]. In many cases these cultural-linguistic contexts emphasize aspects of linguistic competence other than vocabulary size [@ochs1984language], undermining the idea that CDS is a universally crucial aspect of first language development. Indeed, prior ethnographic work suggests that, in many of the world's communities, successful adult-like communicative competence is typically achieved without frequent CDS [@brown2011cultural; @deleon2011language; @gaskins2006cultural; @ochs1984language]. If so, two important considerations arise: (1) while CDS is a powerful driver of learning in some contexts, it is unlikely to be universally fundamental for typical language development [@brown2014interactional; @brown2014language], and (2) we should do more to explore other types of linguistic experience and other features of the learning environment that allow children to extract the information they need to learn language.

Past work on child language development in communities with reportedly infrequent CDS [e.g., @brown2011cultural; @deleon2011language; @gaskins2006cultural; @ochs1984language] has tended to use rich linguistic and ethnographic methods that, while well-suited to characterizing language socialization, lack the kind of quantitative rigor that would otherwise enable reproducible results derived from reasonably representative participant samples [but see @shneidman2012language]. For this reason, work that applies methods from developmental language science in diverse ethnolinguistic contexts will be key to developing more robust cognitive theories of language learning. In this paper we investigate the language environment and early vocal development of 10 Tseltal Mayan children growing up in a community where caregivers have been previously reported to infrequently directly speak to young children [@brown1998conversational; @brown2011cultural; @brown2014interactional]. Our aims are to quantitatively ground these prior qualitative claims in order to reason about the fundamental factors for learning language in Tseltal Mayan (and similar) communities.

## Child-directed speech  {#intro-cds}
Prior work, conducted primarily in Western contexts, has shown that the amount of CDS children hear influences their language development; more CDS is associated with faster-growing receptive and productive vocabularies [e.g., @hart1995meaningful; @hoff2003specificity; @shneidman2012language], faster lexical retrieval [@weisleder2013talking], and faster syntactic development [@huttenlocher2010sources]. Given that CDS is designed for a child hearer, it is more likely than ADS or other-directed speech to align with the child's attention, and may thereby facilitate early language development. There are, however, a few caveats to the body of work relating CDS quantity and language development.

First, while there is overwhelming evidence linking CDS quantity to vocabulary size, links to grammatical development are more scant [but see @brinchmann2019direct; @frankIPvariability; @huttenlocher2010sources]. While the advantage of CDS for referential word learning is clear, it is less obvious how it facilitates syntactic learning [see also @yurovsky2018communicative]. On the other hand, there is a wealth of evidence that syntactic knowledge is lexically specified [e.g., @lieven1997lexically], and that, crosslinguistically, children's vocabulary size is one of the most robust predictors of their early syntactic development [@frankIPvariability; @marchman2004language]---what is good for the lexicon may also be good for syntax. For now, a direct link between CDS and grammatical development still needs further exploration.
<!-- For example, utterance length [a proxy for syntactic complexity; @wasow1997remarks] doesn't appear to increase with child age [@newport1977mother], and parents may be less likely to directly correct their children's syntactic errors than their semantic ones [@brown1997introduction; but see @chouinard2003adult]---sometimes themselves producing ungrammatical utterances to make individual words salient [@aslin1996models]-->

Second, most work on CDS _quantity_ (i.e., how often children hear CDS) uses summary measures that average over the ebb and flow of the recorded session (e.g., average proportion CDS). In reality, verbal behaviors are highly temporally structured: infants' and adults' vocal behavior is clustered across multiple time scales of daylong recordings [@abney2017time] and nouns and verbs are used within short bursts separated by long periods across languages [@blasiIPhuman]. In fact, experimental work has shown that children sometimes learn better from bursty exposure to words [@schwab2016repetition]. Recordings of children's language experience over the course of entire waking days is critical for understanding the full range and distribution of linguistic interactions that make up children's everyday language experiences [@soderstrom2013when; @tamislemonda2018routine].

Third, prior work has typically focused on Western (primarily North American) populations, limiting our ability to generalize effects of CDS to children elsewhere [@brown2014language; @henrich2010beyond; @nielsen2017persistent]. While we gain valuable insight by looking at within-population variation, we can more effectively find places where our assumptions break down by studying language development in communities that diverge meaningfully (linguistically and culturally) from those already well-studied. Linguistic anthropologists working in non-Western communities have long reported that caregiver-child interaction varies immensely from place to place, but that, despite this variation, children appear to achieve major communicative benchmarks (e.g., pointing, first words) on a similar timescale [@brown2011cultural; @brown2014interactional; @brown2014language; @gaskins2006cultural; @liszkowski2012prelinguistic; @ochs1984language]. These findings have had a limited impact on mainstream theories of language development, partly due to a lack of directly comparable methods [@brown2014interactional; @brown2014language].

A number of recent or ongoing research projects have used standard psycholinguistic methods to study language development in traditional, non-Western communities; and many of these studies have substantiated the claim that children in many parts of the world hear very little CDS. Scaff, Cristia, and colleagues [-@cristia2017child; -@scaffIPlanguage] estimate, based on daylong recordings, that Tsimane children, growing up in a forager-horticulturalist population in the Bolivian lowlands, hear approximately 4.8 minutes of CDS per hour between ages 0;6 and 3;0 when considering all possible environmental speech (Cristia et al., 2017; Scaff et al., in preparation; see also @vogt2015communicative). Shneidman and Goldin-Meadow [-@shneidman2012language] analyzed speech from one-hour at-home video recordings of children between 1;0 and 3;0 in a Yucatec Mayan and a North American community. Their analyses yielded four main findings: compared to the American children, (a) Yucatec children heard many fewer utterances per hour, (b) a much smaller proportion of the utterances they heard were child-directed, (c) the proportion of utterances that were child-directed increased dramatically with age, matching U.S. children's CDS proportion by 3;0, and (d) most of the added CDS in the Yucatec sample came from other children (e.g., older siblings/cousins). The lexical diversity of the CDS that Yucatec Mayan children heard at 24 months---particularly from adult speakers---predicted their vocabulary knowledge at 35 months, suggesting that CDS characteristics still play a role in that context. Note however that, it is difficult to know how much speech children typically hear over the course of their full waking days at home without making daylong recordings.
<!--For comparison, children from North American homes between ages 0;3 and 3;0 are estimated to hear ~11 minutes of CDS per hour in daylong recordings [@bergelsoncasillas2019what]. Note however, that these estimates from from a non-random sample of clips that were selected based on the presence of adult speech.-> 
<!--A growing number of researchers are using methods from developmental psycholinguistics to describe the linguistic development of children growing up in traditional or non-Western communities [see also @barrett2013early; @demuth2010three; @fortierURadhoc; @garcia2018thematic; @ganek2018using; @hernik2018infant]. We briefly highlight two recent efforts along these lines, but see Cristia and colleagues' [-@cristia2017child] and Mastin and Vogt's work [-@mastin2016infant; -@vogt2015communicative] for similar examples.-->
<!--Tsimane children also hear ~4.12 minutes of other-directed speech per hour (e.g., talk between adults) compared to the ~7 minutes per hour heard by young North American children [@bergelsoncasillas2019what]. This difference may be attributable to the fact that the Tsimane live in extended family clusters of 3--4 households, so speakers are typically in close proximity to 5--8 other people .-->

## The current study {#intro-currentstudy}
We examined the early language experience of 10 Tseltal Mayan children under age 3;0 using daylong photo-linked audio recordings. Prior ethnographic work suggests that Tseltal caregivers do not frequently directly address their children until the children themselves begin to actively initiate verbal interactions [@brown2014interactional; @brown2011cultural]. Nonetheless, Tseltal children develop language with no apparent delays [@brown2011cultural; @brown2014interactional; @liszkowski2012prelinguistic; see also @pye2017comparative]. We provide more details on the community and dataset in the [Methods section](#methods). We analyzed five basic measures of Tseltal children's language environments including: (a) the quantity of speech directed to them (TCDS; target-child-directed speech), (b) the quantity of other-directed speech (ODS; speech directed to anyone but the target child), (c) the rate of contingent responses to their vocalizations, (d) the rate of their contingent responses to others' vocalizations, and (e) the duration of their interactional dyadic sequences. We then also roughly estimated the number of minutes per day children spent in "high turn-taking" interaction and outlined a basic trajectory for the target children's early vocal development.

Based on prior work, we predicted that Tseltal Mayan children would be infrequently directly addressed, that the amount of TCDS and contingent responses they heard would increase with age, that most TCDS would come from other children, and that, despite this, their early vocal development would be on par with Western children. We additionally predicted that children's language environments would be bursty---that high-intensity interactions would be brief and sparsely distributed throughout the day, accounting for the majority of children's daily TCDS.

# Methods {#methods}
## Corpus {#methods-dataset}
The children in this dataset come from a small-scale, subsistence farming community in the highlands of Chiapas (Southern Mexico). The vast majority of children in the community grow up speaking Tseltal monolingually at home. Nuclear families are typically organized into patrlineal clusters of large, multi-generation households. <!--More than forty years of ethnographic work by the second author has supported the idea that Tseltal children's language environments are non-child-centered and non-object-centered-->Tseltal children's language environments have previously been characterized as non-child-centered and non-object-centered [@brown1998conversational; @brown2011cultural; @brown2014interactional]. During their waking hours, infants are typically tied to their mother's back while she goes about her work for the day. When not on their mother's back, young children are often cared for by other family members, especially older siblings. Typically, TCDS is limited until children themselves begin to initiate interactions, usually around age 1;0. Interactional exchanges, when they do occur, are often brief or non-verbal (e.g., object exchange routines) and take place within a multi-participant context [@brown2014interactional]. Interactions tend to focus on appropriate actions and responses (not on words and their meanings), and young children are socialized to attend to the activities taking place around them [see also @deleon2011language; @rogoff2003firsthand]. By age five, most children are competent speakers who engage in daily chores and the caregiving of their younger siblings. The Tseltal approach to caregiving is similar to that described for other Mayan communities [e.g., @deleon2011language; @gaskins2000childrens; @pye1986quiche; @rogoff2003firsthand; @shneidman2012language].
<!--That said, other properties of Tseltal CDS may facilitate word and language learning, including conversational repetition and semantically specific verbs [@brown2011cultural]. -->
<!--Infants are rarely put on the ground. Therefore, children can't usually pick up the objects around them until they are old enough to walk. Toys are scarce and books are vanishingly rare, so the objects children do get their hands on tend to be natural or household objects (e.g., rocks, sticks, spoons, baskets, etc.). -->

The current data come from <corpus name and references retracted for review> <!--the Casillas HomeBank Corpus [@Casillas-HB; @HomeBank]-->, which includes daylong recordings and other developmental language data from more than 100 children under 4;0 across two indigenous, non-Western communities: the Tseltal Mayan community described here and a Papua New Guinean community described elsewhere (<reference retracted for review>)<!--[@brown2011cultural; @brown2014interactional]-->. This Tseltal corpus, primarily collected in 2015, includes recordings from 55 children born to 43 mothers. The participating families typically only had 2 to 3 children (median = 2; range = 1--9), due to the fact that they come from a young subsample of the community (mothers: mean = 26.3 years; median = 25; range = 16--43 and fathers: mean = 30; median = 27; range = 17---52). Based on data from living children, we estimate that, on average, mothers were 20 years old when they had their first child (median = 19; range = 12--27), with a following average inter-child interval of 3 years (median = 2.8; range = 1--8.5). As a result, 28% of the participating families had two children under 4;0. To our knowledge at the time of recording, all children were typically developing. Note that all ages should be taken with a grain of salt because documentation of birthdates in the village is not rigorous. Household size, defined in our dataset as the number of people sharing a kitchen or other primary living space, ranged between 3 and 15 people (mean = 7.2; median = 7). Although 32.7% of the target children are first-born, they were rarely the only child in their household. Most mothers had finished primary (37%; 6 years of education) or secondary (30%; 9 years of education) school, with a few more having completed preparatory school (12%; 12 years of education) or university (2% (one mother); 16 years of education); the remainder (23%) had no schooling or did not complete primary school. All fathers had finished primary school, with most completing secondary school (44%) or preparatory school (21%), and two completing university-level training (5%).
<!--While 93% of the fathers grew up in the village where the recordings took place, only 53% of the mothers did because of the way clan membership influences marriage and land inheritance.-->

We used a novel combination of a lightweight stereo audio recorder (Olympus WS-832) and wearable photo camera (Narrative Clip 1) fitted with a fish-eye lens to track children's interactions over the course of a 9--11-hour period at home in which the experimenter was not present. Ambulatory children wore both devices at once ([Figure 1](#fig1)) while other children wore the recorder in a onesie while their primary caregiver wore the camera on an elastic vest. The camera was set to take photos at 30-second intervals and was synchronized to the audio in post-processing to generate snapshot-linked audio (media post-processing scripts at: https://github.com/<retracted for review><!--https://github.com/marisacasillas/Weave-->). We used these recordings to capture a wide range of the linguistic patterns children encounter as they participate in different activities over the course of their day [@bergelson2018day; @greenwood2011assessing; @tamislemonda2017power; @tamislemonda2018routine].

``` {r fig1, echo=FALSE, fig.align = "center", fig.cap="The recording vest included an audio recorder in the front horizontal pocket and a camera with a fish-eye lens on the shoulder strap.", out.width = '30%'}
knitr::include_graphics("Tseltal-CLE_files/TseltalCLE-RecordingVest.jpg")
```


```{r prepare_data, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# Read in annotation files
files <- list.files(path=data.path,pattern="*.txt")
all.data <- data.frame()
for (i in 1:length(files)) {
#  print(files[i])
  newfile <- read_csv(paste0(data.path, files[i]),
                      col_types = cols(val = col_character()))
  newfile$aclew_child_id <- unlist(strsplit(files[i], '\\.'))[1]
  all.data <- rbind(all.data, newfile)
}
all.data$row <- c(1:nrow(all.data))

# Read in supplementary data
ptcp.info <- read_csv(ptcp.info.file, col_types = cols()) %>%
  dplyr::select(-row)
seg.info <- read_csv(seg.index.file)

# Extract and convert start time of each sample
seg.info$start.hhmmss <- regmatches(seg.info$Media,
                                    regexpr("[[:digit:]]{6}", seg.info$Media))
seg.info$start.sec <- as.numeric(substr(seg.info$start.hhmmss,1,2))*3600 +
  as.numeric(substr(seg.info$start.hhmmss,3,4))*60 +
  as.numeric(substr(seg.info$start.hhmmss,5,6))
seg.info$start.hr <- round(seg.info$start.sec/3600, 3)

seg.info$clipoffset.hhmmss <- regmatches(seg.info$Media,
                                    regexpr("(?<=[[:digit:]]{6}_)[[:digit:]]{6}",
                                            seg.info$Media, perl = TRUE))
seg.info$clipoffset.sec <- as.numeric(substr(seg.info$clipoffset.hhmmss,1,2))*3600 +
  as.numeric(substr(seg.info$clipoffset.hhmmss,3,4))*60 +
  as.numeric(substr(seg.info$clipoffset.hhmmss,5,6))
seg.info$clipoffset.hr <- round(seg.info$clipoffset.sec/3600, 3)

# Add mean and sd values for participant-level predictors to ptcp.info
ptcp.info <- ptcp.info %>%
  mutate(
    tchiyr.m = mean(age_mo_round),
    motyr.m = mean(mother_age),
    nsb.m = mean(number_older_sibs),
    hsz.m = mean(household_size),
    tchiyr.sd = sd(age_mo_round),
    motyr.sd = sd(mother_age),
    nsb.sd = sd(number_older_sibs),
    hsz.sd = sd(household_size)
    )

# Merge in participant and segment info to the main data table
codes <- all.data %>% filter(tier == "code")

all.data <- all.data %>%
  filter(speaker != "") %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  mutate(segment = "", sample = "",
         sample_type = "", segment_dur = 0)

for (i in 1:nrow(codes)) {
  rec <- codes$aclew_child_id[i]
  seg <- as.character(codes$val[i])
  seg.on <- codes$start[i]
  seg.off <- codes$stop[i]
  seg.idx <- which(all.data$aclew_child_id == rec &
                     all.data$start < seg.off &
                     all.data$stop > seg.on)
  all.data$segment[seg.idx] <- seg
}

# Label samples
all.data$sample[which(
  grepl('^random', all.data$segment))] <- "random"
all.data$sample[which(
  grepl('tt', all.data$segment))] <- "turn-taking"
all.data$sample[which(
  grepl('va', all.data$segment))] <- "high-activity"

# Label sample types and durations
random.samples <- which(grepl('^random', all.data$segment))
all.data$sample_type[random.samples] <- "random"
all.data$segment_dur[random.samples] <- 5

ext.samples <- which(grepl('^extension', all.data$segment))
all.data$sample_type[ext.samples] <- "extension"
all.data$segment_dur[ext.samples] <- 5

tt.samples <- which(grepl('^tt', all.data$segment))
all.data$sample_type[tt.samples] <- "turn-taking"
all.data$segment_dur[tt.samples] <- 1

va.samples <- which(grepl('^va', all.data$segment))
all.data$sample_type[va.samples] <- "turn-taking"
all.data$segment_dur[va.samples] <- 1

# Add in segment start time
all.data <- all.data %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hhmmss",
                                      "start.sec", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName"))

avg.utt.len.tseltal <- all.data %>%
  filter(speaker != "CHI") %>%
  dplyr::select(dur) %>%
  summarise(mean.utt.len = mean(dur),
            median.utt.len = median(dur))
```

## Data selection and annotation {#methods-samples}
We chose 10 children's recordings based on maximal spread in child age (0;0--3;0), child sex, and maternal education ([Table 1](#tab1); all had native Tseltal-speaking parents). We selected one hour's worth of non-overlapping clips from each recording in the following order: nine randomly selected 5-minute clips, five manually selected 1-minute top 'turn-taking' clips, five manually selected 1-minute top 'vocal activity' clips, and one manually selected 5-minute extension of the best 1-minute clip ([Figure 2](#fig2)). We created these different subsamples to measure properties of (a) children's _average_ language environments ("Random"), (b) their most _input-dense_ language environments ("Turn-taking"), and (c) their most _mature vocal behavior_ ("Vocal activity").

```{r demog_table_prep, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
sample.demog <- ptcp.info %>%
  mutate(mat_age_rd = as.integer(round(mother_age, 0)),
         fat_age_rd = as.integer(round(father_age, 0)),
         hszrd = as.integer(round(household_size + 1, 0))) %>%
  select(age_childes, child_sex, mat_age_rd, mat_ed, hszrd) %>%
  rename("Age" = age_childes, "Sex" = child_sex,
         "Mother's age" = mat_age_rd, "Level of maternal education" = mat_ed,
         "People in house" = hszrd)
```

```{r tab1, echo=FALSE, results='asis', message=FALSE, warning=FALSE}
apa_table(sample.demog, caption="Demographic overview of the 10 children whose recordings we sampled.")
```

The turn-taking and high-activity clips were chosen by two trained annotators (the first author and a student assistant) who listened to each recording in its entirety at 1--2x speed while actively taking notes about potentially useful clips. The first author then reviewed the list of candidate clips and chose the best five 1-minute samples for each of the two activity types. Note that, because the manually selected clips did not overlap with the initial "random" clip selection, the "true" peak turn-taking and vocal-activity clips for the day could have possibly occurred during the random clips. High-quality turn-taking activity was defined as closely timed sequences of contingent vocalization between the target child and at least one other person (i.e., frequent vocalization exchanges). High-quality vocal activity clips were defined as periods in which the target child produced the most and most diverse spontaneous (i.e., not imitative) vocalizations (full instructions at https://git.io/<retracted for review><!--https://git.io/fhdUm-->).

```{r fig2, echo=FALSE, fig.cap="Recording duration (black line) and sampled clips (colored boxes) for each of the 10 recordings analyzed, sorted by child age.", message=FALSE, warning=FALSE, fig.height=4}
ptcp.info <- mutate(ptcp.info,
                    rec.start.hr = lubridate::hour(start_of_recording) +
                      lubridate::minute(start_of_recording)/60 +
                      lubridate::second(start_of_recording)/3600,
                    rec.stop.hr = rec.start.hr + length_of_recording/3600) %>%
  arrange(age_mo_round) %>%
  mutate(order = seq(1:10))

used.clips <- seg.info %>%
  filter(Include == 1) %>%
  left_join(ptcp.info, by = c("aclew_id" = "aclew_child_id")) %>%
  mutate(clip.dur = ifelse(grepl(('random'), CodeName), 5,
                           ifelse(grepl('extension', CodeName), 6, 1)),
         sample.type = ifelse(grepl(('random'), CodeName), "Random",
                           ifelse(grepl('tt', CodeName),
                                  "Turn taking", "Vocal activity")))
used.clips$sample.type = factor(used.clips$sample.type,
                                levels = c("Random", "Turn taking", "Vocal activity"))
  
clip.distribution <- ggplot() +
  geom_segment(data = ptcp.info,
               aes(x = rec.start.hr, y = order, xend = rec.stop.hr, yend = order)) +
  geom_segment(data = used.clips,
               aes(x = start.hr, y = order, xend = start.hr + clip.dur/60, yend = order,
                   color = sample.type), size = 3) +
  theme_apa() +
  theme(legend.position = "bottom") +
  scale_x_continuous(breaks = 7:21) +
  scale_y_continuous(breaks = 1:10, labels = ptcp.info$age_mo_round) +
  ylab("Child age (mo)") + xlab("Time of day (hr)") + labs(color = "Sample type") +
  scale_color_manual(values = c(viridis(3)[1], viridis(3)[2], "blue"))
clip.distribution
```

The first author and a native speaker of Tseltal who personally knows all the recorded families jointly transcribed and annotated each clip in ELAN [@ELAN] using the ACLEW Annotation Scheme [full documentation at https://osf.io/b2jep/wiki/home/, @casillas2017ACLEWDAS]. Utterance-level annotations included: an orthographic transcription (Tseltal), a loose translation (Spanish), a vocal maturity rating for each target child utterance (non-linguistic/non-canonical babbling/canonical babbling/single words/multiple words), and the intended addressee type for all non-target-child utterances (target-child/other-child/adult/adult-and-child/animal/other-speaker-type). Intended addressee was determined using contextual and interactional information from the photos, audio, and preceding and following footage; utterances with no clear intended addressee were marked as 'unsure'. We annotated lexical utterances as single- or multi-word based on the word boundaries provided by the single native speaker who reviewed all transcriptions; Tseltal is a mildly polysynthetic language (words typically contain multiple morphemes).

## Data analysis {#methods-analysisinfo}
In what follows we first describe Tseltal children's speech environments based on the nine randomly selected 5-minute clips from each child, including: the rate of target-child-directed speech (TCDS min/hr) and rate of other-directed speech (ODS min/hr), the rate of target-child-to-other turn transitions (TC--O transitions/min) and other-to-target-child turn transitions (O--TC transitions/min), and the duration of the target child's interactional sequences. We investigate the effects of child age, time of day, household size, and number of speakers on each of these five measures. We then repeat these analyses, only now looking at the high "turn-taking" clips. We then wrap up with two descriptive analyses: a rough estimate of the amount of time Tseltal children spend in high turn-taking interaction over the course of an entire day and a basic trajectory for early Tseltal vocal development.

## Statistical models
All analyses were conducted in R with generalized linear mixed-effects regressions using the glmmTMB package, and all plots were generated with ggplot2 [@brooks2017modeling; @R-ggplot2; @R-base]. All data and analysis code can be found at https://github.com/<retracted for review> (temporarily available as an anonymous OSF repository: https://osf.io/9xd5u/?view_only=03a351c1172f4d17af9fce634aefb65e)<!--https://github.com/marisacasillas/Tseltal-CLE--> Notably, all five speech environment measures are naturally restricted to non-negative (0--infinity) values. This implicit boundary restriction at zero causes the distributional variance of our measures to become non-gaussian (i.e., with a long right tail). We handle this issue by using a negative binomial linking function in the regression, which estimates a dispersion parameter (in addition to the mean and variance) that allows the model to more closely fit our non-negative, overdispersed data [@brooks2017modeling; @smithson2013generalized]. When, in addition to this, extra cases of zero were evident in the distribution (e.g., TCDS min/hr was zero because the child was by themselves), we also added a zero-inflation model to the regression. A zero-inflation negative binomial regression creates two models: (a) a binary model to evaluate the likelihood of none vs. some presence of the variable (e.g., no vs. some TCDS) and (b) a count model of the variable (e.g., '3' vs. '5' TCDS min/hr), using the negative binomial distribution as the linking function. Alternative, gaussian linear mixed-effects regressions with logged dependent variables are available in the Supplementary Materials, but the results are broadly similar to what we report here.

# Results {#results}
Our model predictors were as follows: child age (months), household size (number of people), and number of non-target-child speakers present in that clip, all centered and standardized, plus time of day at the start of the clip (as a factor; "morning" = up until 11:00; "midday" = 11:00--13:00; and "afternoon" = 13:00 onwards). We also added two-way interactions between child age and: (a) number of speakers present, (b) household size, and (c) time of day. We also included a random effect of child. For the zero-inflation models, we included number of speakers present. We only report significant effects in the main text; full model outputs are available in the Supplementary Materials.

```{r quantity_prep, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# RANDOM
# Get min/hr speech measures
n.unique.rand.segs <- length(unique(all.data$segment[grepl("random", all.data$segment)]))
n.unique.recs <- length(unique(all.data$aclew_child_id))
all.rand.segments <- tibble(
  aclew_child_id = rep(unique(all.data$aclew_child_id),
                n.unique.rand.segs),
  segment = rep(unique(all.data$segment[grepl("random", all.data$segment)]),
                n.unique.recs))
# XDS
xds.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           grepl("xds@", tier)) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(xds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 5, xds_min = 0)) %>%
  mutate(xds_mph = (xds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# ODS
ods.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           grepl("xds@", tier) & val != "T") %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(ods_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 5, ods_min = 0)) %>%
  mutate(ods_mph = (ods_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# TDS
tds.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           grepl("xds@", tier) & val == "T") %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(tds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 5, tds_min = 0)) %>%
  mutate(tds_mph = (tds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# All CDS
cds.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           grepl("xds@", tier) & (val == "T" | val == "C")) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(cds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 5, cds_min = 0)) %>%
  mutate(cds_mph = (cds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# Number of speakers per clip
spkrs.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           !(grepl("@", tier))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker)))
# All together
quantity.rand <- xds.per.seg.rand %>%
  full_join(ods.per.seg.rand, by = c("aclew_child_id", "segment", "segment_dur")) %>%
  full_join(tds.per.seg.rand, by = c("aclew_child_id", "segment", "segment_dur")) %>%
  full_join(cds.per.seg.rand, by = c("aclew_child_id", "segment", "segment_dur")) %>%
  full_join(spkrs.per.seg.rand, by = c("aclew_child_id", "segment")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName")) %>%
  full_join(ptcp.info, by = "aclew_child_id") %>%
  replace_na(list(xds_min = 0, xds_mph = 0,
                  tds_min = 0, tds_mph = 0,
                  cds_min = 0, cds_mph = 0,
                  n_spkrs_clip = 0)) %>%
  mutate(prop_tds = tds_min/xds_min)
  # Don't replace NAs with 0s in this case; proportion is not meaningful w/o any speech
quantity.rand.bychild <- quantity.rand %>%
  group_by(aclew_child_id) %>%
  summarise(
    xds_min = mean(xds_min),
    xds_mph = mean(xds_mph),
    ods_min = mean(ods_min),
    ods_mph = mean(ods_mph),
    tds_min = mean(tds_min),
    tds_mph = mean(tds_mph),
    cds_min = mean(cds_min),
    cds_mph = mean(cds_mph),
    prop_tds = mean(prop_tds, na.rm = TRUE),
    m_n_spkrs = mean(n_spkrs_clip)) %>%
  full_join(ptcp.info, by = "aclew_child_id")

# Get xds and tds min/hr by speaker type
all.data$SpkrAge <- "Not known"
all.data$SpkrAge[grepl("FA|MA|UA", all.data$speaker)] <- "Adult"
all.data$SpkrAge[grepl("FC|MC|UC", all.data$speaker)] <- "Child"
all.rand.segments.sa <- tibble(
  aclew_child_id = rep(unique(all.data$aclew_child_id),
                2*n.unique.rand.segs),
  segment = rep(unique(all.data$segment[grepl("random", all.data$segment)]),
                2*n.unique.recs),
  SpkrAge = c(rep("Adult", (n.unique.rand.segs * n.unique.recs)),
              rep("Child", (n.unique.rand.segs * n.unique.recs))))
# XDS
xds.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI" & SpkrAge != "Not known" &
           grepl("xds@", tier)) %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(xds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments.sa, by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = 5, xds_min.sa = 0)) %>%
  mutate(xds_mph.sa = (xds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# ODS
ods.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI" & SpkrAge != "Not known" &
           grepl("xds@", tier) & val != "T") %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(ods_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments.sa, by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = 5, ods_min.sa = 0)) %>%
  mutate(ods_mph.sa = (ods_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# TDS
tds.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI" & SpkrAge != "Not known" &
           grepl("xds@", tier) & val == "T") %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(tds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments.sa, by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = 5, tds_min.sa = 0)) %>%
  mutate(tds_mph.sa = (tds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# All CDS
cds.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI" & SpkrAge != "Not known" &
           grepl("xds@", tier) & (val == "T" | val == "C")) %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(cds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments.sa, by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = 5, cds_min.sa = 0)) %>%
  mutate(cds_mph.sa = (cds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# Number of speakers per clip
spkrs.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI" & SpkrAge != "Not known" &
           !(grepl("@", tier))) %>%
  group_by(aclew_child_id, SpkrAge, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker)))
# All together
quantity.rand.sa <- xds.per.seg.rand.sa %>%
  full_join(ods.per.seg.rand.sa, by = c("aclew_child_id", "SpkrAge",
                                        "segment", "segment_dur")) %>%
  full_join(tds.per.seg.rand.sa, by = c("aclew_child_id", "SpkrAge",
                                        "segment", "segment_dur")) %>%
  full_join(cds.per.seg.rand.sa, by = c("aclew_child_id", "SpkrAge",
                                        "segment", "segment_dur")) %>%
  full_join(dplyr::select(quantity.rand, c("aclew_child_id", "segment", "tds_min")),
            by = c("aclew_child_id", "segment")) %>%
  full_join(spkrs.per.seg.rand.sa, by = c("aclew_child_id", "SpkrAge", "segment")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName")) %>%
  full_join(ptcp.info, by = "aclew_child_id") %>%
  replace_na(list(xds_min.sa = 0, xds_mph.sa = 0,
                  ods_min.sa = 0, ods_mph.sa = 0,
                  tds_min.sa = 0, tds_mph.sa = 0,
                  cds_min.sa = 0, cds_mph.sa = 0,
                  n_spkrs_clip = 0)) %>%
  mutate(prop_tds.sa = tds_min.sa/xds_min.sa,
         prop_sa.tds = tds_min.sa/tds_min)
  # Don't replace NAs with 0s in this case; proportion is not meaningful w/o any speech


# NON-RANDOM
# Get min/hr speech measures
all.nonrand.segments <- seg.info %>%
  filter(!(grepl("random", CodeName))) %>%
  select(aclew_id, CodeName) %>%
  rename(aclew_child_id = aclew_id, segment = CodeName)
all.nonrand.segments$sample <- ifelse(grepl("va", all.nonrand.segments$segment),
                                      "high-activity","turn-taking")
all.nonrand.segments$sample_type <- ifelse(
  grepl("^va", all.nonrand.segments$segment), "high-activity",
  ifelse(grepl("^tt", all.nonrand.segments$segment),"turn-taking",
                                        "extension"))
# XDS
xds.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
           grepl("xds@", tier)) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(xds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 1, xds_min = 0)) %>%
  mutate(segment_dur = ifelse(grepl("ext", segment), 5, 1),
         xds_mph = (xds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# ODS
ods.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
           grepl("xds@", tier) & val != "T") %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(ods_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 1, ods_min = 0)) %>%
  mutate(segment_dur = ifelse(grepl("ext", segment), 5, 1),
         ods_mph = (ods_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# TDS
tds.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
           grepl("xds@", tier) & val == "T") %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(tds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 1, tds_min = 0)) %>%
  mutate(segment_dur = ifelse(grepl("ext", segment), 5, 1),
         tds_mph = (tds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# All CDS
cds.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
           grepl("xds@", tier) & (val == "T" | val == "C")) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(cds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 1, cds_min = 0)) %>%
  mutate(segment_dur = ifelse(grepl("ext", segment), 5, 1),
         cds_mph = (cds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# Number of speakers per clip
spkrs.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI" & SpkrAge != "Not known" &
           !(grepl("@", tier))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker)))
# All together
quantity.nonrand <- xds.per.seg.nonrand %>%
  full_join(ods.per.seg.nonrand, by = c("aclew_child_id", "segment",
                                        "segment_dur", "sample", "sample_type")) %>%
  full_join(tds.per.seg.nonrand, by = c("aclew_child_id", "segment",
                                        "segment_dur", "sample", "sample_type")) %>%
  full_join(cds.per.seg.nonrand, by = c("aclew_child_id", "segment",
                                        "segment_dur", "sample", "sample_type")) %>%
  full_join(ptcp.info, by = "aclew_child_id") %>%
  full_join(spkrs.per.seg.nonrand, by = c("aclew_child_id", "segment")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName")) %>%
  replace_na(list(xds_min = 0, xds_mph = 0,
                  ods_min = 0, ods_mph = 0,
                  tds_min = 0, tds_mph = 0,
                  cds_min = 0, cds_mph = 0,
                  n_spkrs_clip = 0)) %>%
  mutate(prop_tds = tds_min/xds_min)
  # Don't replace NAs with 0s in this case; proportion is not meaningful w/o any speech
quantity.nonrand.bychild <- quantity.nonrand %>%
  group_by(aclew_child_id, sample) %>%
  summarise(
    xds_min = mean(xds_min),
    xds_mph = mean(xds_mph),
    ods_min = mean(ods_min),
    ods_mph = mean(ods_mph),
    tds_min = mean(tds_min),
    tds_mph = mean(tds_mph),
    cds_min = mean(cds_min),
    cds_mph = mean(cds_mph),
    prop_tds = mean(prop_tds, na.rm = TRUE),
    m_n_spkrs = mean(n_spkrs_clip)) %>%
  full_join(ptcp.info, by = "aclew_child_id")

# Get xds and tds min/hr by speaker type
all.nonrand.segments.sa <- tibble(
  aclew_child_id = rep(all.nonrand.segments$aclew_child_id, 2),
  segment = rep(all.nonrand.segments$segment, 2),
  sample = rep(all.nonrand.segments$sample, 2),
  sample_type = rep(all.nonrand.segments$sample_type, 2),
  SpkrAge = c(rep("Adult", nrow(all.nonrand.segments)),
              rep("Child", nrow(all.nonrand.segments))))
# XDS
xds.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" & SpkrAge != "Not known" &
           grepl("xds@", tier)) %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(xds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments.sa, by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = 1, xds_min.sa = 0)) %>%
  mutate(segment_dur = ifelse(grepl("ext", segment), 5, 1),
         xds_mph.sa = (xds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# ODS
ods.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" & SpkrAge != "Not known" &
           grepl("xds@", tier) & val != "T") %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(ods_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments.sa, by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = 1, ods_min.sa = 0)) %>%
  mutate(segment_dur = ifelse(grepl("ext", segment), 5, 1),
         ods_mph.sa = (ods_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# TDS
tds.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" & SpkrAge != "Not known" &
           grepl("xds@", tier) & val == "T") %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(tds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments.sa, by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = 1, tds_min.sa = 0)) %>%
  mutate(segment_dur = ifelse(grepl("ext", segment), 5, 1),
         tds_mph.sa = (tds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# All CDS
cds.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" & SpkrAge != "Not known" &
           grepl("xds@", tier) & (val == "T" | val == "C")) %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(cds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments.sa, by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = 1, cds_min.sa = 0)) %>%
  mutate(segment_dur = ifelse(grepl("ext", segment), 5, 1),
         cds_mph.sa = (cds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# Number of speakers per clip
spkrs.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" & SpkrAge != "Not known" &
           !(grepl("@", tier))) %>%
  group_by(aclew_child_id, SpkrAge, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker)))
# All together
quantity.nonrand.sa <- xds.per.seg.nonrand.sa %>%
  full_join(ods.per.seg.nonrand.sa, by = c("aclew_child_id", "SpkrAge",
                                           "segment", "segment_dur",
                                           "sample", "sample_type")) %>%
  full_join(tds.per.seg.nonrand.sa, by = c("aclew_child_id", "SpkrAge",
                                           "segment", "segment_dur",
                                           "sample", "sample_type")) %>%
  full_join(cds.per.seg.nonrand.sa, by = c("aclew_child_id", "SpkrAge",
                                           "segment", "segment_dur",
                                           "sample", "sample_type")) %>%
  full_join(select(quantity.nonrand, c("aclew_child_id", "segment", "tds_min")),
            by = c("aclew_child_id", "segment")) %>%
  full_join(ptcp.info, by = "aclew_child_id") %>%
  full_join(spkrs.per.seg.nonrand.sa, by = c("aclew_child_id", "SpkrAge", "segment")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName")) %>%
  replace_na(list(xds_min.sa = 0, xds_mph.sa = 0,
                  ods_min.sa = 0, ods_mph.sa = 0,
                  tds_min.sa = 0, tds_mph.sa = 0,
                  cds_min.sa = 0, cds_mph.sa = 0,
                  n_spkrs_clip = 0)) %>%
  mutate(prop_tds.sa = tds_min.sa/xds_min.sa,
         prop_sa.tds = tds_min.sa/tds_min)
  # Don't replace NAs with 0s in this case; proportion is not meaningful w/o any speech

# Subset the non-random samples (used for differnt purposes)
quantity.nonrand.tt <- filter(quantity.nonrand, sample == "turn-taking")
quantity.nonrand.tt.sa <- filter(quantity.nonrand.sa, sample == "turn-taking")
quantity.nonrand.va <- filter(quantity.nonrand, sample != "turn-taking")
quantity.nonrand.va.sa <- filter(quantity.nonrand.sa, sample != "turn-taking")


## Get variables ready for modeling
# random sample
quantity.rand$child_sex <- as.factor(quantity.rand$child_sex)
quantity.rand$mat_ed <- as.factor(quantity.rand$mat_ed)
nspkrs.m <- mean(quantity.rand$n_spkrs_clip)
nspkrs.sd <- sd(quantity.rand$n_spkrs_clip)
quantity.rand <- quantity.rand %>%
  mutate(
    xds_mph.nz = ifelse(xds_mph > 0, 1, 0),
    ods_mph.nz = ifelse(ods_mph > 0, 1, 0),
    tds_mph.nz = ifelse(tds_mph > 0, 1, 0),
    cds_mph.nz = ifelse(cds_mph > 0, 1, 0),
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
quantity.rand$stthr.tri <- factor(quantity.rand$stthr.tri,
                                  levels = c("midday", "morning", "afternoon"))
quantity.rand$stthr.tri.a <- factor(quantity.rand$stthr.tri,
                                  levels = c("afternoon", "midday", "morning"))

quantity.rand.sa$child_sex <- as.factor(quantity.rand.sa$child_sex)
quantity.rand.sa$mat_ed <- as.factor(quantity.rand.sa$mat_ed)
nspkrs.sa.m <- mean(quantity.rand.sa$n_spkrs_clip)
nspkrs.sa.sd <- sd(quantity.rand.sa$n_spkrs_clip)
quantity.rand.sa <- quantity.rand.sa %>%
  mutate(
    xds_mph.sa.nz = ifelse(xds_mph.sa > 0, 1, 0),
    ods_mph.sa.nz = ifelse(ods_mph.sa > 0, 1, 0),
    tds_mph.sa.nz = ifelse(tds_mph.sa > 0, 1, 0),
    cds_mph.sa.nz = ifelse(cds_mph.sa > 0, 1, 0),
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.sa.m)/nspkrs.sa.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
quantity.rand.sa$stthr.tri <- factor(quantity.rand.sa$stthr.tri,
                                     levels = c("midday", "morning", "afternoon"))
quantity.rand.sa$stthr.tri.a <- factor(quantity.rand.sa$stthr.tri,
                                       levels = c("afternoon", "midday", "morning"))


# tt sample
quantity.nonrand.tt$child_sex <- as.factor(quantity.nonrand.tt$child_sex)
quantity.nonrand.tt$mat_ed <- as.factor(quantity.nonrand.tt$mat_ed)
nspkrs.m <- mean(quantity.nonrand.tt$n_spkrs_clip)
nspkrs.sd <- sd(quantity.nonrand.tt$n_spkrs_clip)
quantity.nonrand.tt <- quantity.nonrand.tt %>%
  mutate(
    xds_mph.nz = ifelse(xds_mph > 0, 1, 0),
    ods_mph.nz = ifelse(ods_mph > 0, 1, 0),
    tds_mph.nz = ifelse(tds_mph > 0, 1, 0),
    cds_mph.nz = ifelse(cds_mph > 0, 1, 0),
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
quantity.nonrand.tt$stthr.tri <- factor(quantity.nonrand.tt$stthr.tri,
                                        levels = c("midday", "morning", "afternoon"))
quantity.nonrand.tt$stthr.tri.a <- factor(quantity.nonrand.tt$stthr.tri,
                                          levels = c("afternoon", "midday", "morning"))

quantity.nonrand.tt.sa$child_sex <- as.factor(quantity.nonrand.tt.sa$child_sex)
quantity.nonrand.tt.sa$mat_ed <- as.factor(quantity.nonrand.tt.sa$mat_ed)
nspkrs.sa.m <- mean(quantity.nonrand.tt.sa$n_spkrs_clip)
nspkrs.sa.sd <- sd(quantity.nonrand.tt.sa$n_spkrs_clip)
quantity.nonrand.tt.sa <- quantity.nonrand.tt.sa %>%
  mutate(
    xds_mph.sa.nz = ifelse(xds_mph.sa > 0, 1, 0),
    ods_mph.sa.nz = ifelse(ods_mph.sa > 0, 1, 0),
    tds_mph.sa.nz = ifelse(tds_mph.sa > 0, 1, 0),
    cds_mph.sa.nz = ifelse(cds_mph.sa > 0, 1, 0),
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.sa.m)/nspkrs.sa.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
quantity.nonrand.tt.sa$stthr.tri <- factor(quantity.nonrand.tt.sa$stthr.tri,
                                           levels = c("midday", "morning", "afternoon"))
quantity.nonrand.tt.sa$stthr.tri.a <- factor(quantity.nonrand.tt.sa$stthr.tri,
                                             levels = c("afternoon", "midday", "morning"))

```

```{r quantity_plots, message=FALSE, warning=FALSE, paged.print=FALSE}
quantity.nonrand.tt.minimum <- dplyr::select(quantity.nonrand.tt,
                                             age_mo_round, xds_mph, ods_mph, tds_mph,
                                             prop_tds, n_spkrs_clip) %>%
                                             mutate(Sample = "Turn taking")
quantity.rand.minimum <- dplyr::select(quantity.rand,
                                       age_mo_round, xds_mph, ods_mph, tds_mph,
                                       prop_tds, n_spkrs_clip) %>%
                                       mutate(Sample = "Random")
quantity.rand_and_tt <- bind_rows(quantity.nonrand.tt.minimum, quantity.rand.minimum)

quantity.nonrand.sa.tt.minimum <- dplyr::select(quantity.nonrand.tt.sa,
                                             age_mo_round, prop_sa.tds, SpkrAge) %>%
                                             mutate(Sample = "Turn taking")
quantity.rand.sa.minimum <- dplyr::select(quantity.rand.sa,
                                       age_mo_round, prop_sa.tds, SpkrAge) %>%
                                       mutate(Sample = "Random")
quantity.sa.rand_and_tt <- bind_rows(
  quantity.nonrand.sa.tt.minimum, quantity.rand.sa.minimum)

write_csv(quantity.rand_and_tt,
          paste0(shiny.input.path,
                 "quantity-scores_rand-and-tt.csv"))

# ODS min/hr
odsmph.segments.rand_and_tt <- ggplot(quantity.rand_and_tt,
                          aes(x = age_mo_round, y = ods_mph, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("ODS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,80),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

# TDS min/hr
tdsmph.segments.rand_and_tt <- ggplot(quantity.rand_and_tt,
                          aes(x = age_mo_round, y = tds_mph, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("TCDS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(0,80),
                     breaks=seq(0,80,20)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,80),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

# TDS min/hr - zoomed in
tdsmph.segments.rand_and_tt.zoomedin <- ggplot(quantity.rand_and_tt,
                          aes(x = age_mo_round, y = tds_mph, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("TCDS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(0,40),
                     breaks=seq(0,40,10)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,40),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

# TDS prop
tdsprp.segments.rand_and_tt <- ggplot(quantity.rand_and_tt,
                          aes(x = age_mo_round, y = prop_tds, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("TCDS/All spch") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(-.2,1.2),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

# prop TDS from children
tdsprp.segments.rand_and_tt.sa <- ggplot(subset(quantity.sa.rand_and_tt,
                                                SpkrAge == "Child"),
                             aes(x = age_mo_round, y = prop_sa.tds, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("Prop of TCDS") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(-.2,1.2),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1), xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

## TOD plots
quantity.nonrand.tt$Sample <- "Turn taking"
quantity.rand$Sample <- "Random"
quantity.rand_and_tt.all <- bind_rows(quantity.nonrand.tt, quantity.rand)
quantity.rand_and_tt.all$stthr.tri.centered <- factor(
  quantity.rand_and_tt.all$stthr.tri,
  levels = c("morning", "midday", "afternoon"))
quantity.rand_and_tt.all$SplitAge <- ifelse(
  quantity.rand_and_tt.all$age_mo_round < 13, "Under 1;0", "1;0+")
quantity.rand_and_tt.all$SplitAge <- factor(quantity.rand_and_tt.all$SplitAge,
  levels = c("Under 1;0", "1;0+"))

write_csv(quantity.rand_and_tt.all,
          paste0(shiny.input.path,
                 "quantity-scores_rand-and-tt-TOD.csv"))

tod.tcds <- ggplot(data = quantity.rand_and_tt.all, aes(
  y = round(tds_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  facet_grid(~ Sample) +
  ylab("TCDS (min/hr)") + xlab("Time of day")	+
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,40),
                     breaks=c(0,10,20, 30, 40)) +
  scale_color_manual(guide = FALSE, values = viridis(3)) +
  scale_fill_manual(guide = FALSE, values = viridis(3)) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,40)) +
  theme_apa() +
  theme(legend.position="right",
        axis.line = element_line(color="black", size = 0.4)) +
  guides(alpha = guide_legend(override.aes = list(
    fill = c("gray80", "gray30"))))

tod.ods <- ggplot(data = quantity.rand_and_tt.all, aes(
  y = round(ods_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  facet_grid(~ Sample) +
  ylab("ODS (min/hr)") + xlab("Time of day")	+
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_color_manual(guide = FALSE, values = viridis(3)) +
  scale_fill_manual(guide = FALSE, values = viridis(3)) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,80)) +
  theme_apa() +
  theme(legend.position="right",
        axis.line = element_line(color="black", size = 0.4)) +
  guides(alpha = guide_legend(override.aes = list(
    fill = c("gray80", "gray30"))))

# individual TOD plots
tod.tcds.rand <- ggplot(
  data = subset(quantity.rand_and_tt.all, Sample == "Random"), aes(
  y = round(tds_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  ylab("TCDS (min/hr)") + xlab("")	+
  ggtitle("Random") +
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,40),
                     breaks=c(0,10,20, 30, 40)) +
  scale_color_manual(guide = FALSE, values = viridis(3)) +
  scale_fill_manual(guide = FALSE, values = viridis(3)) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,40)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

tod.ods.rand <- ggplot(
  data = subset(quantity.rand_and_tt.all, Sample == "Random"), aes(
  y = round(ods_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  ylab("ODS (min/hr)") + xlab("")	+
  ggtitle("Random") +
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_color_manual(guide = FALSE, values = viridis(3)) +
  scale_fill_manual(guide = FALSE, values = viridis(3)) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,80)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

tod.tcds.tt <- ggplot(
  data = subset(quantity.rand_and_tt.all, Sample == "Turn taking"), aes(
  y = round(tds_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  ylab("TCDS (min/hr)") + xlab("Time of day")	+
  ggtitle("Turn taking") +
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,40),
                     breaks=c(0,10,20, 30, 40)) +
  scale_color_manual(guide = FALSE,
                     values = c("#21908CFF", "#21908CFF", "#FDE725FF")) +
  scale_fill_manual(guide = FALSE,
                    values = c("#21908CFF", "#21908CFF", "#FDE725FF")) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,40)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

tod.ods.tt <- ggplot(
  data = subset(quantity.rand_and_tt.all, Sample == "Turn taking"), aes(
  y = round(ods_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  ylab("ODS (min/hr)") + xlab("Time of day")	+
  ggtitle("Turn taking") +
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_color_manual(guide = FALSE,
                     values = c("#21908CFF", "#21908CFF", "#FDE725FF")) +
  scale_fill_manual(guide = FALSE,
                    values = c("#21908CFF", "#21908CFF", "#FDE725FF")) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,80)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))
```

```{r fig3, echo=FALSE, fig.cap="By-child estimates of minutes per hour of target-child-directed speech (left) and other-directed speech (right). Data are shown for the random (purple; solid) and turn taking (green; dashed) samples. Bands on the linear trends show 95% confidence intervals.", message=FALSE, warning=FALSE, fig.height=2.5}
grid.arrange(tdsmph.segments.rand_and_tt.zoomedin,
             odsmph.segments.rand_and_tt, nrow=1, ncol=2)
```

```{r fig4, echo=FALSE, fig.cap="Average TCDS rates reported from at-home recordings across various populations and ages, including urban (empty shape) and rural and/or indigenous (filled shape) samples. Point size indicates the number of children represented (range = 1--26). Data sources: @bergelsoncasillas2019what US/Canada; @shneidman2010language US and Yucatec; @vogt2015communicative Dutch, Mozambique urban and rural; @scaffIPlanguage Tsimane.", message=FALSE, warning=FALSE, fig.height=2.5}
# Prep comparison data for matching figures
comparison.data <- read_csv(comparison.file)
tds.mph.tofill <- which(is.na(comparison.data$tds_mph) &
                          !(is.na(comparison.data$tds_uph)))
comparison.data$tds_mph[tds.mph.tofill] <- ((comparison.data$tds_uph[tds.mph.tofill] *
                                               avg.utt.len.tseltal$median.utt.len)/60000)
ods.mph.tofill <- which(is.na(comparison.data$ods_mph) &
                          !(is.na(comparison.data$ods_uph)))
comparison.data$ods_mph[ods.mph.tofill] <- ((comparison.data$ods_uph[ods.mph.tofill] *
                                               avg.utt.len.tseltal$median.utt.len)/60000)
xds.mph.tofill <- which(is.na(comparison.data$xds_mph) &
                          !(is.na(comparison.data$ods_mph)) &
                          !(is.na(comparison.data$tds_mph)))
comparison.data$xds_mph[xds.mph.tofill] <- comparison.data$ods_mph[xds.mph.tofill] +
  comparison.data$tds_mph[xds.mph.tofill]
# Add in current data
by.chi.rand.avgs <- quantity.rand %>%
  ungroup() %>%
  select(age_mo_round, ods_mph, cds_mph, tds_mph, xds_mph, prop_tds) %>%
  group_by(age_mo_round) %>%
  summarise(ods_mph = mean(ods_mph),
            cds_mph = mean(cds_mph),
            tds_mph = mean(tds_mph),
            xds_mph = mean(xds_mph),
            prp_tds = mean(prop_tds, na.rm = TRUE)) %>%
  rename(AgeMonths = age_mo_round) %>%
  mutate(ods_uph = NA,
         tds_uph = NA,
         xds_uph = NA,
         prp_tds_adu = NA,
         prp_tds_chi = NA,
         shape = 8,
         N = 1,
         Type = "Rural, non-WEIRD",
         Site = "Tseltal",
         Reference = "The current study",
         Notes = "")
comparison.data <- bind_rows(comparison.data, by.chi.rand.avgs)

comparison.data$Site <- factor(comparison.data$Site,
                               levels = unique(comparison.data$Site))
comparison.data$Site <- factor(comparison.data$Site, levels =
                                 c("US/Canada", "US", "Dutch", "MozambiqueUrb",
                                   "MozambiqueRur", "Tsimane", "Yukatek", "Tseltal"))
comparison.data.shapes <- unique(comparison.data$shape)

# TDS min/hr comparison
tdsmph.comparison <- ggplot(comparison.data,
                          aes(x = AgeMonths, y = tds_mph, stroke = 1,
                              color = Type, shape = Site, size = N)) +
  geom_point(fill = "gray50", alpha = 0.7) +
  scale_shape_manual(values=comparison.data.shapes) +
  ylab("TCDS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(0,20),
                     breaks=seq(0,20,5)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,20),xlim=c(0,38)) +
  scale_color_manual(values = c("black", "gray40")) +
  theme_apa() +
  guides(size = FALSE, color = FALSE) +
  theme(axis.line = element_line(color="black", size = 0.4))
tdsmph.comparison
```

```{r tcds_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## TCDS random sample ####
tcds.random.distribution <- ggplot(quantity.rand,
                            aes(round(tds_mph,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("TCDS min/hr") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "TCDS_random_distribution.png"),
       plot = tcds.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(quantity.rand$tds_mph,0))^2
#mean(round(quantity.rand$tds_mph,0))
# mean is much smaller than variance
tds.rand.zinb <- glmmTMB(round(tds_mph,0) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand,
                         ziformula=~nsk.std,
                         family="nbinom1")
#tds.rand.zinb.res = simulateResiduals(tds.rand.zinb)
#plot(tds.rand.zinb.res, rank = T) # (manually saved)
#summary(tds.rand.zinb)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)   
#(Intercept)                    0.82318    0.38815   2.121  0.03394 * 
#tchiyr.std                     0.44447    0.42262   1.052  0.29294   
#stthr.trimorning               0.81894    0.39733   2.061  0.03929 * 
#stthr.triafternoon             0.49070    0.37401   1.312  0.18952   
#hsz.std                       -0.08792    0.26286  -0.334  0.73802   
#nsk.std                       -0.12782    0.16269  -0.786  0.43206   
#tchiyr.std:stthr.trimorning   -0.23599    0.39305  -0.600  0.54823   
#tchiyr.std:stthr.triafternoon -0.81223    0.37874  -2.145  0.03199 * 
#tchiyr.std:hsz.std            -0.21337    0.32104  -0.665  0.50629   
#tchiyr.std:nsk.std             0.60579    0.19780   3.063  0.00219 **
#---
#Zero-inflation model:
#            Estimate Std. Error z value Pr(>|z|)
#(Intercept)   -56.90   14003.31  -0.004    0.997
#nsk.std       -55.17   14243.76  -0.004    0.997
# save for reporting
tds.rand.zinb.COEF.morn <-
  coef(summary(tds.rand.zinb))[[1]]["stthr.trimorning",] 
tds.rand.zinb.COEF.aft <-
  coef(summary(tds.rand.zinb))[[1]]["stthr.triafternoon",] 
tds.rand.zinb.COEF.agetime <-
  coef(summary(tds.rand.zinb))[[1]]["tchiyr.std:stthr.triafternoon",]
tds.rand.zinb.COEF.agensk <-
  coef(summary(tds.rand.zinb))[[1]]["tchiyr.std:nsk.std",] 

# test the other two-way effects of time of day
tds.rand.zinb.v2 <- glmmTMB(round(tds_mph,0) ~
                           tchiyr.std +
                           stthr.tri.a +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri.a +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand,
                         ziformula=~nsk.std,
                         family="nbinom1")
#summary(tds.rand.zinb.v2)
#stthr.tri.amidday              -0.4886     0.3787  -1.290       0.19700    
#stthr.tri.amorning              0.3044     0.2879   1.057       0.29048    
#tchiyr.std:stthr.tri.amidday    0.7326     0.3588   2.042       0.04114 *  
#tchiyr.std:stthr.tri.amorning   0.4552     0.2766   1.646       0.09984 .  
# save for reporting
tds.rand.zinb.v2.COEF.aft.vs.morn <-
  coef(summary(tds.rand.zinb.v2))[[1]]["stthr.tri.amorning",] 
tds.rand.zinb.v2.COEF.age.aft.vs.morn <-
  coef(summary(tds.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",] 
tds.rand.zinb.v2.COEF.age.aft.vs.midd <-
  coef(summary(tds.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amidday",] 

## TCDS tt sample ####
tcds.tt.distribution <- ggplot(quantity.nonrand.tt,
                            aes(round(tds_mph,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("TCDS min/hr") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "TCDS_turntaking_distribution.png"),
       plot = tcds.tt.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(quantity.nonrand.tt$tds_mph,0))^2
#mean(round(quantity.nonrand.tt$tds_mph,0))
# mean is much smaller than variance
# not zero-inflated (nature of this sample)
tds.tt.nb <- glmmTMB(round(tds_mph,0) ~
                       tchiyr.std +
                       stthr.tri +
                       hsz.std +
                       nsk.std +
                       tchiyr.std:stthr.tri +
                       tchiyr.std:hsz.std +
                       tchiyr.std:nsk.std +
                       (1|aclew_child_id),
                     data=quantity.nonrand.tt,
                     family="nbinom1")
#tds.tt.nb.res = simulateResiduals(tds.tt.nb)
#plot(tds.tt.nb.res, rank = T) # (manually saved)
#summary(tds.tt.nb)
#Conditional model:
#                              Estimate Std. Error z value  Pr(>|z|)    
#(Intercept)                    2.18313    0.21298  10.250  <0.0001 ***
#tchiyr.std                    -0.22751    0.19781  -1.150  0.2501    
#stthr.trimorning               0.35533    0.23475   1.514  0.1301    
#stthr.triafternoon             0.14484    0.21939   0.660  0.5091    
#hsz.std                       -0.25282    0.15437  -1.638  0.1015    
#nsk.std                       -0.06740    0.09198  -0.733  0.4637    
#tchiyr.std:stthr.trimorning   -0.24161    0.22835  -1.058  0.2900    
#tchiyr.std:stthr.triafternoon -0.15237    0.20725  -0.735  0.4622    
#tchiyr.std:hsz.std            -0.46538    0.19241  -2.419  0.0156 *  
#tchiyr.std:nsk.std             0.04160    0.11620   0.358  0.7203    
#--
#Zero-inflation model:
#            Estimate Std. Error z value Pr(>|z|)    
#(Intercept)  -3.7900     1.0050  -3.771 0.000162 ***
#nsk.std       0.8721     0.7178   1.215 0.224397
# save for reporting
tds.tt.nb.COEF.age.hsz <-
  coef(summary(tds.tt.nb))[[1]]["tchiyr.std:hsz.std",]

# test the other two-way effects of time of day
tds.tt.nb.v2 <- glmmTMB(round(tds_mph,0) ~
                       tchiyr.std +
                       stthr.tri.a +
                       hsz.std +
                       nsk.std +
                       tchiyr.std:stthr.tri.a +
                       tchiyr.std:hsz.std +
                       tchiyr.std:nsk.std +
                       (1|aclew_child_id),
                     data=quantity.nonrand.tt,
                     family="nbinom1")
#summary(tds.tt.nb.v2)
#stthr.tri.amidday             -0.06471    0.23241  -0.278              0.7807    
#stthr.tri.amorning             0.26769    0.21593   1.240              0.2151    
#tchiyr.std:stthr.tri.amidday   0.03344    0.21400   0.156              0.8758    
#tchiyr.std:stthr.tri.amorning -0.23644    0.21540  -1.098              0.2723    
# no results to save for reporting
```

```{r tcds_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## TCDS random sample ####
tds.rand.gaus <- glmmTMB(log(tds_mph+1) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand)
#tds.rand.gaus.res = simulateResiduals(tds.rand.gaus)
#plot(tds.rand.gaus.res, rank = T) # (manually saved)
#summary(tds.rand.gaus)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    0.77507    0.22523   3.441 0.000579 ***
#tchiyr.std                     0.49352    0.25950   1.902 0.057198 .  
#stthr.trimorning               0.50824    0.25050   2.029 0.042465 *  
#stthr.triafternoon             0.29315    0.22126   1.325 0.185203    
#hsz.std                       -0.19656    0.19595  -1.003 0.315809    
#nsk.std                        0.23224    0.11838   1.962 0.049776 *  
#tchiyr.std:stthr.trimorning   -0.16002    0.26992  -0.593 0.553276    
#tchiyr.std:stthr.triafternoon -0.68051    0.23874  -2.850 0.004366 ** 
#tchiyr.std:hsz.std            -0.08496    0.23915  -0.355 0.722381    
#tchiyr.std:nsk.std             0.24923    0.14810   1.683 0.092402 .  
# DIFFERENCES?
# broadly similar to z-i nb model

# test the other two-way effects of time of day
tds.rand.gaus.v2 <- glmmTMB(log(tds_mph+1) ~
                           tchiyr.std +
                           stthr.tri.a +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri.a +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand)
#summary(tds.rand.gaus.v2)
#tthr.tri.amidday             -0.29314    0.22126  -1.325       0.18521    
#stthr.tri.amorning             0.21510    0.21916   0.981       0.32635    
#tchiyr.std:stthr.tri.amidday   0.68050    0.23874   2.850       0.00437 ** 
#tchiyr.std:stthr.tri.amorning  0.52049    0.23242   2.239       0.02512 *  
# DIFFERENCES?
# broadly similar to z-i nb model

## TCDS tt sample ####
tds.tt.gaus <- glmmTMB(log(tds_mph+1) ~
                       tchiyr.std +
                       stthr.tri +
                       hsz.std +
                       nsk.std +
                       tchiyr.std:stthr.tri +
                       tchiyr.std:hsz.std +
                       tchiyr.std:nsk.std +
                       (1|aclew_child_id),
                     data=quantity.nonrand.tt)
#tds.tt.gaus.res = simulateResiduals(tds.tt.gaus)
#plot(tds.tt.gaus.res, rank = T) # (manually saved)
#summary(tds.tt.gaus)
#Conditional model:
#                               Estimate Std. Error z value  Pr(>|z|)    
#(Intercept)                    2.081105   0.243378   8.551  <0.0001 ***
#tchiyr.std                    -0.128497   0.233182  -0.551  0.5816    
#stthr.trimorning               0.380764   0.298155   1.277  0.2016    
#stthr.triafternoon             0.105890   0.267468   0.396  0.6922    
#hsz.std                       -0.147307   0.172597  -0.853  0.3934    
#nsk.std                       -0.077111   0.114714  -0.672  0.5015    
#tchiyr.std:stthr.trimorning   -0.344770   0.296548  -1.163  0.2450    
#tchiyr.std:stthr.triafternoon -0.004403   0.262779  -0.017  0.9866    
#tchiyr.std:hsz.std            -0.491258   0.219527  -2.238  0.0252 *  
#tchiyr.std:nsk.std             0.169108   0.149388   1.132  0.2576 
# DIFFERENCES?
# very similar to z-i nb model

# test the other two-way effects of time of day
tds.tt.gaus.v2 <- glmmTMB(log(tds_mph+1) ~
                       tchiyr.std +
                       stthr.tri.a +
                       hsz.std +
                       nsk.std +
                       tchiyr.std:stthr.tri.a +
                       tchiyr.std:hsz.std +
                       tchiyr.std:nsk.std +
                       (1|aclew_child_id),
                     data=quantity.nonrand.tt)
#summary(tds.tt.gaus.v2)
#stthr.tri.amidday             -0.105890   0.267468  -0.396              0.6922    
#stthr.tri.amorning             0.274873   0.265438   1.036              0.3004    
#tchiyr.std:stthr.tri.amidday   0.004403   0.262779   0.017              0.9866    
#tchiyr.std:stthr.tri.amorning -0.340366   0.277150  -1.228              0.2194
# DIFFERENCES?
# very similar to z-i nb model

# Write model results out for input to shiny
TCDS.models <- bind_rows(
  broom.mixed::tidy(tds.rand.zinb) %>%
    mutate(model = "TCDS_random_z-inb"),
  broom.mixed::tidy(tds.rand.zinb.v2) %>%
    mutate(model = "TCDS_random_z-inb.v2"),
  broom.mixed::tidy(tds.rand.gaus) %>%
    mutate(model = "TCDS_random_log_gaus"),
  broom.mixed::tidy(tds.rand.gaus.v2) %>%
    mutate(model = "TCDS_random_log_gaus.v2"),
  broom.mixed::tidy(tds.tt.nb) %>%
    mutate(model = "TCDS_turntaking_nb"),
  broom.mixed::tidy(tds.tt.nb.v2) %>%
    mutate(model = "TCDS_turntaking_nb.v2"),
  broom.mixed::tidy(tds.tt.gaus) %>%
    mutate(model = "TCDS_turntaking_log_gaus"),
  broom.mixed::tidy(tds.tt.gaus.v2) %>%
    mutate(model = "TCDS_turntaking_log_gaus.v2"))
```

## Target-child-directed speech (TCDS)
The children in our sample were directly spoken to for an average of `r round(mean(quantity.rand.bychild$tds_mph),2)` minutes per hour in the random sample (median = `r round(median(quantity.rand.bychild$tds_mph),2)`; range = `r round(min(quantity.rand.bychild$tds_mph),2)`--`r round(max(quantity.rand.bychild$tds_mph),2)`; [Figure 3](#fig3)). These estimates are similar to those reported for Yucatec Mayan children [@shneidman2012language], as illustrated in [Figure 4](#fig4) (see @scaffIPlanguage for more detailed cross-language comparisons). Note that, to make this comparison, we have converted Shneidman's (2010) utterance/hr estimates to min/hr using the median Tseltal utterance duration for non-target child speakers: (`r avg.utt.len.tseltal$median.utt.len` msec), motivated by the fact that Yucatec and Tseltal are related languages spoken in comparable rural indigenous communities. We modeled TCDS min/hr in the random clips with a zero-inflated negative binomial regression. The rate of TCDS in the randomly sampled clips was primarily affected by factors relating to the time of day ([Figure 5](#fig5)). The count model showed that the children were more likely to hear TCDS in the mornings than around midday (B = `r round(tds.rand.zinb.COEF.morn[[1]],2)`, SD = `r round(tds.rand.zinb.COEF.morn[[2]],2)`, z = `r round(tds.rand.zinb.COEF.morn[[3]],2)`, p = `r round(tds.rand.zinb.COEF.morn[[4]],2)`), with no difference between morning and afternoon (p = `r round(tds.rand.zinb.v2.COEF.aft.vs.morn[[4]],2)`) or midday and afternoon (p = `r round(tds.rand.zinb.COEF.aft[[4]],2)`). Time-of-day effects varied by age: older children showed a stronger afternoon dip in TCDS. Specifically, they were significantly more likely to hear TCDS at midday (B = `r round(tds.rand.zinb.v2.COEF.age.aft.vs.midd[[1]],2)`, SD = `r round(tds.rand.zinb.v2.COEF.age.aft.vs.midd[[2]],2)`, z = `r round(tds.rand.zinb.v2.COEF.age.aft.vs.midd[[3]],2)`, p = `r round(tds.rand.zinb.v2.COEF.age.aft.vs.midd[[4]],2)`) and marginally more likely to hear it in the morning (B = `r round(tds.rand.zinb.v2.COEF.age.aft.vs.morn[[1]],2)`, SD = `r round(tds.rand.zinb.v2.COEF.age.aft.vs.morn[[2]],2)`, z = `r round(tds.rand.zinb.v2.COEF.age.aft.vs.morn[[3]],2)`, p = `r round(tds.rand.zinb.v2.COEF.age.aft.vs.morn[[4]],2)`) compared to the afternoons. Older target children were also significantly more likely to hear TCDS when more speakers were present, compared to younger children (B = `r round(tds.rand.zinb.COEF.agensk[[1]],2)`, SD = `r round(tds.rand.zinb.COEF.agensk[[2]],2)`, z = `r round(tds.rand.zinb.COEF.agensk[[3]],2)`, p < 0.01). There were no other significant effects in either the count or the zero-inflation model.

``` {r fig5, echo=FALSE, fig.cap="TCDS (left) and ODS (right) min/hr rates heard at different times of day in the random (top) and turn-taking (bottom) clip samples by children age 1;0 and younger (light) and 1;0 and older (dark).", message=FALSE, warning=FALSE, fig.height=4}
grid.arrange(tod.tcds.rand, tod.ods.rand,
             tod.tcds.tt, tod.ods.tt, nrow=2, ncol=2)
```

``` {r chitcdscorrs, message=FALSE, warning=FALSE, paged.print=FALSE}
# Aggregate to one point per child and then test a correlation with age
# random
propchitcds.rand <- subset(quantity.rand.sa[
  which(!is.na(quantity.rand.sa$prop_sa.tds)),],
  SpkrAge == "Child")
propchitcds.rand.corr_age <- propchitcds.rand %>%
  group_by(aclew_child_id, tchiyr.std, age_mo_round) %>%
  summarise(avg_prpchitcds = mean(prop_sa.tds))
propchitcds.rand.corr_age.test <- cor.test(
  ~ age_mo_round + avg_prpchitcds,
  data = propchitcds.rand.corr_age, method = "spearman")
# turn taking
propchitcds.tt <- subset(quantity.nonrand.tt.sa[
  which(!is.na(quantity.nonrand.tt.sa$prop_sa.tds)),],
  SpkrAge == "Child")
propchitcds.tt.corr_age <- propchitcds.tt %>%
  group_by(aclew_child_id, tchiyr.std, age_mo_round) %>%
  summarise(avg_prpchitcds = mean(prop_sa.tds))
propchitcds.tt.corr_age.test <- cor.test(
  ~ age_mo_round + avg_prpchitcds,
  data = propchitcds.tt.corr_age, method = "spearman")
```

In contrast to findings from @shneidman2012language on Yucatec Mayan, most TCDS in the current data came from adult speakers (mean = `r round(mean(1-propchitcds.rand.corr_age$avg_prpchitcds),4)*100`%, median = `r round(median(1-propchitcds.rand.corr_age$avg_prpchitcds),4)*100`%, range = `r round(min(1-propchitcds.rand.corr_age$avg_prpchitcds),4)*100`%--`r round(max(1-propchitcds.rand.corr_age$avg_prpchitcds),4)*100`%), with no evidence for an increase in proportion of TCDS from children with target child age (Spearman's _rho_ = `r round(propchitcds.rand.corr_age.test$estimate[[1]],2)`; _p_ = `r round(propchitcds.rand.corr_age.test$p.value[[1]],2)`).

```{r ods_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## ODS random sample ####
ods.random.distribution <- ggplot(quantity.rand,
                            aes(round(ods_mph,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("ODS min/hr") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "ODS_random_distribution.png"),
       plot = ods.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(quantity.rand$ods_mph,0))^2
#mean(round(quantity.rand$ods_mph,0))
# mean is much smaller than variance
ods.rand.zinb <- glmmTMB(round(ods_mph,0) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand,
                         ziformula=~nsk.std,
                         family="nbinom1")
#ods.rand.zinb.res = simulateResiduals(ods.rand.zinb)
#plot(ods.rand.zinb.res, rank = T) # (manually saved)
#summary(ods.rand.zinb)
#Conditional model:
#                              Estimate Std. Error z value  Pr(>|z|)    
#(Intercept)                    2.86750    0.15974  17.951  < 0.001 ***
#tchiyr.std                    -0.12805    0.18369  -0.697  0.4857    
#stthr.trimorning               0.36202    0.17348   2.087  0.0369 *  
#stthr.triafternoon             0.29431    0.15573   1.890  0.0588 .  
#hsz.std                        0.04324    0.09867   0.438  0.6612    
#nsk.std                        0.64982    0.08871   7.325  < 0.001 ***
#tchiyr.std:stthr.trimorning    0.09915    0.20802   0.477  0.6336    
#tchiyr.std:stthr.triafternoon  0.37800    0.17103   2.210  0.0271 *  
#tchiyr.std:hsz.std             0.31660    0.13159   2.406  0.0161 *  
#tchiyr.std:nsk.std            -0.01992    0.13093  -0.152  0.8791    
#---
#Zero-inflation model:
#            Estimate Std. Error z value Pr(>|z|)
#(Intercept)   -50.25   10421.88  -0.005    0.996
#nsk.std       -53.75   10600.83  -0.005    0.996
# save for reporting
ods.rand.zinb.COEF.morn <-
  coef(summary(ods.rand.zinb))[[1]]["stthr.trimorning",] 
ods.rand.zinb.COEF.aft <-
  coef(summary(ods.rand.zinb))[[1]]["stthr.triafternoon",] 
ods.rand.zinb.COEF.nsk <-
  coef(summary(ods.rand.zinb))[[1]]["nsk.std",] 
ods.rand.zinb.COEF.age.morn <-
  coef(summary(ods.rand.zinb))[[1]]["tchiyr.std:stthr.trimorning",]
ods.rand.zinb.COEF.age.aft <-
  coef(summary(ods.rand.zinb))[[1]]["tchiyr.std:stthr.triafternoon",]
ods.rand.zinb.COEF.age.hsz <-
  coef(summary(ods.rand.zinb))[[1]]["tchiyr.std:hsz.std",] 

# test the other two-way effects of time of day
ods.rand.zinb.v2 <- glmmTMB(round(ods_mph,0) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=quantity.rand,
                            ziformula=~nsk.std,
                            family="nbinom1")
# save for reporting
#summary(ods.rand.zinb.v2)
#stthr.tri.amidday             -0.29431    0.15573  -1.890               0.0588 .  
#stthr.tri.amorning             0.06770    0.14238   0.476               0.6344    
#tchiyr.std:stthr.tri.amidday  -0.37800    0.17103  -2.210               0.0271 *  
#tchiyr.std:stthr.tri.amorning -0.27885    0.17162  -1.625               0.1042    
ods.rand.zinb.v2.COEF.aft.vs.morn <-
  coef(summary(ods.rand.zinb.v2))[[1]]["stthr.tri.amorning",] 
ods.rand.zinb.v2.COEF.age.aft.vs.morn <-
  coef(summary(ods.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",] 

## ODS tt sample ####
ods.tt.distribution <- ggplot(quantity.nonrand.tt,
                            aes(round(ods_mph,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("ODS min/hr") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "ODS_turntaking_distribution.png"),
       plot = ods.tt.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(quantity.nonrand.tt$ods_mph,0))^2
#mean(round(quantity.nonrand.tt$ods_mph,0))
# mean is much smaller than variance
# still zero-inflated
ods.tt.zinb <- glmmTMB(round(ods_mph,0) ~
                         tchiyr.std +
                         stthr.tri +
                         hsz.std +
                         nsk.std +
                         tchiyr.std:stthr.tri +
                         tchiyr.std:hsz.std +
                         tchiyr.std:nsk.std +
                         (1|aclew_child_id),
                       data=quantity.nonrand.tt,
                       ziformula=~nsk.std,
                       family="nbinom1")
#ods.tt.zinb.res = simulateResiduals(ods.tt.zinb)
#plot(ods.tt.zinb.res, rank = T) # (manually saved)
#summary(ods.tt.zinb)
#Conditional model:
#                              Estimate Std. Error z value  Pr(>|z|)    
#(Intercept)                    2.47226    0.21894  11.292  < 0.001 ***
#tchiyr.std                    -0.44969    0.20523  -2.191  0.02844 *  
#stthr.trimorning               0.02291    0.25858   0.089  0.92941    
#stthr.triafternoon            -0.69960    0.29240  -2.393  0.01673 *  
#hsz.std                       -0.43839    0.16870  -2.599  0.00936 ** 
#nsk.std                        0.70801    0.10686   6.626  < 0.001 ***
#tchiyr.std:stthr.trimorning   -0.56061    0.28206  -1.988  0.04686 *  
#tchiyr.std:stthr.triafternoon -0.14065    0.30202  -0.466  0.64142    
#tchiyr.std:hsz.std            -0.37513    0.21525  -1.743  0.08137 .  
#tchiyr.std:nsk.std             0.10420    0.14355   0.726  0.46792    
#---
#Zero-inflation model:
#            Estimate Std. Error z value Pr(>|z|)
#(Intercept)   -32.21   12233.79  -0.003    0.998
#nsk.std       -31.55   12037.74  -0.003    0.998
# save for reporting
ods.tt.zinb.COEF.age <-
  coef(summary(ods.tt.zinb))[[1]]["tchiyr.std",] 
ods.tt.zinb.COEF.morn <-
  coef(summary(ods.tt.zinb))[[1]]["stthr.trimorning",] 
ods.tt.zinb.COEF.aft <-
  coef(summary(ods.tt.zinb))[[1]]["stthr.triafternoon",] 
ods.tt.zinb.COEF.hsz <-
  coef(summary(ods.tt.zinb))[[1]]["hsz.std",] 
ods.tt.zinb.COEF.nsk <-
  coef(summary(ods.tt.zinb))[[1]]["nsk.std",] 
ods.tt.zinb.COEF.age.morn <-
  coef(summary(ods.tt.zinb))[[1]]["tchiyr.std:stthr.trimorning",] 
ods.tt.zinb.COEF.age.aft <-
  coef(summary(ods.tt.zinb))[[1]]["tchiyr.std:stthr.triafternoon",] 
ods.tt.zinb.COEF.age.hsz <-
  coef(summary(ods.tt.zinb))[[1]]["tchiyr.std:hsz.std",] 

# test the other two-way effects of time of day
ods.tt.zinb.v2 <- glmmTMB(round(ods_mph,0) ~
                            tchiyr.std +
                            stthr.tri.a +
                            hsz.std +
                            nsk.std +
                            tchiyr.std:stthr.tri.a +
                            tchiyr.std:hsz.std +
                            tchiyr.std:nsk.std +
                            (1|aclew_child_id),
                          data=quantity.nonrand.tt,
                          ziformula=~nsk.std,
                          family="nbinom1")
# save for reporting
#summary(ods.tt.zinb.v2)
#stthr.tri.amidday               0.6996     0.2924   2.393         0.01673 *  
#stthr.tri.amorning              0.7225     0.2485   2.907         0.00364 ** 
#tchiyr.std:stthr.tri.amidday    0.1407     0.3020   0.466         0.64142    
#tchiyr.std:stthr.tri.amorning  -0.4200     0.2720  -1.544         0.12266   
ods.tt.zinb.v2.COEF.aft.vs.morn <-
  coef(summary(ods.tt.zinb.v2))[[1]]["stthr.tri.amorning",] 
ods.tt.zinb.v2.COEF.aft.vs.midd <-
  coef(summary(ods.tt.zinb.v2))[[1]]["stthr.tri.amidday",] 
ods.tt.zinb.v2.COEF.age.aft.vs.morn <-
  coef(summary(ods.tt.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",] 
```

```{r ods_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## ODS random sample ####
ods.rand.gaus <- glmmTMB(log(ods_mph+1) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand)
#ods.rand.gaus.res = simulateResiduals(ods.rand.gaus)
#plot(ods.rand.gaus.res, rank = T) # (manually saved)
#summary(ods.rand.gaus)
#Conditional model:
#                               Estimate Std. Error z value  Pr(>|z|)    
#(Intercept)                    2.209209   0.173268  12.750  <0.0001 ***
#tchiyr.std                    -0.082121   0.198366  -0.414  0.6789    
#stthr.trimorning               0.214457   0.210419   1.019  0.3081    
#stthr.triafternoon             0.336292   0.186481   1.803  0.0713 .  
#hsz.std                       -0.222994   0.137259  -1.625  0.1042    
#nsk.std                        1.534691   0.094447  16.249  <0.0001 ***
#tchiyr.std:stthr.trimorning   -0.006369   0.225841  -0.028  0.9775    
#tchiyr.std:stthr.triafternoon  0.422003   0.201088   2.099  0.0359 *  
#tchiyr.std:hsz.std             0.322522   0.169461   1.903  0.0570 .  
#tchiyr.std:nsk.std             0.082755   0.122301   0.677  0.4986    
# DIFFERENCES?
# broadly similar to z-i nb model


# test the other two-way effects of time of day
ods.rand.gaus.v2 <- glmmTMB(log(ods_mph+1) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=quantity.rand)
#summary(ods.rand.gaus.v2)
# save for reporting
#stthr.tri.amidday             -0.33629    0.18648  -1.803 0.0713 .  
#stthr.tri.amorning            -0.12183    0.18372  -0.663 0.5072    
#tchiyr.std:stthr.tri.amidday  -0.42200    0.20109  -2.099 0.0359 *  
#tchiyr.std:stthr.tri.amorning -0.42837    0.19584  -2.187 0.0287 *
# DIFFERENCES?
# broadly similar to z-i nb model

## ODS tt sample ####
ods.tt.gaus <- glmmTMB(log(ods_mph+1) ~
                         tchiyr.std +
                         stthr.tri +
                         hsz.std +
                         nsk.std +
                         tchiyr.std:stthr.tri +
                         tchiyr.std:hsz.std +
                         tchiyr.std:nsk.std +
                         (1|aclew_child_id),
                       data=quantity.nonrand.tt)
#ods.tt.gaus.res = simulateResiduals(ods.tt.gaus)
#plot(ods.tt.gaus.res, rank = T) # (manually saved)
#summary(ods.tt.gaus)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    2.24127    0.23554   9.516 < 0.0001 ***
#tchiyr.std                    -0.25514    0.22567  -1.131 0.25822    
#stthr.trimorning              -0.18879    0.28855  -0.654 0.51294    
#stthr.triafternoon            -0.74887    0.25885  -2.893 0.00382 ** 
#hsz.std                       -0.38815    0.16704  -2.324 0.02014 *  
#nsk.std                        1.11687    0.11102  10.060 < 0.0001 ***
#tchiyr.std:stthr.trimorning   -0.28973    0.28699  -1.010 0.31271    
#tchiyr.std:stthr.triafternoon  0.04321    0.25431   0.170 0.86509    
#tchiyr.std:hsz.std            -0.21240    0.21245  -1.000 0.31742    
#tchiyr.std:nsk.std            -0.03232    0.14457  -0.224 0.82311    
# DIFFERENCES?
# Fairly similar, but some differences: no effect of child age or child age * morning

# test the other two-way effects of time of day
ods.tt.gaus.v2 <- glmmTMB(log(ods_mph+1) ~
                            tchiyr.std +
                            stthr.tri.a +
                            hsz.std +
                            nsk.std +
                            tchiyr.std:stthr.tri.a +
                            tchiyr.std:hsz.std +
                            tchiyr.std:nsk.std +
                            (1|aclew_child_id),
                          data=quantity.nonrand.tt)
#summary(ods.tt.gaus.v2)
# save for reporting
#stthr.tri.amidday              0.74887    0.25885   2.893  0.00382 ** 
#stthr.tri.amorning             0.56008    0.25688   2.180  0.02924 *  
#tchiyr.std:stthr.tri.amidday  -0.04321    0.25431  -0.170  0.86509    
#tchiyr.std:stthr.tri.amorning -0.33294    0.26822  -1.241  0.21450    
# DIFFERENCES?
# very similar to z-i nb model

# Write model results out for input to shiny
ODS.models <- bind_rows(
  broom.mixed::tidy(ods.rand.zinb) %>%
    mutate(model = "ODS_random_z-inb"),
  broom.mixed::tidy(ods.rand.zinb.v2) %>%
    mutate(model = "ODS_random_z-inb.v2"),
  broom.mixed::tidy(ods.rand.gaus) %>%
    mutate(model = "ODS_random_log_gaus"),
  broom.mixed::tidy(ods.rand.gaus.v2) %>%
    mutate(model = "ODS_random_log_gaus.v2"),
  broom.mixed::tidy(ods.tt.zinb) %>%
    mutate(model = "ODS_turntaking_z-inb"),
  broom.mixed::tidy(ods.tt.zinb.v2) %>%
    mutate(model = "ODS_turntaking_z-inb.v2"),
  broom.mixed::tidy(ods.tt.gaus) %>%
    mutate(model = "ODS_turntaking_log_gaus"),
  broom.mixed::tidy(ods.tt.gaus.v2) %>%
    mutate(model = "ODS_turntaking_log_gaus.v2"))
```

## Other-directed speech (ODS)
Children heard an average of `r round(mean(quantity.rand.bychild$ods_mph),2)` minutes of ODS per hour in the random sample (median = `r round(median(quantity.rand.bychild$ods_mph),2)`; range = `r round(min(quantity.rand.bychild$ods_mph),2)`--`r round(max(quantity.rand.bychild$ods_mph),2)`): that is, nearly six times as much speech as was directed to them, on average. We modeled ODS min/hr in the random clips with a zero-inflated negative binomial regression. The count model of ODS in the randomly selected clips revealed that the presence of more speakers was strongly associated with more ODS (B = `r round(ods.rand.zinb.COEF.nsk[[1]],2)`, SD = `r round(ods.rand.zinb.COEF.nsk[[2]],2)`, z = `r round(ods.rand.zinb.COEF.nsk[[3]],2)`, p < 0.001). There were an average of `r round(mean(quantity.rand$n_spkrs_clip), 2)` speakers present other than the target child in the randomly selected clips (median = `r round(median(quantity.rand$n_spkrs_clip),2)`; range = `r round(min(quantity.rand$n_spkrs_clip),2)`--`r round(max(quantity.rand$n_spkrs_clip),2)`), more than half of whom were typically adults. Older target children were also significantly less likely to hear ODS in large households, compared to younger children (B = `r round(ods.rand.zinb.COEF.age.hsz[[1]],2)`, SD = `r round(ods.rand.zinb.COEF.age.hsz[[2]],2)`, z = `r round(ods.rand.zinb.COEF.age.hsz[[3]],2)`, p = `r round(ods.rand.zinb.COEF.age.hsz[[4]],3)`).<!--That said, these estimates may be comparable to young North American infants (6--7 months) living in nuclear family homes [@bergelson2018day], so a high incidence of ODS may be common for infants in many cultural contexts.-->

Like TCDS, ODS was also strongly affected by time of day ([Figure 5](#fig5)), showing a dip around midday. Compared to midday, target children were overall significantly more likely to hear ODS in the mornings (B = `r round(ods.rand.zinb.COEF.morn[[1]],2)`, SD = `r round(ods.rand.zinb.COEF.morn[[2]],2)`, z = `r round(ods.rand.zinb.COEF.morn[[3]],2)`, p = `r round(ods.rand.zinb.COEF.morn[[4]],2)`) and marginally more likely to hear it in the afternoons (B = `r round(ods.rand.zinb.COEF.aft[[1]],2)`, SD = `r round(ods.rand.zinb.COEF.aft[[2]],2)`, z = `r round(ods.rand.zinb.COEF.aft[[3]],2)`, p = `r round(ods.rand.zinb.COEF.aft[[4]],2)`), with no significant difference between ODS rates in the mornings and afternoons (p = `r round(ods.rand.zinb.v2.COEF.aft.vs.morn[[4]],2)`). As before, ODS rate varied across the day by target child age: older children were significantly more likely to hear ODS in the afternoon than at midday (B = `r round(ods.rand.zinb.COEF.age.aft[[1]],2)`, SD = `r round(ods.rand.zinb.COEF.age.aft[[2]],2)`, z = `r round(ods.rand.zinb.COEF.age.aft[[3]],2)`, p = `r round(ods.rand.zinb.COEF.age.aft[[4]],2)`), with no significant differences between afternoon and morning (p = `r round(ods.rand.zinb.v2.COEF.age.aft.vs.morn[[4]],2)`) or midday and morning (p = `r round(ods.rand.zinb.COEF.age.morn[[4]],2)`). There were no other significant effects on ODS rate, and no significant effects in the zero-inflation models.

``` {r fig6, echo=FALSE, fig.align = "center", fig.cap="Illustration of an annotated audio clip including the target child (TC), an older sister (SI), and their mother (MO). Turn transitions between the target child and others are marked with solid and dashed lines. Interactional sequences are boxed in with dotted lines. Box color indicates TCDS (blue) and ODS (light gray).", out.width = '100%'}
knitr::include_graphics("Tseltal-CLE_files/TseltalCLE-TurnTimingIllustration.png")
```

## Target-child-to-other turn transitions (TC--O)
Contingent responses by or to the target child are likely to occur at moments in which the child and another speaker are attentionally aligned, and so the rate at which these responses occur is a partial index of children's experience with joint moments of high-quality linguistic evidence. We measured two types of contingent responses: target-child-to-other and other-to-target-child. We detect these contingent turn transitions based on utterance onset and offset times and the annotations of intended addressee for each non-target-child utterance (the solid and dashed lines connecting vocalizations in [Figure 6](#fig6)). If a child's vocalization is followed by a target-child-directed utterance within -`r allowed.overlap` msec to `r allowed.gap` msec after its end [@casillas2016turn; @hilbrink2015early], it is counted as a contingent response (i.e., a TC--O transition). We use the same idea to find other-to-target-child transitions  (i.e., a target-child-directed utterance followed by a target child vocalization with the same timing restrictions). In our analysis, each target child vocalization can have maximally one prompt and one response, and each target-child-directed utterance can maximally count once as a prompt and once as a response (e.g., in a TC--O--TC sequence, the 'O' is both a response and a prompt). These timing restrictions are based on prior studies of infant and young children's spontaneous turn taking [e.g., @bornstein2015mother; @broesch2016similarities; @casillas2016turn; @hilbrink2015early]. 
<!--We have slightly widened the timing margins from these studies for the current dataset because the prior estimates come from relatively short, intense bouts of interaction in American English middle-class parental contexts. Much prior work has used maximum gaps of similar or greater length as ours to detect verbal contingencies in  caregiver-child interaction [e.g., @bergelsoncasillas2019what; @kuchirko2018becoming; @romeo2018beyond; @warlaumont2014social; @vanegeren2001mother].-->

```{r interaction_prep, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# All segment info
all.segments <- all.rand.segments %>%
  mutate(sample = "random", sample_type = "random") %>%
  bind_rows(all.nonrand.segments) %>%
  arrange(aclew_child_id, segment)

# Number of speakers per clip
spkrs.per.seg.all <- all.data %>%
  filter(speaker != "CHI" &
           !(grepl("@", tier))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker))) %>%
  full_join(all.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(n_spkrs_clip = 0)) %>%
  arrange(aclew_child_id, segment)

# Turn transitions:
# other-to-child and child-to-other
turn.transitions <- tibble()
for (i in 1:nrow(all.segments)) {
  subdata <- all.data %>%
    filter(aclew_child_id == all.segments$aclew_child_id[i] &
             segment == all.segments$segment[i])
  c_utt <- subdata %>%
    filter(tier == "CHI")
  used.tm1s <- c()
  used.tp1s <- c()
  child <- all.segments$aclew_child_id[i]
  # Save turn-by-turn info
  chi.turn.info <- c_utt %>%
    select(aclew_child_id, segment, tier, speaker, start, stop) %>%
    mutate(tm1.tier = NA, tm1.speaker = NA, tm1.start = NA, tm1.stop = NA, tm1.val = NA,
           tp1.tier = NA, tp1.speaker = NA, tp1.start = NA, tp1.stop = NA, tp1.val = NA)
  for (j in 1:nrow(c_utt)) {
    # Find CHI-OTH transitions
    # "T" responses that start:
    #    - earliest: when the child starts vocalizing, with a limit on vocal overlap
    #    - latest: before the maximum allowed gap after the child's voc ends
    tp1.start <- max((c_utt$stop[j] - allowed.overlap), c_utt$start[j])
    tp1.stop <- c_utt$stop[j] + allowed.gap
    t.plus1 <- which(subdata$speaker != "CHI" &
                    (subdata$val == "T") &
                    subdata$start >= tp1.start &
                    subdata$start <= tp1.stop)
    # Find OTH-CHI transitions
    # "T" prompts that start:
    #    - earliest: within the maximum gap allowed before the child begins vocalizing
    #    - latest: when the child stops vocalizing, with a limit on vocal overlap
    tm1.start <- c_utt$start[j] - allowed.gap
    tm1.stop <- min((c_utt$start[j] + allowed.overlap), c_utt$stop[j])
    t.minus1 <- which(subdata$speaker != "CHI" &
                    (subdata$val == "T") &
                    subdata$stop <= tm1.stop &
                    subdata$stop >= tm1.start)
    if(length(t.plus1) > 0) {
      tp1.match <- 0
      for (turn in t.plus1) {
        # Each OTH turn can only be a response once 
        if (!(turn %in% used.tp1s) & tp1.match == 0) {
          used.tp1s <- c(used.tp1s, turn)
          chi.turn.info$tp1.tier[j] <- subdata$tier[turn]
          chi.turn.info$tp1.speaker[j] <- subdata$speaker[turn]
          chi.turn.info$tp1.start[j] <- subdata$start[turn]
          chi.turn.info$tp1.stop[j] <- subdata$stop[turn]
          chi.turn.info$tp1.val[j] <- subdata$val[turn]
          tp1.match <- 1
        }
      }
    }
    if(length(t.minus1) > 0) {
      tm1.match <- 0
      for (turn in t.minus1) {
        # Each OTH turn can only be a prompt once 
        if (!(turn %in% used.tm1s) & tm1.match == 0) {
          used.tm1s <- c(used.tm1s, turn)
          chi.turn.info$tm1.tier[j] <- subdata$tier[turn]
          chi.turn.info$tm1.speaker[j] <- subdata$speaker[turn]
          chi.turn.info$tm1.start[j] <- subdata$start[turn]
          chi.turn.info$tm1.stop[j] <- subdata$stop[turn]
          chi.turn.info$tm1.val[j] <- subdata$val[turn]
          tm1.match <- 1
        }
      }
    }
  }
  turn.transitions <- bind_rows(turn.transitions, chi.turn.info)
}

turn.transitions.overview.o_c <- turn.transitions %>%
  filter(!(is.na(tm1.val))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n.o_c.tts = n()) %>%
  full_join(all.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(n.o_c.tts = 0)) %>%
  arrange(aclew_child_id, segment) %>%
  mutate(duration = ifelse(grepl('extension', sample_type), 5,
                           ifelse(grepl('random', sample_type), 5, 1)))

turn.transitions.overview.c_o <- turn.transitions %>%
  filter(!(is.na(tp1.val))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n.c_o.tts = n()) %>%
  full_join(all.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(n.c_o.tts = 0)) %>%
  arrange(aclew_child_id, segment) %>%
  mutate(duration = ifelse(grepl('extension', sample_type), 5,
                           ifelse(grepl('random', sample_type), 5, 1)))

# Combine the turn-taking info into one table
turn.transitions.overview <- turn.transitions.overview.o_c %>%
  full_join(dplyr::select(turn.transitions.overview.c_o,
                          c("aclew_child_id", "segment", "n.c_o.tts")),
            by = c("aclew_child_id", "segment")) %>%
  mutate(n.o_c.tpm = n.o_c.tts/duration,
         n.c_o.tpm = n.c_o.tts/duration) %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  left_join(spkrs.per.seg.all, by = c("aclew_child_id", "segment",
                                      "sample", "sample_type")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName"))

# Summaries of turn taking by sample
turn.taking.by.sample <- turn.transitions.overview %>%
  group_by(sample) %>%
  summarise(mean.n.o_c.tpm = mean(n.o_c.tpm),
         median.n.o_c.tpm = median(n.o_c.tpm),
         min.n.o_c.tpm = min(n.o_c.tpm),
         max.n.o_c.tpm = max(n.o_c.tpm),
         mean.n.c_o.tpm = mean(n.c_o.tpm),
         median.n.c_o.tpm = median(n.c_o.tpm),
         min.n.c_o.tpm = min(n.c_o.tpm),
         max.n.c_o.tpm = max(n.c_o.tpm))
turn.taking.by.child.bysample <- turn.transitions.overview %>%
  group_by(aclew_child_id, sample) %>%
  summarise(mean.n.o_c.tpm = mean(n.o_c.tpm),
         median.n.o_c.tpm = median(n.o_c.tpm),
         min.n.o_c.tpm = min(n.o_c.tpm),
         max.n.o_c.tpm = max(n.o_c.tpm),
         mean.n.c_o.tpm = mean(n.c_o.tpm),
         median.n.c_o.tpm = median(n.c_o.tpm),
         min.n.c_o.tpm = min(n.c_o.tpm),
         max.n.c_o.tpm = max(n.c_o.tpm))

# Interactional sequences:
# continuous sequences only including target-child vocalization and
# target-child-directed talk
turn.sequences <- tibble()
for (i in 1:nrow(all.segments)) {
  # retrieve all the target child vocs and xds == T vocalizations
  subdata.tcds <- all.data %>%
    filter(aclew_child_id == all.segments$aclew_child_id[i] &
             segment == all.segments$segment[i] &
             grepl('xds@', tier) &
             val == "T") %>%
    mutate(uttid = paste0(speaker, start))
  subdata.chi <- all.data %>%
    filter(aclew_child_id == all.segments$aclew_child_id[i] &
             segment == all.segments$segment[i] &
             tier == "CHI") %>%
    mutate(uttid = paste0(speaker, start))
  subdata <- bind_rows(subdata.tcds, subdata.chi) %>%
    arrange(start)
  # work through each target child voc in the clip
  if (nrow(subdata) > 0) {
    if (nrow(subdata.chi) > 0) {
      chi.vocs <- mutate(subdata.chi,
          seq.num = rep(NA,nrow(subdata.chi)),
          seq.start = rep(NA,nrow(subdata.chi)),
          seq.start.spkr = rep(NA,nrow(subdata.chi)),
          seq.stop = rep(NA,nrow(subdata.chi)),
          seq.stop.spkr = rep(NA,nrow(subdata.chi)))
      seq.num <- 1
      for (j in 1:nrow(chi.vocs)) {
        curr.start <- chi.vocs$start[j]
        curr.stop <- chi.vocs$stop[j]
        curr.spk <- "CHI"
        curr.utt <- chi.vocs$uttid[j]
        # First check if this chi voc is already in a sequence. If so, skip it
        if (seq.num > 1) {
          prev.seq <- which(chi.vocs$seq.num == seq.num - 1)[1]
          prev.seq.start <- chi.vocs$seq.start[prev.seq]
          prev.seq.stop <- chi.vocs$seq.stop[prev.seq]
          if (curr.start >= prev.seq.start & curr.stop <= prev.seq.stop) {
            chi.vocs$seq.start[j] <- chi.vocs$seq.start[prev.seq]
            chi.vocs$seq.start.spkr[j] <- chi.vocs$seq.start.spkr[prev.seq]
            chi.vocs$seq.stop[j] <- chi.vocs$seq.stop[prev.seq]
            chi.vocs$seq.stop.spkr[j] <- chi.vocs$seq.stop.spkr[prev.seq]
            chi.vocs$seq.num[j] <- chi.vocs$seq.num[prev.seq]
            next
          }
        }
        # We start a loop to look for related utterances to the LEFT
        stop.looking.left <- FALSE
        # Look first for prior turns from that STOP
        #    - earliest: within the maximum gap allowed before the curr utt begins
        #    - latest: up to the limit on vocal overlap or the end of
        #              the curr utt (whichever comes first)
        while (stop.looking.left == FALSE) {
          candidate.vocs <- subdata %>%
            filter(uttid != curr.utt &
                     start <= curr.start &
                     stop >= curr.start - allowed.gap &
                     stop <= min(curr.stop, (curr.start + allowed.overlap))) %>%
            arrange(start)
          if (nrow(candidate.vocs) > 0) {
            # continue with the earliest (first occurring) candidate
            curr.start <- candidate.vocs$start[1]
            curr.stop <- candidate.vocs$stop[1]
            curr.spk <- candidate.vocs$speaker[1]
            curr.utt <- candidate.vocs$uttid[1]
          } else {
            stop.looking.left <- TRUE
          }
        }
        seq.start <- curr.start
        seq.start.spkr <- curr.spk

        # We start a loop to look for related utterances to the RIGHT
        curr.start <- chi.vocs$start[j]
        curr.stop <- chi.vocs$stop[j]
        curr.spk <- "CHI"
        stop.looking.right <- FALSE
        # Look first for turn transitions that START
        #    - earliest: within the allowed vocal overlap over the current utt,
        #              up to its start time (whichever comes later)
        #    - latest: before the maximum allowed gap after the curr utt ends
        while(stop.looking.right == FALSE) {
          candidate.vocs <- subdata %>%
            filter(uttid != curr.utt &
                     stop >= curr.stop &
                     start >= max(curr.start, (curr.stop - allowed.overlap)) &
                     start <= curr.stop + allowed.gap) %>%
            arrange(-stop)
          if (nrow(candidate.vocs) > 0) {
            # continue with the earliest (first occurring) candidate
            curr.start <- candidate.vocs$start[1]
            curr.stop <- candidate.vocs$stop[1]
            curr.spk <- candidate.vocs$speaker[1]
            curr.utt <- candidate.vocs$uttid[1]
          } else {
            stop.looking.right <- TRUE
          }
        }
        seq.stop <- curr.stop
        seq.stop.spkr <- curr.spk

        # Check if the "sequence" is actually just 1+ CHI utterances
        if (seq.start == chi.vocs$start[j] & seq.stop == chi.vocs$stop[j]) {
          chi.vocs$seq.stop[j] <-  0
          chi.vocs$seq.stop.spkr[j] <- "NONE"
          chi.vocs$seq.start[j] <- 0
          chi.vocs$seq.start.spkr[j] <- "NONE"
        } else if (length(unique(subset(subdata, start >= seq.start &
                                        stop <= seq.stop)$speaker)) == 1) {
          chi.vocs$seq.stop[j] <-  0
          chi.vocs$seq.stop.spkr[j] <- "NONE"
          chi.vocs$seq.start[j] <- 0
          chi.vocs$seq.start.spkr[j] <- "NONE"
        } else {
          chi.vocs$seq.stop[j] <- seq.stop
          chi.vocs$seq.stop.spkr[j] <- seq.stop.spkr
          chi.vocs$seq.start[j] <- seq.start
          chi.vocs$seq.start.spkr[j] <- seq.start.spkr
          # Write the sequence number
          chi.vocs$seq.num[j] <- seq.num
          seq.num <- seq.num + 1
        }
      }
      turn.sequences <- bind_rows(turn.sequences, chi.vocs)
    }
  }
}

# Sequence duration summary
turn.sequences <- turn.sequences %>%
  filter(!(is.na(seq.num))) %>%
  mutate(seq.dur = (seq.stop - seq.start)/60000)
turn.sequences.overview <- turn.sequences %>%
  group_by(aclew_child_id, sample, segment, seq.num, seq.start, seq.stop, seq.dur) %>%
  summarise(n_cvcs_seq = n()) %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  left_join(spkrs.per.seg.all, by = c("aclew_child_id", "segment", "sample")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName"))
turn.seq.by.sample <- turn.sequences.overview %>%
  group_by(sample) %>%
  summarise(mean.tsq_dur = mean(seq.dur),
            median.tsq_dur = median(seq.dur),
            min.tsq_dur = min(seq.dur),
            max.tsq_dur = max(seq.dur),
            mean.cvcs = mean(n_cvcs_seq),
            median.cvcs = median(n_cvcs_seq),
            min.cvcs = min(n_cvcs_seq),
            max.cvcs = max(n_cvcs_seq))
turn.seq.by.sample.by.child <- turn.sequences.overview %>%
  group_by(aclew_child_id, sample) %>%
  summarise(mean.tsq_dur = mean(seq.dur),
            median.tsq_dur = median(seq.dur),
            min.tsq_dur = min(seq.dur),
            max.tsq_dur = max(seq.dur),
            mean.cvcs = mean(n_cvcs_seq),
            median.cvcs = median(n_cvcs_seq),
            min.cvcs = min(n_cvcs_seq),
            max.cvcs = max(n_cvcs_seq))

# Delta of chi voc and TCDS minutes
cvc.ovc.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker == "CHI" & speaker == tier) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(cvc_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 5, cvc_min = 0)) %>%
  mutate(cvc_mph = (cvc_min/segment_dur)*60) %>%
  left_join(dplyr::select(tds.per.seg.rand, c("aclew_child_id", "segment", "tds_mph")),
            by = c("aclew_child_id", "segment")) %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  mutate(cvc.ovc.delta = cvc_mph-tds_mph,
         cvc.ovc.delta.norm = cvc.ovc.delta/(cvc_mph+tds_mph)) %>%
  left_join(spkrs.per.seg.all, by = c("aclew_child_id", "segment")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName")) %>%
  arrange(aclew_child_id, segment)

cvc.ovc.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker == "CHI" & speaker == tier) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(cvc_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 5, cvc_min = 0)) %>%
  mutate(cvc_mph = (cvc_min/segment_dur)*60) %>%
  left_join(dplyr::select(tds.per.seg.nonrand, c("aclew_child_id", "segment", "tds_mph")),
            by = c("aclew_child_id", "segment")) %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  mutate(cvc.ovc.delta = cvc_mph-tds_mph,
         cvc.ovc.delta.norm = cvc.ovc.delta/(cvc_mph+tds_mph)) %>%
  left_join(spkrs.per.seg.all,
            by = c("aclew_child_id", "segment", "sample", "sample_type")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName")) %>%
  arrange(aclew_child_id, segment)

# Subset the samples for analysis
turn.transitions.rand_and_tt <- filter(turn.transitions.overview,
                                       sample == "random" | sample == "turn-taking")
turn.sequences.rand_and_tt <- filter(turn.sequences.overview,
                                     sample == "random" | sample == "turn-taking")
cvc.ovc.per.seg.rand_and_tt <- bind_rows(mutate(cvc.ovc.per.seg.rand, sample = "random"),
                                         filter(cvc.ovc.per.seg.nonrand,
                                                sample == "turn-taking"))
cvc.ovc.per.seg.rand_and_tt.nonas <- filter(cvc.ovc.per.seg.rand_and_tt,
                                            !(is.na(cvc.ovc.delta.norm)))

## Prepare variables for modeling
turn.transitions.rand <- filter(turn.transitions.rand_and_tt, sample == "random")
turn.transitions.rand$child_sex <- as.factor(turn.transitions.rand$child_sex)
turn.transitions.rand$mat_ed <- as.factor(turn.transitions.rand$mat_ed)
nspkrs.m <- mean(turn.transitions.rand$n_spkrs_clip)
nspkrs.sd <- sd(turn.transitions.rand$n_spkrs_clip)
turn.transitions.rand <- turn.transitions.rand %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
turn.transitions.rand$stthr.tri <- factor(turn.transitions.rand$stthr.tri,
                                          levels = c("midday", "morning", "afternoon"))
turn.transitions.rand$stthr.tri.a <- factor(turn.transitions.rand$stthr.tri,
                                            levels = c("afternoon", "midday", "morning"))

turn.sequences.rand <- filter(turn.sequences.rand_and_tt, sample == "random")
turn.sequences.rand$child_sex <- as.factor(turn.sequences.rand$child_sex)
turn.sequences.rand$mat_ed <- as.factor(turn.sequences.rand$mat_ed)
nspkrs.m <- mean(turn.sequences.rand$n_spkrs_clip)
nspkrs.sd <- sd(turn.sequences.rand$n_spkrs_clip)
turn.sequences.rand <- turn.sequences.rand %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
turn.sequences.rand$stthr.tri <- factor(turn.sequences.rand$stthr.tri,
                                        levels = c("midday", "morning", "afternoon"))
turn.sequences.rand$stthr.tri.a <- factor(turn.sequences.rand$stthr.tri,
                                          levels = c("afternoon", "midday", "morning"))

cvc.ovc.per.seg.randnonas <- filter(cvc.ovc.per.seg.rand_and_tt.nonas, sample == "random")
cvc.ovc.per.seg.randnonas$child_sex <- as.factor(cvc.ovc.per.seg.randnonas$child_sex)
cvc.ovc.per.seg.randnonas$mat_ed <- as.factor(cvc.ovc.per.seg.randnonas$mat_ed)
nspkrs.m <- mean(turn.sequences.rand$n_spkrs_clip)
nspkrs.sd <- sd(turn.sequences.rand$n_spkrs_clip)
cvc.ovc.per.seg.randnonas <- cvc.ovc.per.seg.randnonas %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12)

cvc.ovc.per.seg.randnonas.bychild <- cvc.ovc.per.seg.randnonas %>%
  group_by(aclew_child_id) %>%
  summarise(mean.ratio = mean(cvc.ovc.delta.norm))

# tt clips
turn.transitions.tt <- filter(turn.transitions.rand_and_tt, sample == "turn-taking")
turn.transitions.tt$child_sex <- as.factor(turn.transitions.tt$child_sex)
turn.transitions.tt$mat_ed <- as.factor(turn.transitions.tt$mat_ed)
nspkrs.m <- mean(turn.transitions.tt$n_spkrs_clip)
nspkrs.sd <- sd(turn.transitions.tt$n_spkrs_clip)
turn.transitions.tt <- turn.transitions.tt %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
turn.transitions.tt$stthr.tri <- factor(turn.transitions.tt$stthr.tri,
                                        levels = c("midday", "morning", "afternoon"))
turn.transitions.tt$stthr.tri.a <- factor(turn.transitions.tt$stthr.tri,
                                          levels = c("afternoon", "midday", "morning"))

turn.sequences.tt <- filter(turn.sequences.rand_and_tt, sample == "turn-taking")
turn.sequences.tt$child_sex <- as.factor(turn.sequences.tt$child_sex)
turn.sequences.tt$mat_ed <- as.factor(turn.sequences.tt$mat_ed)
nspkrs.m <- mean(turn.sequences.tt$n_spkrs_clip)
nspkrs.sd <- sd(turn.sequences.tt$n_spkrs_clip)
turn.sequences.tt <- turn.sequences.tt %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
turn.sequences.tt$stthr.tri <- factor(turn.sequences.tt$stthr.tri,
                                      levels = c("midday", "morning", "afternoon"))
turn.sequences.tt$stthr.tri.a <- factor(turn.sequences.tt$stthr.tri,
                                        levels = c("afternoon", "midday", "morning"))

cvc.ovc.per.seg.ttnonas <- filter(cvc.ovc.per.seg.rand_and_tt.nonas,
                                  sample == "turn-taking")
cvc.ovc.per.seg.ttnonas$child_sex <- as.factor(cvc.ovc.per.seg.ttnonas$child_sex)
cvc.ovc.per.seg.ttnonas$mat_ed <- as.factor(cvc.ovc.per.seg.ttnonas$mat_ed)
nspkrs.m <- mean(cvc.ovc.per.seg.ttnonas$n_spkrs_clip)
nspkrs.sd <- sd(cvc.ovc.per.seg.ttnonas$n_spkrs_clip)
cvc.ovc.per.seg.ttnonas <- cvc.ovc.per.seg.ttnonas %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12)

cvc.ovc.per.seg.ttnonas.bychild <- cvc.ovc.per.seg.ttnonas %>%
  group_by(aclew_child_id) %>%
  summarise(mean.ratio = mean(cvc.ovc.delta.norm))
```

```{r interaction_plots, message=FALSE, warning=FALSE, paged.print=FALSE}
# Graph the basic turn taking rate info
# CHI-OTH transitions per minute
chi.oth.tts.rand_and_tt <- ggplot(turn.transitions.rand_and_tt,
                          aes(x = age_mo_round, y = n.c_o.tpm, lty = sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, sample),
                   color = sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = sample, color = sample), method = "lm") +
  ylab("CHI-OTH tts/min") + xlab("")	+
  ggtitle("TC-O transitions") +
  scale_y_continuous(limits=c(0,30),
                     breaks=seq(0,30,5)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,30),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

# OTH-CHI transitions per minute
oth.chi.tts.rand_and_tt <- ggplot(turn.transitions.rand_and_tt,
                          aes(x = age_mo_round, y = n.o_c.tpm, lty = sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, sample),
                   color = sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = sample, color = sample), method = "lm") +
  ylab("OTH-CHI tts/min") + xlab("Child age (mo)")	+
  ggtitle("O-TC transitions") +
  scale_y_continuous(limits=c(0,30),
                     breaks=seq(0,30,5)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,30),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

# Graph the basic sequence duration info
# plot per-clip averages so it's consistent with the rest
turn.sequences.rand_and_tt.byclip <- turn.sequences.rand_and_tt %>%
  group_by(aclew_child_id, age_mo_round, sample, segment) %>%
  summarise(m.seqdur.sec = mean(seq.dur*60))
seq.dur.rand_and_tt <- ggplot(turn.sequences.rand_and_tt.byclip,
                          aes(x = age_mo_round, y = m.seqdur.sec, lty = sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, sample),
                   color = sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = sample, color = sample), method = "lm") +
  ylab("Seq. dur. (sec)") + xlab("")	+
  ggtitle("Sequence duration") +
  scale_y_continuous(limits=c(0,60),
                     breaks=seq(0,60,20)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,60),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))
```

```{r fig7, echo=FALSE, fig.cap="By-child estimates of target-child-to-other contingent responses (left), other-to-target-child contingent responses (middle), and the duration of interactional sequences (right). Each boxplot represents the variance across clips within the random (dark purple; solid) or turn taking (light green; dashed) samples for each child. Bands on the linear trends show 95% confidence intervals.", message=FALSE, warning=FALSE, fig.height=2}
grid.arrange(chi.oth.tts.rand_and_tt, oth.chi.tts.rand_and_tt,
             seq.dur.rand_and_tt, nrow=1, ncol=3)
```

```{r tc-ott_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## CHI-OTH tts/min random sample ####
c_o.tpm.random.distribution <- ggplot(turn.transitions.rand,
                            aes(round(n.c_o.tpm,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("TC-O transitions/min") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "c_o_tpm_random_distribution.png"),
       plot = c_o.tpm.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(turn.transitions.rand$n.c_o.tpm,0))^2
#mean(round(turn.transitions.rand$n.c_o.tpm,0))
# mean isn't much smaller than variance
# zero inflated
c_o.tpm.rand.zinb <- glmmTMB(round(n.c_o.tpm,0) ~
                               tchiyr.std +
                               stthr.tri +
                               hsz.std +
                               nsk.std +
                               tchiyr.std:stthr.tri +
                               tchiyr.std:hsz.std +
                               tchiyr.std:nsk.std +
                               (1|aclew_child_id),
                             data=turn.transitions.rand,
                             ziformula=~nsk.std,
                             family="nbinom1")
#c_o.tpm.rand.zinb.res = simulateResiduals(c_o.tpm.rand.zinb)
#plot(c_o.tpm.rand.zinb.res, rank = T) # (manually saved)
#summary(c_o.tpm.rand.zinb)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)  
#(Intercept)                    -0.1257     0.5037  -0.250   0.8029  
#tchiyr.std                      0.8867     0.6063   1.462   0.1436  
#stthr.trimorning                0.4825     0.4500   1.072   0.2836  
#stthr.triafternoon              0.3405     0.3993   0.853   0.3938  
#hsz.std                        -0.1728     0.4541  -0.381   0.7035  
#nsk.std                        -0.1769     0.1746  -1.014   0.3107  
#tchiyr.std:stthr.trimorning    -0.1398     0.4751  -0.294   0.7686  
#tchiyr.std:stthr.triafternoon  -1.0820     0.4443  -2.436   0.0149 *
#tchiyr.std:hsz.std              0.1109     0.5569   0.199   0.8421  
#tchiyr.std:nsk.std              0.5639     0.2270   2.484   0.0130 *
#---
#Zero-inflation model:
#            Estimate Std. Error z value Pr(>|z|)
#(Intercept)   -116.7    53056.2  -0.002    0.998
#nsk.std       -100.0    52343.8  -0.002    0.998
# save for reporting
c_o.tpm.rand.zinb.COEF.age.morn <-
  coef(summary(c_o.tpm.rand.zinb))[[1]]["tchiyr.std:stthr.trimorning",] 
c_o.tpm.rand.zinb.COEF.age.aft <-
  coef(summary(c_o.tpm.rand.zinb))[[1]]["tchiyr.std:stthr.triafternoon",] 
c_o.tpm.rand.zinb.COEF.age.nsk <-
  coef(summary(c_o.tpm.rand.zinb))[[1]]["tchiyr.std:nsk.std",]

# test the other two-way effects of time of day
c_o.tpm.rand.zinb.v2 <- glmmTMB(round(n.c_o.tpm,0) ~
                                  tchiyr.std +
                                  stthr.tri.a +
                                  hsz.std +
                                  nsk.std +
                                  tchiyr.std:stthr.tri.a +
                                  tchiyr.std:hsz.std +
                                  tchiyr.std:nsk.std +
                                  (1|aclew_child_id),
                                data=turn.transitions.rand,
                                ziformula=~nsk.std,
                                family="nbinom1")
#summary(c_o.tpm.rand.zinb.v2)
#stthr.tri.amidday              -0.3405     0.3993  -0.853   0.3938  
#stthr.tri.amorning              0.1420     0.3254   0.436   0.6626  
#tchiyr.std:stthr.tri.amidday    1.0820     0.4443   2.436   0.0149 *
#tchiyr.std:stthr.tri.amorning   0.9422     0.3746   2.515   0.0119 *
# save for reporting
c_o.tpm.rand.zinb.v2.COEF.aft.vs.morn <-
  coef(summary(c_o.tpm.rand.zinb.v2))[[1]]["stthr.tri.amorning",] 
c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn <-
  coef(summary(c_o.tpm.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",] 
c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd <-
  coef(summary(c_o.tpm.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amidday",] 

## CHI-OTH tts/min tt sample ####
c_o.tpm.tt.distribution <- ggplot(turn.transitions.tt,
                            aes(round(n.c_o.tpm,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("TC-O transitions/min") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "c_o_tpm_turntaking_distribution.png"),
       plot = c_o.tpm.tt.distribution,
       width = 8, height = 6, dpi = 300)
#ggplot(turn.transitions.tt, aes(round(n.c_o.tpm,0))) + geom_histogram()
#sd(round(turn.transitions.tt$n.c_o.tpm,0))^2
#mean(round(turn.transitions.tt$n.c_o.tpm,0))
# mean isn't much smaller than variance
# not zero-inflated (nature of sample)
c_o.tpm.tt.nb <- glmmTMB(round(n.c_o.tpm,0) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=turn.transitions.tt,
                         family="nbinom1")
#c_o.tpm.tt.nb.res = simulateResiduals(c_o.tpm.tt.nb)
#plot(c_o.tpm.tt.nb.res, rank = T) # (manually saved)
#summary(c_o.tpm.tt.nb)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    1.78448    0.28828   6.190 <0.0001 ***
#tchiyr.std                     0.11866    0.29273   0.405 0.6852    
#stthr.trimorning               0.05827    0.31932   0.182 0.8552    
#stthr.triafternoon             0.11001    0.26991   0.408 0.6836    
#hsz.std                       -0.03938    0.22998  -0.171 0.8640    
#nsk.std                       -0.21384    0.11634  -1.838 0.0661 .  
#tchiyr.std:stthr.trimorning   -0.03954    0.29729  -0.133 0.8942    
#tchiyr.std:stthr.triafternoon -0.18839    0.25152  -0.749 0.4539    
#tchiyr.std:hsz.std            -0.19196    0.28233  -0.680 0.4966    
#tchiyr.std:nsk.std             0.05446    0.13186   0.413 0.6796    
# save for reporting
c_o.tpm.tt.nb.COEF.nsk <-
  coef(summary(c_o.tpm.tt.nb))[[1]]["nsk.std",] 

# test the other two-way effects of time of day
c_o.tpm.tt.nb.v2 <- glmmTMB(round(n.c_o.tpm,0) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=turn.transitions.tt,
                            family="nbinom1")
#summary(c_o.tpm.tt.nb.v2)
#stthr.tri.amidday             -0.11002    0.26991  -0.408              0.6835    
#stthr.tri.amorning            -0.05176    0.24239  -0.214              0.8309    
#tchiyr.std:stthr.tri.amidday   0.18840    0.25152   0.749              0.4538    
#tchiyr.std:stthr.tri.amorning  0.14885    0.26612   0.559              0.5759    
# no results to save for reporting
```

```{r tc-ott_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## CHI-OTH tts/min random sample ####
c_o.tpm.rand.gaus <- glmmTMB(log(n.c_o.tpm+2) ~
                               tchiyr.std +
                               stthr.tri +
                               hsz.std +
                               nsk.std +
                               tchiyr.std:stthr.tri +
                               tchiyr.std:hsz.std +
                               tchiyr.std:nsk.std +
                               (1|aclew_child_id),
                             data=turn.transitions.rand)
#c_o.tpm.rand.gaus.res = simulateResiduals(c_o.tpm.rand.gaus)
#plot(c_o.tpm.rand.gaus.res, rank = T) # (manually saved)
#summary(c_o.tpm.rand.gaus)
#Conditional model:
#                               Estimate Std. Error z value           Pr(>|z|)    
#(Intercept)                    1.056534   0.135493   7.798 0.0000000000000063 ***
#tchiyr.std                     0.250150   0.157480   1.588            0.11218    
#stthr.trimorning               0.137954   0.116248   1.187            0.23534    
#stthr.triafternoon             0.013519   0.102405   0.132            0.89498    
#hsz.std                       -0.110842   0.135817  -0.816            0.41444    
#nsk.std                        0.087300   0.056058   1.557            0.11940    
#tchiyr.std:stthr.trimorning   -0.025362   0.125456  -0.202            0.83979    
#tchiyr.std:stthr.triafternoon -0.303130   0.111001  -2.731            0.00632 ** 
#tchiyr.std:hsz.std             0.002589   0.164390   0.016            0.98744    
#tchiyr.std:nsk.std             0.094462   0.070742   1.335            0.18178
# DIFFERENCES?
# broadly similar to z-i nb model; no age * nsk effect

# test the other two-way effects of time of day
c_o.tpm.rand.gaus.v2 <- glmmTMB(log(n.c_o.tpm+2) ~
                                  tchiyr.std +
                                  stthr.tri.a +
                                  hsz.std +
                                  nsk.std +
                                  tchiyr.std:stthr.tri.a +
                                  tchiyr.std:hsz.std +
                                  tchiyr.std:nsk.std +
                                  (1|aclew_child_id),
                                data=turn.transitions.rand)
#summary(c_o.tpm.rand.gaus.v2)
#stthr.tri.amidday             -0.013520   0.102406  -0.132 0.89496    
#stthr.tri.amorning             0.124433   0.100790   1.235 0.21699    
#tchiyr.std:stthr.tri.amidday   0.303131   0.111001   2.731 0.00632 ** 
#tchiyr.std:stthr.tri.amorning  0.277769   0.107167   2.592 0.00954 ** 
# DIFFERENCES
# very similar to z-i nb model


## CHI-OTH tts/min tt sample ####
c_o.tpm.tt.gaus <- glmmTMB(log(n.c_o.tpm+2) ~
                           tchiyr.std +
                           stthr.tri.a +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri.a +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=turn.transitions.tt)
#c_o.tpm.tt.gaus.res = simulateResiduals(c_o.tpm.tt.gaus)
#plot(c_o.tpm.tt.gaus.res, rank = T) # (manually saved)
#summary(c_o.tpm.tt.gaus)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    2.06738    0.20284  10.192 <0.0001 ***
#tchiyr.std                    -0.01995    0.22908  -0.087 0.9306    
#stthr.tri.amidday             -0.10853    0.20987  -0.517 0.6050    
#stthr.tri.amorning            -0.08067    0.20332  -0.397 0.6915    
#hsz.std                       -0.02492    0.20253  -0.123 0.9021    
#nsk.std                       -0.17907    0.09640  -1.857 0.0632 .  
#tchiyr.std:stthr.tri.amidday   0.11148    0.20262   0.550 0.5822    
#tchiyr.std:stthr.tri.amorning  0.09163    0.21556   0.425 0.6708    
#tchiyr.std:hsz.std            -0.16794    0.24828  -0.676 0.4988    
#tchiyr.std:nsk.std             0.09030    0.11495   0.786 0.4321  
# DIFFERENCES
# very similar to nb model

# test the other two-way effects of time of day
c_o.tpm.tt.gaus.v2 <- glmmTMB(log(n.c_o.tpm+2) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=turn.transitions.tt)
#summary(c_o.tpm.tt.gaus.v2)
#stthr.tri.amidday             -0.10853    0.20987  -0.517  0.6050    
#stthr.tri.amorning            -0.08067    0.20332  -0.397  0.6915    
#tchiyr.std:stthr.tri.amidday   0.11148    0.20262   0.550  0.5822    
#tchiyr.std:stthr.tri.amorning  0.09163    0.21556   0.425  0.6708    
# DIFFERENCES?
# very similar to nb model

# Write model results out for input to shiny
c_o.tpm.models <- bind_rows(
  broom.mixed::tidy(c_o.tpm.rand.zinb) %>%
    mutate(model = "c_o.tpm_random_z-inb"),
  broom.mixed::tidy(c_o.tpm.rand.zinb.v2) %>%
    mutate(model = "c_o.tpm_random_z-inb.v2"),
  broom.mixed::tidy(c_o.tpm.rand.gaus) %>%
    mutate(model = "c_o.tpm_random_log_gaus"),
  broom.mixed::tidy(c_o.tpm.rand.gaus.v2) %>%
    mutate(model = "c_o.tpm_random_log_gaus.v2"),
  broom.mixed::tidy(c_o.tpm.tt.nb) %>%
    mutate(model = "c_o.tpm_turntaking_nb"),
  broom.mixed::tidy(c_o.tpm.tt.nb.v2) %>%
    mutate(model = "c_o.tpm_turntaking_nb.v2"),
  broom.mixed::tidy(c_o.tpm.tt.gaus) %>%
    mutate(model = "c_o.tpm_turntaking_log_gaus"),
  broom.mixed::tidy(c_o.tpm.tt.gaus.v2) %>%
    mutate(model = "c_o.tpm_turntaking_log_gaus.v2"))
```

Other speakers responded contingently to the target children's vocalizations at an average rate of `r round(mean(turn.transitions.rand$n.c_o.tpm),2)` turn transitions per minute (median = `r round(median(turn.transitions.rand$n.c_o.tpm),2)`; range = `r round(min(turn.transitions.rand$n.c_o.tpm),2)`--`r round(max(turn.transitions.rand$n.c_o.tpm),2)`; [Figure 7](#fig7)). We modeled TC--O transitions per minute in the random clips with a zero-inflated negative binomial regression. The rate of contingent responses to target child vocalizations varied across the day by target child age: older children heard significantly more contingent responses around midday (B = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd[[1]],2)`, SD = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd[[2]],2)`, z = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd[[3]],2)`, p = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd[[4]],2)`) and in the morning (B = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn[[1]],2)`, SD = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn[[2]],2)`, z = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn[[3]],2)`, p = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn[[4]],2)`), compared to the afternoon, with no significant difference between morning and midday (p = `r round(c_o.tpm.rand.zinb.COEF.age.morn[[4]],2)`). Older target children also heard significantly more contingent responses then younger ones when there were more speakers present (B = `r round(c_o.tpm.rand.zinb.COEF.age.nsk[[1]],2)`, SD = `r round(c_o.tpm.rand.zinb.COEF.age.nsk[[2]],2)`, z = `r round(c_o.tpm.rand.zinb.COEF.age.nsk[[3]],2)`, p = `r round(c_o.tpm.rand.zinb.COEF.age.nsk[[4]],2)`). There were no further significant effects in the count or zero-inflation models.

```{r o-tctt_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## OTH-CHI tts/min random sample ####
o_c.tpm.random.distribution <- ggplot(turn.transitions.rand,
                            aes(round(n.o_c.tpm,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("O-TC transitions/min") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "o_c_tpm_random_distribution.png"),
       plot = o_c.tpm.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(turn.transitions.rand$n.o_c.tpm,0))^2
#mean(round(turn.transitions.rand$n.o_c.tpm,0))
# mean isn't much smaller than variance
# zero-inflated
o_c.tpm.rand.zinb <- glmmTMB(round(n.o_c.tpm,0) ~
                               tchiyr.std +
                               stthr.tri +
                               hsz.std +
                               nsk.std +
                               tchiyr.std:stthr.tri +
                               tchiyr.std:hsz.std +
                               tchiyr.std:nsk.std +
                               (1|aclew_child_id),
                             data=turn.transitions.rand,
                             ziformula=~nsk.std,
                             family="nbinom1")
#o_c.tpm.rand.zinb.res = simulateResiduals(o_c.tpm.rand.zinb)
#plot(o_c.tpm.rand.zinb.res, rank = T) # (saved manually)
#summary(o_c.tpm.rand.zinb)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)   
#(Intercept)                    -0.4586     0.5436  -0.844  0.39890   
#tchiyr.std                      1.1417     0.6570   1.738  0.08226 . 
#stthr.trimorning                0.3179     0.4878   0.652  0.51462   
#stthr.triafternoon              0.4948     0.4082   1.212  0.22542   
#hsz.std                        -0.2025     0.4947  -0.409  0.68226   
#nsk.std                        -0.1414     0.1784  -0.793  0.42796   
#tchiyr.std:stthr.trimorning    -0.1238     0.5059  -0.245  0.80671   
#tchiyr.std:stthr.triafternoon  -1.4569     0.4647  -3.135  0.00172 **
#tchiyr.std:hsz.std              0.1412     0.6070   0.233  0.81610   
#tchiyr.std:nsk.std              0.5175     0.2247   2.303  0.02130 * 
#---
#Zero-inflation model:
#            Estimate Std. Error z value Pr(>|z|)
#(Intercept)  -115.46   43943.60  -0.003    0.998
#nsk.std       -98.63   42142.48  -0.002    0.998
# save for reporting
o_c.tpm.rand.zinb.COEF.age <-
  coef(summary(o_c.tpm.rand.zinb))[[1]]["tchiyr.std",]
o_c.tpm.rand.zinb.COEF.age.morn <-
  coef(summary(o_c.tpm.rand.zinb))[[1]]["tchiyr.std:stthr.trimorning",]
o_c.tpm.rand.zinb.COEF.age.aft <-
  coef(summary(o_c.tpm.rand.zinb))[[1]]["tchiyr.std:stthr.triafternoon",]
o_c.tpm.rand.zinb.COEF.age.nsk <-
  coef(summary(o_c.tpm.rand.zinb))[[1]]["tchiyr.std:nsk.std",]

# test the other two-way effects of time of day
o_c.tpm.rand.zinb.v2 <- glmmTMB(round(n.o_c.tpm,0) ~
                                  tchiyr.std +
                                  stthr.tri.a +
                                  hsz.std +
                                  nsk.std +
                                  tchiyr.std:stthr.tri.a +
                                  tchiyr.std:hsz.std +
                                  tchiyr.std:nsk.std +
                                  (1|aclew_child_id),
                                data=turn.transitions.rand,
                                ziformula=~nsk.std,
                                family="nbinom1")
#summary(o_c.tpm.rand.zinb.v2)
#stthr.tri.amidday             -0.49479    0.40816  -1.212  0.22542   
#stthr.tri.amorning            -0.17693    0.36072  -0.490  0.62379   
#tchiyr.std:stthr.tri.amidday   1.45689    0.46472   3.135  0.00172 **
#tchiyr.std:stthr.tri.amorning  1.33312    0.41759   3.192  0.00141 **
# save for reporting
o_c.tpm.rand.zinb.v2.COEF.morn <-
  coef(summary(o_c.tpm.rand.zinb.v2))[[1]]["stthr.tri.amorning",]
o_c.tpm.rand.zinb.v2.COEF.age.morn <-
  coef(summary(o_c.tpm.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",]
o_c.tpm.rand.zinb.v2.COEF.age.midd <-
  coef(summary(o_c.tpm.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amidday",]

## OTH-CHI tts/min tt sample ####
o_c.tpm.tt.distribution <- ggplot(turn.transitions.tt,
                            aes(round(n.o_c.tpm,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("O-TC transitions/min") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "o_c_tpm_turntaking_distribution.png"),
       plot = o_c.tpm.tt.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(turn.transitions.tt$n.o_c.tpm,0))^2
#mean(round(turn.transitions.tt$n.o_c.tpm,0))
# mean is much smaller than variance
# not really zero-inflated
o_c.tpm.tt.nb <- glmmTMB(round(n.o_c.tpm,0) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=turn.transitions.tt,
                         family="nbinom1")
#o_c.tpm.tt.nb.res = simulateResiduals(o_c.tpm.tt.nb)
#plot(o_c.tpm.tt.nb.res, rank = T) # (manually saved)
#summary(o_c.tpm.tt.nb)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    1.84121    0.29135   6.319 < 0.0001 ***
#tchiyr.std                     0.05962    0.29556   0.202 0.8401    
#stthr.trimorning              -0.04921    0.33317  -0.148 0.8826    
#stthr.triafternoon             0.02709    0.28235   0.096 0.9236    
#hsz.std                       -0.03631    0.23216  -0.156 0.8757    
#nsk.std                       -0.22871    0.12170  -1.879 0.0602 .  
#tchiyr.std:stthr.trimorning    0.12037    0.30574   0.394 0.6938    
#tchiyr.std:stthr.triafternoon -0.07718    0.26007  -0.297 0.7667    
#tchiyr.std:hsz.std            -0.18813    0.28410  -0.662 0.5078    
#tchiyr.std:nsk.std             0.08522    0.13646   0.624 0.5323
# save for reporting
o_c.tpm.tt.nb.COEF.nsk <-
  coef(summary(o_c.tpm.tt.nb))[[1]]["nsk.std",]

# test the other two-way effects of time of day
o_c.tpm.tt.nb.v2 <- glmmTMB(round(n.o_c.tpm,0) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=turn.transitions.tt,
                            family="nbinom1")
#summary(o_c.tpm.tt.nb.v2)
#stthr.tri.amidday             -0.02712    0.28236  -0.096             0.9235    
#stthr.tri.amorning            -0.07632    0.25647  -0.298             0.7660    
#tchiyr.std:stthr.tri.amidday   0.07718    0.26007   0.297             0.7666    
#tchiyr.std:stthr.tri.amorning  0.19755    0.27015   0.731             0.4646    
# no results to save for reporting
```

```{r o-tctt_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## OTH-CHI tts/min random sample ####
o_c.tpm.rand.gaus <- glmmTMB(log(n.o_c.tpm+2) ~
                               tchiyr.std +
                               stthr.tri +
                               hsz.std +
                               nsk.std +
                               tchiyr.std:stthr.tri +
                               tchiyr.std:hsz.std +
                               tchiyr.std:nsk.std +
                               (1|aclew_child_id),
                             data=turn.transitions.rand)
#o_c.tpm.rand.gaus.res = simulateResiduals(o_c.tpm.rand.gaus)
#plot(o_c.tpm.rand.gaus.res, rank = T) # (saved manually)
#summary(o_c.tpm.rand.gaus)
#Conditional model:
#                                 Estimate  Std. Error z value Pr(>|z|)    
#(Intercept)                    1.00641393  0.12448510   8.085 <0.0001 ***
#tchiyr.std                     0.22740872  0.14462973   1.572 0.11587    
#stthr.trimorning               0.10010749  0.10843729   0.923 0.35591    
#stthr.triafternoon             0.00009137  0.09549393   0.001 0.99924    
#hsz.std                       -0.11953003  0.12408216  -0.963 0.33539    
#nsk.std                        0.06939389  0.05214713   1.331 0.18328    
#tchiyr.std:stthr.trimorning   -0.01939578  0.11702461  -0.166 0.86836    
#tchiyr.std:stthr.triafternoon -0.28596439  0.10350542  -2.763 0.00573 ** 
#tchiyr.std:hsz.std            -0.02916843  0.15025795  -0.194 0.84608    
#tchiyr.std:nsk.std             0.07454357  0.06594419   1.130 0.25831 
# DIFFERENCES?
# broadly similar to z-i nb model, but with no age * nsk interaction

# test the other two-way effects of time of day
o_c.tpm.rand.gaus.v2 <- glmmTMB(log(n.o_c.tpm+2) ~
                                  tchiyr.std +
                                  stthr.tri.a +
                                  hsz.std +
                                  nsk.std +
                                  tchiyr.std:stthr.tri.a +
                                  tchiyr.std:hsz.std +
                                  tchiyr.std:nsk.std +
                                  (1|aclew_child_id),
                                data=turn.transitions.rand)
#summary(o_c.tpm.rand.gaus.v2)
#stthr.tri.amidday             -0.00009122  0.09549413  -0.001 0.99924    
#stthr.tri.amorning             0.10001752  0.09406177   1.063 0.28764    
#tchiyr.std:stthr.tri.amidday   0.28596268  0.10350565   2.763 0.00573 ** 
#tchiyr.std:stthr.tri.amorning  0.26656607  0.10003252   2.665 0.00770 ** 
# DIFFERENCES?
# very similar to z-i nb model

## OTH-CHI tts/min tt sample ####
o_c.tpm.tt.gaus <- glmmTMB(log(n.o_c.tpm+2) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=turn.transitions.tt)
#o_c.tpm.tt.gaus.res = simulateResiduals(o_c.tpm.tt.gaus)
#plot(o_c.tpm.tt.gaus.res, rank = T) # (manually saved)
#summary(o_c.tpm.tt.gaus)
#Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    2.007746   0.247768   8.103 <0.0001 ***
#tchiyr.std                     0.039817   0.246349   0.162 0.8716    
#stthr.trimorning              -0.091549   0.270425  -0.339 0.7350    
#stthr.triafternoon             0.035551   0.223546   0.159 0.8736    
#hsz.std                       -0.002974   0.208196  -0.014 0.9886    
#nsk.std                       -0.202931   0.102724  -1.975 0.0482 *  
#tchiyr.std:stthr.trimorning    0.166181   0.253668   0.655 0.5124    
#tchiyr.std:stthr.triafternoon -0.003735   0.213868  -0.017 0.9861    
#tchiyr.std:hsz.std            -0.131678   0.255391  -0.516 0.6061    
#tchiyr.std:nsk.std             0.083365   0.121167   0.688 0.4914
# DIFFERENCES?
# very similar to nb model

# test the other two-way effects of time of day
o_c.tpm.tt.gaus.v2 <- glmmTMB(log(n.o_c.tpm+2) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=turn.transitions.tt)
#summary(o_c.tpm.tt.gaus.v2)
#stthr.tri.amidday             -0.035550   0.223546  -0.159              0.8736    
#stthr.tri.amorning            -0.127097   0.215122  -0.591              0.5546    
#tchiyr.std:stthr.tri.amidday   0.003734   0.213868   0.017              0.9861    
#tchiyr.std:stthr.tri.amorning  0.169912   0.227402   0.747              0.4550    
# DIFFERENCES?
# very similar to nb model

# Write model results out for input to shiny
o_c.tpm.models <- bind_rows(
  broom.mixed::tidy(o_c.tpm.rand.zinb) %>%
    mutate(model = "o_c.tpm_random_z-inb"),
  broom.mixed::tidy(o_c.tpm.rand.zinb.v2) %>%
    mutate(model = "o_c.tpm_random_z-inb.v2"),
  broom.mixed::tidy(o_c.tpm.rand.gaus) %>%
    mutate(model = "o_c.tpm_random_log_gaus"),
  broom.mixed::tidy(o_c.tpm.rand.gaus.v2) %>%
    mutate(model = "o_c.tpm_random_log_gaus.v2"),
  broom.mixed::tidy(o_c.tpm.tt.nb) %>%
    mutate(model = "o_c.tpm_turntaking_nb"),
  broom.mixed::tidy(o_c.tpm.tt.nb.v2) %>%
    mutate(model = "o_c.tpm_turntaking_nb.v2"),
  broom.mixed::tidy(o_c.tpm.tt.gaus) %>%
    mutate(model = "o_c.tpm_turntaking_log_gaus"),
  broom.mixed::tidy(o_c.tpm.tt.gaus.v2) %>%
    mutate(model = "o_c.tpm_turntaking_log_gaus.v2"))
```

## Other-to-target-child turn transitions (O--TC)
The children in our sample responded contingently to others' target-child vocalizations at an average rate of `r round(mean(turn.transitions.rand$n.o_c.tpm),2)` turn transitions per minute (median = `r round(median(turn.transitions.rand$n.o_c.tpm),2)`; range = `r round(min(turn.transitions.rand$n.o_c.tpm),2)`--`r round(max(turn.transitions.rand$n.o_c.tpm),2)`; [Figure 7](#fig7)). We modeled O--TC transtions per minute in the random clips with a zero-inflated negative binomial regression. The rate at which target children responded contingently to others (O--TC turn transitions per minute) was similarly influenced by child age and time of day: older children responded contingently to others' utterances significantly more often around midday (B = `r round(o_c.tpm.rand.zinb.v2.COEF.age.midd[[1]],2)`, SD = `r round(o_c.tpm.rand.zinb.v2.COEF.age.midd[[2]],2)`, z = `r round(o_c.tpm.rand.zinb.v2.COEF.age.midd[[3]],2)`, p = `r round(o_c.tpm.rand.zinb.v2.COEF.age.midd[[4]],3)`) and in the morning (B = `r round(o_c.tpm.rand.zinb.v2.COEF.age.morn[[1]],2)`, SD = `r round(o_c.tpm.rand.zinb.v2.COEF.age.morn[[2]],2)`, z = `r round(o_c.tpm.rand.zinb.v2.COEF.age.morn[[3]],2)`, p = `r round(o_c.tpm.rand.zinb.v2.COEF.age.morn[[4]],3)`), compared to the afternoon, with no significant difference between morning and midday (p = `r round(o_c.tpm.rand.zinb.COEF.age.morn[[4]],2)`). Overall, older children responded to others' utterances at a marginally higher rate (B = `r round(o_c.tpm.rand.zinb.COEF.age[[1]],2)`, SD = `r round(o_c.tpm.rand.zinb.COEF.age[[2]],2)`, z = `r round(o_c.tpm.rand.zinb.COEF.age[[3]],2)`, p = `r round(o_c.tpm.rand.zinb.COEF.age[[4]],2)`). Older target children also gave significantly more contingent responses then younger ones when there were more speakers present (B = `r round(o_c.tpm.rand.zinb.COEF.age.nsk[[1]],2)`, SD = `r round(o_c.tpm.rand.zinb.COEF.age.nsk[[2]],2)`, z = `r round(o_c.tpm.rand.zinb.COEF.age.nsk[[3]],2)`, p = `r round(o_c.tpm.rand.zinb.COEF.age.nsk[[4]],2)`). There were no further significant effects in the count or zero-inflation models.

```{r seqdur_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## Sequence duration random sample ####
seqdur.random.distribution <- ggplot(turn.sequences.rand,
                            aes(round((seq.dur*60),0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("Sequence duration (sec)") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "seqdur_random_distribution.png"),
       plot = seqdur.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round((turn.sequences.rand$seq.dur*60),0))^2
#mean(round((turn.sequences.rand$seq.dur*60),0))
# mean is much smaller than variance
# non-zero values -- no zero inflation
turn.sequences.rand$uniq.segment <- paste0(turn.sequences.rand$aclew_child_id, "-",
                                          turn.sequences.rand$segment)
seqdur.sec.rand.nb <- glmmTMB(round((seq.dur*60),0) ~
                                tchiyr.std +
                                stthr.tri +
                                hsz.std +
                                nsk.std +
                                tchiyr.std:stthr.tri +
                                tchiyr.std:hsz.std +
                                tchiyr.std:nsk.std +
                                (1|uniq.segment) +
                                (1|aclew_child_id),
                              data=turn.sequences.rand,
                              family="nbinom1")
#seqdur.sec.rand.nb.res = simulateResiduals(seqdur.sec.rand.nb)
#plot(seqdur.sec.rand.nb.res, rank = T) # (manually saved)
#summary(seqdur.sec.rand.nb) # (no significant effects)
#Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    2.216674   0.142451  15.561 <0.0001 ***
#tchiyr.std                     0.105663   0.193521   0.546 0.585    
#stthr.trimorning               0.136008   0.174476   0.780 0.436    
#stthr.triafternoon             0.128729   0.160016   0.804 0.421    
#hsz.std                        0.010461   0.083797   0.125 0.901    
#nsk.std                        0.006317   0.048557   0.130 0.896    
#tchiyr.std:stthr.trimorning    0.196619   0.188012   1.046 0.296    
#tchiyr.std:stthr.triafternoon  0.045138   0.176905   0.255 0.799    
#tchiyr.std:hsz.std             0.142867   0.113612   1.257 0.209    
#tchiyr.std:nsk.std            -0.032344   0.063522  -0.509 0.611 
# no results to save for reporting

# test the other two-way effects of time of day
seqdur.sec.rand.nb.v2 <- glmmTMB(round((seq.dur*60),0) ~
                                   tchiyr.std +
                                   stthr.tri.a +
                                   hsz.std +
                                   nsk.std +
                                   tchiyr.std:stthr.tri.a +
                                   tchiyr.std:hsz.std +
                                   tchiyr.std:nsk.std +
                                   (1|uniq.segment) +
                                   (1|aclew_child_id),
                                 data=turn.sequences.rand,
                                 family="nbinom1")
#summary(seqdur.sec.rand.nb.v2) # (no significant effects)
#stthr.tri.amidday             -0.128729   0.160016  -0.804  0.421    
#stthr.tri.amorning             0.007280   0.116200   0.063  0.950    
#tchiyr.std:stthr.tri.amidday  -0.045138   0.176905  -0.255  0.799    
#tchiyr.std:stthr.tri.amorning  0.151481   0.129067   1.174  0.241    
# no results to save for reporting

## Sequence duration tt sample ####
seqdur.tt.distribution <- ggplot(turn.sequences.tt,
                            aes(round((seq.dur*60),0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("Sequence duration (sec)") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "seqdur_turntaking_distribution.png"),
       plot = seqdur.tt.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round((turn.sequences.tt$seq.dur*60),0))^2
#mean(round((turn.sequences.tt$seq.dur*60),0))
# mean is much smaller than variance
# non-zero values
turn.sequences.tt$uniq.segment <- paste0(turn.sequences.tt$aclew_child_id, "-",
                                          turn.sequences.tt$segment)
seqdur.sec.tt.nb <- glmmTMB(round((seq.dur*60),0) ~
                                tchiyr.std +
                                stthr.tri +
                                hsz.std +
                                nsk.std +
                                tchiyr.std:stthr.tri +
                                tchiyr.std:hsz.std +
                                tchiyr.std:nsk.std +
                                (1|uniq.segment) +
                                (1|aclew_child_id),
                              data=turn.sequences.tt,
                              family="nbinom1")
#seqdur.sec.tt.nb.res = simulateResiduals(seqdur.sec.tt.nb)
#plot(seqdur.sec.tt.nb.res, rank = T) # (manually saved)
#summary(seqdur.sec.tt.nb)
#Conditional model:
#                              Estimate Std. Error z value  Pr(>|z|)    
#(Intercept)                    2.24687    0.13586  16.539  < 0.0001 ***
#tchiyr.std                    -0.18273    0.12115  -1.508  0.13149    
#stthr.trimorning               0.05915    0.16101   0.367  0.71336    
#stthr.triafternoon             0.37875    0.14522   2.608  0.00911 ** 
#hsz.std                       -0.17315    0.09966  -1.737  0.08233 .  
#nsk.std                       -0.01070    0.05785  -0.185  0.85333    
#tchiyr.std:stthr.trimorning   -0.02062    0.16977  -0.121  0.90331    
#tchiyr.std:stthr.triafternoon  0.01937    0.14365   0.135  0.89271    
#tchiyr.std:hsz.std            -0.17535    0.12841  -1.366  0.17207    
#tchiyr.std:nsk.std             0.03003    0.07884   0.381  0.70327
# save for reporting
seqdur.sec.tt.nb.COEF.morn <-
  coef(summary(seqdur.sec.tt.nb))[[1]]["stthr.trimorning",]
seqdur.sec.tt.nb.COEF.aft <-
  coef(summary(seqdur.sec.tt.nb))[[1]]["stthr.triafternoon",]
seqdur.sec.tt.nb.COEF.hsz <-
  coef(summary(seqdur.sec.tt.nb))[[1]]["hsz.std",]

# test the other two-way effects of time of day
seqdur.sec.tt.nb.v2 <- glmmTMB(round((seq.dur*60),0) ~
                                 tchiyr.std +
                                 stthr.tri.a +
                                 hsz.std +
                                 nsk.std +
                                 tchiyr.std:stthr.tri.a +
                                 tchiyr.std:hsz.std +
                                 tchiyr.std:nsk.std +
                                 (1|uniq.segment) +
                                 (1|aclew_child_id),
                               data=turn.sequences.tt,
                               family="nbinom1")
#summary(seqdur.sec.tt.nb.v2)
#stthr.tri.amidday             -0.37875    0.14522  -2.608              0.00911 ** 
#stthr.tri.amorning            -0.31960    0.15110  -2.115              0.03442 *  
#tchiyr.std:stthr.tri.amidday  -0.01937    0.14365  -0.135              0.89271    
#tchiyr.std:stthr.tri.amorning -0.04000    0.16605  -0.241              0.80965    
# save for reporting
seqdur.sec.tt.nb.v2.COEF.morn <-
  coef(summary(seqdur.sec.tt.nb.v2))[[1]]["stthr.tri.amorning",]
seqdur.sec.tt.nb.v2.COEF.age.morn <-
  coef(summary(seqdur.sec.tt.nb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",]
```

```{r seqdur_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## Sequence duration random sample ####
seqdur.sec.rand.gaus <- glmmTMB(log(seq.dur) ~
                                tchiyr.std +
                                stthr.tri +
                                hsz.std +
                                nsk.std +
                                tchiyr.std:stthr.tri +
                                tchiyr.std:hsz.std +
                                tchiyr.std:nsk.std +
                                (1|uniq.segment) +
                                (1|aclew_child_id),
                              data=turn.sequences.rand)
#seqdur.sec.rand.gaus.res = simulateResiduals(seqdur.sec.rand.gaus)
#plot(seqdur.sec.rand.gaus.res, rank = T) # (manually saved)
#summary(seqdur.sec.rand.gaus) # (no significant effects)
#Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                   -2.238598   0.179612 -12.464 <0.0001 ***
#tchiyr.std                     0.101763   0.247126   0.412 0.680    
#stthr.trimorning               0.079977   0.222088   0.360 0.719    
#stthr.triafternoon             0.132569   0.203187   0.652 0.514    
#hsz.std                        0.007682   0.107943   0.071 0.943    
#nsk.std                        0.010111   0.060352   0.168 0.867    
#tchiyr.std:stthr.trimorning    0.334872   0.241382   1.387 0.165    
#tchiyr.std:stthr.triafternoon  0.109382   0.223645   0.489 0.625    
#tchiyr.std:hsz.std             0.166068   0.144025   1.153 0.249    
#tchiyr.std:nsk.std            -0.059959   0.080566  -0.744 0.457
# DIFFERENCES?
# very similar to nb model

# test the other two-way effects of time of day
seqdur.sec.rand.gaus.v2 <- glmmTMB(log(seq.dur) ~
                                   tchiyr.std +
                                   stthr.tri.a +
                                   hsz.std +
                                   nsk.std +
                                   tchiyr.std:stthr.tri.a +
                                   tchiyr.std:hsz.std +
                                   tchiyr.std:nsk.std +
                                   (1|uniq.segment) +
                                   (1|aclew_child_id),
                                 data=turn.sequences.rand)
#summary(seqdur.sec.rand.gaus) # (no significant effects)
#stthr.tri.amidday             -0.132569   0.203187  -0.652  0.514    
#stthr.tri.amorning            -0.052592   0.146310  -0.359  0.719    
#tchiyr.std:stthr.tri.amidday  -0.109382   0.223645  -0.489  0.625    
#tchiyr.std:stthr.tri.amorning  0.225490   0.167873   1.343  0.179    
# DIFFERENCES?
# very similar to nb model


## Sequence duration tt sample ####
seqdur.sec.tt.gaus <- glmmTMB(log(seq.dur) ~
                                tchiyr.std +
                                stthr.tri +
                                hsz.std +
                                nsk.std +
                                tchiyr.std:stthr.tri +
                                tchiyr.std:hsz.std +
                                tchiyr.std:nsk.std +
                                (1|uniq.segment) +
                                (1|aclew_child_id),
                              data=turn.sequences.tt)
#seqdur.sec.tt.gaus.res = simulateResiduals(seqdur.sec.tt.gaus)
#plot(seqdur.sec.tt.gaus.res, rank = T) # (manually saved)
#summary(seqdur.sec.tt.gaus)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                   -2.32810    0.15565 -14.957 <0.0001 ***
#tchiyr.std                    -0.20332    0.14515  -1.401 0.1613    
#stthr.trimorning               0.07604    0.19411   0.392 0.6953    
#stthr.triafternoon             0.57536    0.18525   3.106 0.0019 ** 
#hsz.std                       -0.23223    0.11533  -2.014 0.0441 *  
#nsk.std                       -0.02348    0.07391  -0.318 0.7507    
#tchiyr.std:stthr.trimorning    0.01534    0.20032   0.077 0.9390    
#tchiyr.std:stthr.triafternoon -0.01424    0.18700  -0.076 0.9393    
#tchiyr.std:hsz.std            -0.19712    0.14911  -1.322 0.1862    
#tchiyr.std:nsk.std             0.04998    0.10153   0.492 0.6226
# DIFFERENCES?
# broadly similar to nb model

# test the other two-way effects of time of day
seqdur.sec.tt.gaus.v2 <- glmmTMB(log(seq.dur) ~
                                 tchiyr.std +
                                 stthr.tri.a +
                                 hsz.std +
                                 nsk.std +
                                 tchiyr.std:stthr.tri.a +
                                 tchiyr.std:hsz.std +
                                 tchiyr.std:nsk.std +
                                 (1|uniq.segment) +
                                 (1|aclew_child_id),
                               data=turn.sequences.tt)
#summary(seqdur.sec.tt.gaus.v2)
#stthr.tri.amidday             -0.57536    0.18525  -3.106              0.0019 ** 
#stthr.tri.amorning            -0.49932    0.19388  -2.575              0.0100 *  
#tchiyr.std:stthr.tri.amidday   0.01424    0.18700   0.076              0.9393    
#tchiyr.std:stthr.tri.amorning  0.02958    0.21021   0.141              0.8881    
# DIFFERENCES?
# very similar to nb model

# Write model results out for input to shiny
seqdur.sec.models <- bind_rows(
  broom.mixed::tidy(seqdur.sec.rand.nb) %>%
    mutate(model = "seqdur.sec_random_nb"),
  broom.mixed::tidy(seqdur.sec.rand.nb.v2) %>%
    mutate(model = "seqdur.sec_random_nb.v2"),
  broom.mixed::tidy(seqdur.sec.rand.gaus) %>%
    mutate(model = "seqdur.sec_random_log_gaus"),
  broom.mixed::tidy(seqdur.sec.rand.gaus.v2) %>%
    mutate(model = "seqdur.sec_random_log_gaus.v2"),
  broom.mixed::tidy(seqdur.sec.tt.nb) %>%
    mutate(model = "seqdur.sec_turntaking_nb"),
  broom.mixed::tidy(seqdur.sec.tt.nb.v2) %>%
    mutate(model = "seqdur.sec_turntaking_nb.v2"),
  broom.mixed::tidy(seqdur.sec.tt.gaus) %>%
    mutate(model = "seqdur.sec_turntaking_log_gaus"),
  broom.mixed::tidy(seqdur.sec.tt.gaus.v2) %>%
    mutate(model = "seqdur.sec_turntaking_log_gaus.v2"))
```

## Sequence duration
We defined sequences of interaction as periods of contingent turn taking with at least one target child vocalization and one target-child-directed prompt or response from another speaker. To detect sequences of interaction, we used the same mechanism as before to detect contingent TC--O and O--TC transitions, but also allowed for speakers to continue speaking with multiple vocalizations in a row (e.g., TC--O--O--TC--OTH; [Figure 6](#fig6)). We bounded sequences by the earliest and latest vocalization for which there was no contingent prompt or response, respectively. In our analysis, each target child vocalization could only appear in one sequence (i.e., each sequence had a unique set of vocalizations). We modeled these sequence durations in the random clips with negative binomial regression alone (i.e., with no zero-inflation model). We detected `r nrow(turn.sequences.rand)` interactional sequences in the 90 randomly selected clips, with an average sequence duration of `r round(mean(turn.sequences.rand$seq.dur)*60,2)` seconds (median = `r round(median(turn.sequences.rand$seq.dur)*60,2)`; range = `r round(min(turn.sequences.rand$seq.dur)*60,2)`--`r round(max(turn.sequences.rand$seq.dur)*60,2)`; [Figure 7](#fig7)). The average number of child vocalizations within these sequences was `r round(mean(turn.sequences.rand$n_cvcs_seq),2)` (range = `r round(min(turn.sequences.rand$n_cvcs_seq),2)`--`r round(max(turn.sequences.rand$n_cvcs_seq),2)`; median = `r round(median(turn.sequences.rand$n_cvcs_seq),2)`). None of the predictors significantly impacted sequence duration (all _p_ $$\ge$$ `r round(min(coef(summary(seqdur.sec.rand.nb))[[1]][2:nrow(coef(summary(seqdur.sec.rand.nb))[[1]]),"Pr(>|z|)"]),2)`).

## Language experience in the turn-taking clips
As expected, the high-quality turn-taking clips featured a much higher rate of contingent turn transitions: the average TC--O transition rate was `r round(mean(turn.transitions.tt$n.c_o.tpm),2)` transitions per minute (~5.5x the random sample rate; median = `r round(median(turn.transitions.tt$n.c_o.tpm),2)`; range = `r round(min(turn.transitions.tt$n.c_o.tpm),2)`--`r round(max(turn.transitions.tt$n.c_o.tpm),2)`) and the average O--TC rate was `r round(mean(turn.transitions.tt$n.o_c.tpm),2)` transitions per minute (~6.5x the random sample rate; median = `r round(median(turn.transitions.tt$n.o_c.tpm),2)`; range = `r round(min(turn.transitions.tt$n.o_c.tpm),2)`--`r round(max(turn.transitions.tt$n.o_c.tpm),2)`). The interactional sequences were also slightly longer on average: `r round(mean(turn.sequences.tt$seq.dur)*60,2)` seconds (~1.2x the random sample rate; median = `r round(median(turn.sequences.tt$seq.dur)*60,2)`; range = `r round(min(turn.sequences.tt$seq.dur)*60,2)`--`r round(max(turn.sequences.tt$seq.dur)*60,2)`). Crucially, children also heard much more TCDS in the turn-taking clips---`r round(mean(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)` min/hr (nearly 4x the random sample rate; median = `r round(median(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)`; range = `r round(min(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)`--`r round(max(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)`)---while also hearing less ODS---`r round(mean(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)` min/hr (nearly half the random sample rate; median = `r round(median(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)`; range = `r round(min(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)`--`r round(max(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)`).

We analyzed each of these speech environment measures with parallel models to those used for the random sample, though this time we did not include a zero-inflation model for TCDS, TC--O, and O--TC rates because, given the criteria for selecting a turn-taking clip, the child is never alone, and so there are no extra-zero cases. As a whole, children's speech environments appeared quite different when viewed through the lens of interactional peaks rather than randomly sampled clips ([Figures 3](#fig3), [5](#fig5), and [7](#fig7)), particularly with respect to time-of-day effects and the number of speakers present, which we focus on here. Full model outputs are available in the Supplementary Materials.

Time-of-day effects were consistently weaker or non-existent in the turn-taking sample. TCDS rates showed no time-of-day effects and no interaction between time-of-day and age, and ODS rates _did_ show a dip, but later in the day than what we saw in the random sample (i.e., afternoon, not midday; afternoon-vs.-midday: B = `r round(ods.tt.zinb.v2.COEF.aft.vs.midd[[1]],2)`, SD = `r round(ods.tt.zinb.v2.COEF.aft.vs.midd[[2]],2)`, z = `r round(ods.tt.zinb.v2.COEF.aft.vs.midd[[3]],2)`, p = `r round(ods.tt.zinb.v2.COEF.aft.vs.midd[[4]],2)`, afternoon-vs.-morning: B = `r round(ods.tt.zinb.v2.COEF.aft.vs.morn[[1]],2)`, SD = `r round(ods.tt.zinb.v2.COEF.aft.vs.morn[[2]],2)`, z = `r round(ods.tt.zinb.v2.COEF.aft.vs.morn[[3]],2)`, p < 0.01). Older children were also significantly more likely to hear ODS around midday compared to the morning (midday-vs.-morning: B = `r round(ods.tt.zinb.COEF.age.morn[[1]],2)`, SD = `r round(ods.tt.zinb.COEF.age.morn[[2]],2)`, z = `r round(ods.tt.zinb.COEF.age.morn[[3]],2)`, p = `r round(ods.tt.zinb.COEF.age.morn[[4]],2)`), but heard significantly less ODS overall than younger children (B = `r round(ods.tt.zinb.COEF.age[[1]],2)`, SD = `r round(ods.tt.zinb.COEF.age[[2]],2)`, z = `r round(ods.tt.zinb.COEF.age[[3]],2)`, p = `r round(ods.tt.zinb.COEF.age[[4]],2)`). There were no time-of-day effects at all on contingent response rates (TC--O and O--TC) in the turn-taking sample. However, running counter to this overall pattern, sequence duration in the turn-taking sample did show significant time-of-day effects not found in the random sample: sequences were significantly longer in the afternoon compared to morning and midday (afternoon-vs.-morning: B = `r round(seqdur.sec.tt.nb.v2.COEF.morn[[1]],2)`, SD = `r round(seqdur.sec.tt.nb.v2.COEF.morn[[2]],2)`, z = `r round(seqdur.sec.tt.nb.v2.COEF.morn[[3]],2)`, p = `r round(seqdur.sec.tt.nb.v2.COEF.morn[[4]],2)`; midday-vs.-afternoon: B = `r round(seqdur.sec.tt.nb.COEF.aft[[1]],2)`, SD = `r round(seqdur.sec.tt.nb.COEF.aft[[2]],2)`, z = `r round(seqdur.sec.tt.nb.COEF.aft[[3]],2)`, p = `r round(seqdur.sec.tt.nb.COEF.aft[[4]],2)`). 

Effects relating to the number of speakers present were also somewhat weaker in the turn-taking sample, though inconsistently. In the turn taking sample, none of TCDS min/hr, TC--O transitions/min, or O--TC transitions/min were significantly impacted by the number of speakers present. On the other hand, the number of speakers present was associated with significantly more ODS in both the random and turn-taking samples (random sample: B = `r round(ods.tt.zinb.COEF.nsk[[1]],2)`, SD = `r round(ods.tt.zinb.COEF.nsk[[2]],2)`, z = `r round(ods.tt.zinb.COEF.nsk[[3]],2)`, p < 0.001), suggesting that the number of speakers is a robust predictor of ODS quantity across different contexts.

### Peak minutes in the day
```{r peakmins_prep, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# get average overall turn transition rate
ttrate.all.avg.bychild <- turn.transitions %>%
  filter(grepl("tt", segment)) %>%
  replace_na(list(tm1.tier = 0, tp1.tier = 0)) %>%
  mutate(tm1.bin = ifelse(tm1.tier == 0, 0, 1),
         tp1.bin = ifelse(tp1.tier == 0, 0, 1)) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(oct.raw = sum(tm1.bin), cot.raw = sum(tp1.bin)) %>%
  mutate(segdur = ifelse(grepl('ext', segment), 5, 1)) %>%
  group_by(aclew_child_id) %>%
  summarise (alltts = sum(oct.raw + cot.raw), sampledur = sum(segdur)) %>%
  mutate(peakttrate = alltts/sampledur)
ttrate.all.avg <- mean(ttrate.all.avg.bychild$peakttrate)

# set up a table of tt onset times within the randomly sampled segments
tts.all.rand <- turn.transitions %>%
  filter(grepl("rand", segment)) %>%
  select(aclew_child_id, segment, tm1.stop, tp1.start)
rand.seg.starts <- seg.info %>%
  filter(grepl("rand", CodeName)) %>%
  select(aclew_id, CodeName, clipoffset.sec)
rand.seg.secs <- tibble()
for (i in 1:nrow(rand.seg.starts)) {
  seg.secs <- tibble(
    aclew_child_id = rand.seg.starts$aclew_id[i],
    segment = rand.seg.starts$CodeName[i],
    segoffset.sec = c(0:299), # seconds in a (5-min) random clip
    segtime.sec = seq(rand.seg.starts$clipoffset.sec[i],
                      (rand.seg.starts$clipoffset.sec[i] + 299), 1),
    bin.tt = 0
  )
  tts.all.rand.chi <- tts.all.rand %>%
    filter(aclew_child_id == rand.seg.starts$aclew_id[i],
           segment == rand.seg.starts$CodeName[i])
  # add in tm1s
  tts.all.rand.chi.tm1 <- tts.all.rand.chi$tm1.stop[!is.na(tts.all.rand.chi$tm1.stop)]
  if (length(tts.all.rand.chi.tm1) > 0) {
    tm1.onsets.sec <- tts.all.rand.chi.tm1/1000
    # REMINDER: example use of findInterval:
    # findInterval(c(2,5,7,8), c(4,5,6,8,9,10)) => [1] 0 2 3 4
    tt.idx <- findInterval(tm1.onsets.sec, seg.secs$segtime.sec)
    seg.secs$bin.tt[tt.idx] <- seg.secs$bin.tt[tt.idx] + 1
  }
  # add in tp1s
  tts.all.rand.chi.tp1 <- tts.all.rand.chi$tp1.start[!is.na(tts.all.rand.chi$tp1.start)]
  if (length(tts.all.rand.chi.tp1) > 0) {
    tp1.onsets.sec <- tts.all.rand.chi.tp1/1000
    tt.idx <- findInterval(tp1.onsets.sec, seg.secs$segtime.sec)
    seg.secs$bin.tt[tt.idx] <- seg.secs$bin.tt[tt.idx] + 1
  }
  rand.seg.secs <- bind_rows(rand.seg.secs, seg.secs)
}

# get average tt rates in 1-min windows
rand.window.tts <- rand.seg.secs %>%
  filter(segoffset.sec >= 59) %>%
  select(-bin.tt) %>%
  mutate(ttr.min = 0)
for (chi in unique(rand.seg.secs$aclew_child_id)) {
  for (seg in unique(rand.seg.secs$segment)) {
    for (minstart in c(1:241)) {
      rand.window.tts$ttr.min[which(rand.window.tts$aclew_child_id == chi &
                              rand.window.tts$segment == seg &
                              rand.window.tts$segoffset.sec == minstart+59-1)] <-
        sum(subset(rand.seg.secs, aclew_child_id == chi &
                     segment == seg)$bin.tt[(minstart:(minstart+59))])
    }
  }
}
rand.window.tts <- rand.window.tts %>%
  left_join(select(ttrate.all.avg.bychild, c(aclew_child_id, peakttrate))) %>%
  mutate(GE.chipeak = ifelse(ttr.min >= peakttrate, 1, 0),
         GE.allpeak = ifelse(ttr.min >= ttrate.all.avg, 1, 0))
write_csv(rand.window.tts,
          paste0(metadata.path, "ttr.random.1minwindow.csv"))

# calculate # seconds in "peak" tt rates and duration of peaks
ttrGEpeak.segs <- rand.window.tts %>%
  filter(GE.allpeak == 1)
ttrGEpeak.segs$prevpeak <- c(-1, ttrGEpeak.segs$segoffset.sec[1:nrow(ttrGEpeak.segs)-1])
ttrGEpeak.segs$newstreak <- ifelse(ttrGEpeak.segs$prevpeak ==
                                        (ttrGEpeak.segs$segoffset.sec - 1), 0, 1)
ttrGEpeak.segs <- select(ttrGEpeak.segs, -prevpeak)
ttrGEpeaks <- filter(ttrGEpeak.segs, newstreak == 1)
ttrGEpeaks$end.sec <- 0
for (i in 1:nrow(ttrGEpeaks)) {
  chi <- ttrGEpeaks$aclew_child_id[i]
  seg <- ttrGEpeaks$segment[i]
  start <- ttrGEpeaks$segoffset.sec[i]
  start.idx <- which(ttrGEpeak.segs$aclew_child_id == chi &
                       ttrGEpeak.segs$segment == seg &
                       ttrGEpeak.segs$segoffset.sec == start)
  newstreaks <- which(ttrGEpeak.segs$aclew_child_id == chi &
                        ttrGEpeak.segs$segment == seg &
                        ttrGEpeak.segs$segoffset.sec > start &
                        ttrGEpeak.segs$newstreak == 1)
  if (length(newstreaks) > 0) {
    end.sec <- ttrGEpeak.segs$segoffset.sec[newstreaks[1] - 1]
  } else {
    end.sec <- ttrGEpeak.segs$segoffset.sec[max(
      which(ttrGEpeak.segs$aclew_child_id == chi &
              ttrGEpeak.segs$segment == seg &
              ttrGEpeak.segs$segoffset.sec >= start))]
  }
  ttrGEpeaks$end.sec[i] <- end.sec + 1
}
ttrGEpeaks <- ttrGEpeaks %>%
  mutate(start.sec = segoffset.sec - 59,
         peak.dur = end.sec - start.sec)
ttrGEpeaks.summary <- ttrGEpeaks %>%
  group_by(aclew_child_id) %>%
  summarise(npeaks = n(),
            pkdur.mean = mean(peak.dur),
            pkdur.sum = sum(peak.dur),
            pkdur.mph = ((pkdur.sum/60)/45) * 60) %>% # (peak mns/45 poss mns) * 60 mn/hr
  # add back zero estimates for children with no tt peaks in the random data
  full_join(select(ptcp.info, aclew_child_id)) %>%
  replace_na(list(npeaks = 0, pkdur.mean = 0, pkdur.sum = 0, pkdur.mph = 0))

ttrGEpeak.segs.chi <- rand.window.tts %>%
  filter(GE.chipeak == 1)

avg.random.peak.durs <- ttrGEpeaks %>%
  group_by(aclew_child_id) %>%
  summarise(meandur = mean(peak.dur), 
            meddur = median(peak.dur))
```

```{r peakmins_plots, message=FALSE, warning=FALSE, paged.print=FALSE}
rand.window.tts <- rand.window.tts %>%
  mutate(endoffsetsec = segoffset.sec + 1,
         delta.allpeak = ttr.min - ttrate.all.avg) %>%
  left_join(ptcp.info)
write_csv(rand.window.tts, paste0(shiny.input.path, "random_window_tts.csv"))
ttr.random <- ggplot(rand.window.tts,
                          aes(x = as.factor(age_mo_round), y = ttr.min)) +
  geom_jitter(color = "gray80", size = 0.3) +
  geom_violin(color = "black", fill = "black") + 
  ylab("High-tt secs/min") + xlab("Age (months)")	+
  scale_y_continuous(limits=c(-1, round(max(rand.window.tts$ttr.min) + 5, -1)),
                     breaks=seq(0, round(max(rand.window.tts$ttr.min) + 5, -1), 10)) +
  coord_cartesian(ylim=c(0, round(max(rand.window.tts$ttr.min) + 5, -1))) +
  geom_hline(yintercept = ttrate.all.avg, color = "red") +
  geom_point(color = "red", size = 2.5, aes(y = peakttrate)) +
#  scale_color_manual(values = viridis(3)) +
#  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))
```

Having now established the interactional timing characteristics of the "high" turn-taking clips, we looked for similarly temporally contingent 1-minute sections of interaction in the random samples in order to estimate the number of high interactivity minutes in the whole day. To do this, we scanned each 60-second window (e.g., 0--60 sec, 1--61 sec, etc.) of each random clip and recorded the observed turn-transition rate. We then compared the resulting 1-minute transition rates to those typical for the high turn-taking sample.

In total, `r sum(ttrGEpeaks.summary$npeaks > 0)` of the 10 children showed at least one minute of their random sample that equaled or exceeded the combined average contingent transition rate (`r ttrate.all.avg` transitions/min), and `r length(unique(ttrGEpeak.segs.chi$aclew_child_id))` of the 10 children showed at least one minute equaling or exceeding their _own_ average turn transition rate from their turn-taking sample. Across the `r sum(ttrGEpeaks.summary$npeaks > 0)` children who did show turn-taking "peaks" in their random data, peak periods were relatively long, at an average of `r round(mean(avg.random.peak.durs$meandur),2)` seconds (median = `r round(median(avg.random.peak.durs$meandur),2)` seconds; range = `r round(min(avg.random.peak.durs$meandur),2)`--`r round(max(avg.random.peak.durs$meandur),2)` seconds). Overall, children spent an average of `r round(mean(ttrGEpeaks.summary$pkdur.mph),2)` minutes per hour (median = `r round(median(ttrGEpeaks.summary$pkdur.mph),2)`; range = `r round(min(ttrGEpeaks.summary$pkdur.mph),2)`--`r round(max(ttrGEpeaks.summary$pkdur.mph),2)`) in these peak interactions during the 45 scanned minutes. Assuming approximately `r waking.hours` waking hours [@hart1995meaningful], we therefore very roughly estimate that the average Tseltal child under 3;0 spends an average of `r mean(ttrGEpeaks.summary$pkdur.mph)*waking.hours` minutes (`r round((mean(ttrGEpeaks.summary$pkdur.mph)*waking.hours)/60,2)` hours) in high turn-taking, dyadic interaction during their day. Crucially, however, the range in the quantity of high turn-taking interaction varies enormously across children, starting at just a few minutes per day and topping out at more than `r max(ttrGEpeaks.summary$pkdur.mph)*waking.hours` minutes (`r round((max(ttrGEpeaks.summary$pkdur.mph)*waking.hours)/60,2)` hours) in our 10-child sample. Much more data, particularly from other Tseltal children in this age range, is required to get stable estimates for the typical quantity and variance in peak interactional minutes experienced in a waking day.


## Vocal maturity
``` {r vocmat_prep, message=FALSE, warning=FALSE, paged.print=FALSE}
# all vocalization types
chi.vm.lx.utts <- all.data %>%
  filter((tier == "vcm@CHI" | tier == "lex@CHI" | tier == "mwu@CHI") & !is.na(val)) %>%
  mutate(voc.rating = ifelse(val == "M", 4,
                             ifelse((val == "1" | val == "W"), 3,
                                    ifelse((val == "0" | val == "C"), 2,
                                           ifelse(val == "N", 1, 0))))) %>%
  filter(voc.rating > 0) %>%
  group_by(aclew_child_id, segment, sample, start) %>%
  summarise(max_voc.rtg = max(voc.rating))
all.voc.types.per.child <- tibble(
  aclew_child_id = rep(ptcp.info$aclew_child_id, 4),
  max_voc.rtg = c(rep(1, length(ptcp.info$aclew_child_id)),
                  rep(2, length(ptcp.info$aclew_child_id)),
                  rep(3, length(ptcp.info$aclew_child_id)),
                  rep(4, length(ptcp.info$aclew_child_id)))
)
chi.nvocs <- chi.vm.lx.utts %>%
  group_by(aclew_child_id) %>%
  summarise(n_vocs = n())
chi.vm.lx.voc.type.props <- chi.vm.lx.utts %>%
  group_by(aclew_child_id, max_voc.rtg) %>%
  summarise(n_voc.type = n()) %>%
  full_join(all.voc.types.per.child, by = c("aclew_child_id", "max_voc.rtg")) %>%
  replace_na(list(n_voc.type = 0)) %>%
  full_join(chi.nvocs, by = "aclew_child_id") %>%
  mutate(prop_voc.type = round(n_voc.type/n_vocs, 3)) %>%
  arrange(aclew_child_id, max_voc.rtg) %>%
  full_join(ptcp.info, by = "aclew_child_id")

# speech-like vs. non-speech-like only, only under 19mo
chi.vm.lx.utts.all <- all.data %>%
  filter((tier == "vcm@CHI" | tier == "lex@CHI" | tier == "mwu@CHI") &
           !is.na(val) & age_mo_round < 19) %>%
  mutate(voc.rating = ifelse(val == "M", 1,
                             ifelse((val == "1" | val == "W"), 1,
                                    ifelse((val == "0" | val == "C"), 1, 0)))) %>%
  group_by(aclew_child_id, segment, sample, start) %>%
  summarise(max_voc.rtg = max(voc.rating))
all.voc.types.per.child.all <- tibble(
  aclew_child_id = rep(ptcp.info$aclew_child_id, 2),
  max_voc.rtg = c(rep(0, length(ptcp.info$aclew_child_id)),
                  rep(1, length(ptcp.info$aclew_child_id)))
)
chi.nvocs.all <- chi.vm.lx.utts.all %>%
  group_by(aclew_child_id) %>%
  summarise(n_vocs = n())
chi.vm.lx.voc.type.props.bin <- chi.vm.lx.utts.all %>%
  group_by(aclew_child_id, max_voc.rtg) %>%
  summarise(n_voc.type = n()) %>%
  left_join(all.voc.types.per.child.all, by = c("aclew_child_id", "max_voc.rtg")) %>%
  replace_na(list(n_voc.type = 0)) %>%
  left_join(chi.nvocs.all, by = "aclew_child_id") %>%
  mutate(prop_voc.type = round(n_voc.type/n_vocs, 3)) %>%
  arrange(aclew_child_id, max_voc.rtg) %>%
  left_join(ptcp.info, by = "aclew_child_id")
```

``` {r vocmat_plots, message=FALSE, warning=FALSE, paged.print=FALSE}
chi.vm.lx.voc.type.props <- chi.vm.lx.voc.type.props %>%
  mutate(voc.type = factor(as.factor(max_voc.rtg),
                           labels = c("NCB", "CB", "SW", "MW")))
write_csv(chi.vm.lx.voc.type.props,
          paste0(shiny.input.path,
                 "all_vocmat-types_proportions.csv"))
voc.mat.by.age <- ggplot(
  data = chi.vm.lx.voc.type.props,
  aes(x = age_mo_round, y = prop_voc.type, group = as.factor(voc.type))) +
  geom_point(aes(color = as.factor(voc.type))) +
  geom_smooth(aes(color = as.factor(voc.type),
                  fill = as.factor(voc.type)), method = "loess") +
  ylab("Prop of linguistic vocs") + xlab("Child age (mo)") +
  labs(fill='Voc type') +
  labs(color='Voc type') +
  scale_color_manual(values = c("gray80", "gray54",
                                  "gray27", "black")) +
  scale_fill_manual(values = c("gray80", "gray54",
                                  "gray27", "black")) +
  scale_y_continuous(limits=c(-0.5,1.5),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1), xlim=c(0,38)) +
  theme_apa() + theme(
    legend.position = c(0.9, 0.85),
    legend.background = element_rect(fill="transparent"),
    axis.line = element_line(color="black", size = 0.4))
```

Tseltal children's vocalizations appear to follow the normative benchmarks for productive speech development, as they are characterized by the onset of new production features. Decades of research in industrialized, typically Western populations has shown that, typically, children begin producing non-canonical babbling around 0;2, with canonical babbling appearing sometime around 0;7, first words around 1;0, and first multi-word utterances appearing just after 1;6 [@frankIPvariability; @kuhl2004early; @pine1993reanalysing; @slobin1970universals; @tomasello1999early; @warlaumont2014social]. These benchmarks are mirrored in the Tseltal children's vocalizations, which are summarized in [Figure 9](#fig9) based on all annotated vocalizations from the random, turn-taking, and high vocal activity samples (N = `r sum(chi.nvocs$n_vocs)` vocalizations). There is a decline in the use of non-canonical babble and an accompanying increase in the use of canonical babble between 0;6 and 1;0. Recognizable words are observed for every child from age 11;0 and older. Multi-word utterances appear in all recordings at 1;2 and later, making up 45% of the oldest child's (3;0) vocalizations.

```{r fig9, echo=FALSE, fig.cap="Proportion of vocalization types used by children across age (NCB = Non-canonical babble, CB = Canonical babble, SW = single word utterance, MW = multi-word utterance).", message=FALSE, warning=FALSE, fig.height=3.5}
voc.mat.by.age
```

These data are consistent with usage statistics of speech-like vocalizations by English-acquiring infants [@warlaumont2014social]. Between 2 and 14 months, these Tseltal children demonstrated a large increase in the proportion of speech-like vocalizations (canonical babbling and lexical speech): from `r round(mean(subset(chi.vm.lx.voc.type.props.bin, max_voc.rtg == 1 & age_mo_round < 6)$prop_voc.type*100,2))`% before 0;6 to `r round(mean(subset(chi.vm.lx.voc.type.props.bin, max_voc.rtg == 1 & age_mo_round > 10)$prop_voc.type*100,2))`% between 0;10 and 1;2. Around age 1;0, their use of speech-like vocalizations (`r round(mean(subset(chi.vm.lx.voc.type.props.bin, max_voc.rtg == 1 & age_mo_round > 10)$prop_voc.type*100,2))`%) is nearly identical to that reported by @warlaumont2014social for American children around age 1;0 in an SES-variable sample (approximately 60%).
<!--Speech-like vs. non-speech-like comparisons are limited to age 1;6 in the ACLEW Annotation Scheme.-->
<!--Warlaumont and colleagues (2014) found that infants used ~60% speech-like vocalizations (speech, non-word babble, and singing) around age 1;0 in their ~0.85 at age fourSES-variable dataset of 106 children. For We estimated the number of speech-like (canonical babbling and lexical speech) and non-speech-like (cries, laughter, and non-canonical babbles) vocalizations from Tseltal children 14 months and younger across the random, turn-taking, and high vocal activity samples (N = `r sum(chi.nvocs.all$n_vocs)` from `r length(unique(chi.nvocs.all$aclew_child_id))` children).-->

``` {r all_model_tabless, message=FALSE, warning=FALSE, paged.print=FALSE}
all.models <- bind_rows(TCDS.models, ODS.models,
                        c_o.tpm.models, o_c.tpm.models,
                        seqdur.sec.models)
write_csv(all.models, paste0(shiny.input.path, "all_model_tables.csv"))
```


# Discussion {#disc}
We analyzed 10 Tseltal Mayan children's speech environments in order to estimate how often they have the opportunity to attend and respond to speech. Based on prior work, we predicted infrequent, but bursty use of TCDS, an increase in TCDS with age, that a large proportion of TCDS would come from other children, and that vocal development would be on par with typically developing Western children. Only some of these predictions were borne out in the analyses. We did find evidence for infrequent use of TCDS and for a typical-looking trajectory of vocal development, but we also found that most directed speech came from adults, and that the quantity of directed speech was stable across the first three years of life. Within individual recordings, TCDS and contingent responding were influenced by the time of day and number of speakers present. That said, time of day and number of speakers less strongly impacted TCDS during high turn-taking clips, suggesting that interactional peaks are one source of stable, high-engagement linguistic experience available to Tseltal children in the first few years of life. These findings only partly replicate estimates of child language input and development in previous work on Yucatec Mayan and Tseltal Mayan communities (Yucatec: Shneidman & Goldin-Meadow 2012; Tseltal: Brown, 1998, 2011, 2014), and bring new questions to light regarding the distribution of child-directed speech over activities and interactant types in Mayan children's speech environments.

## Robust learning with less child-directed speech
The bulk of our analyses were aimed at understanding how much speech Tseltal children hear: we wanted to know how often they were directly spoken to and how often they might have been able to listen to speech directed to others. Consistent with prior work, the children were only infrequently directly spoken to: an average of `r round(mean(quantity.rand.bychild$tds_mph),2)` minutes per hour in the random sample. This average TCDS rate for Tseltal is approximately a third of that found for North American children [@bergelsoncasillas2019what], but is comparable to that for Tsimane children [@scaffIPlanguage] and Yucatec Mayan children [@shneidman2012language] in a similar age range. Meanwhile, we found that the children had an enormous quantity of other-directed speech in their environment, averaging `r round(mean(quantity.rand.bychild$ods_mph),2)` minutes per hour in the random sample, which is more than has been previously reported for other cultural settings [e.g., @bergelsoncasillas2019what; @scaffIPlanguage].

We also created two novel interactive measures to describe how often children were directly engaged with an interlocutor, either as a responder or as an addressee being responded to. Children's vocalizations were responded to at a rate of `r round(mean(turn.transitions.rand$n.c_o.tpm),2)` transitions per minute and children responded to others' child-directed vocalizations at a rate of `r round(mean(turn.transitions.rand$n.o_c.tpm),2)` transitions per minute. This rate is consistent with prior estimates for the frequency of child-initiated and other-initiated prompts in Tseltal interaction [@brown2011cultural]. Contingent interaction---and the joint attention that likely accompanies it---is a fertile context for language learning because the participants' coordinated attentional states decrease referential uncertainty, increase the chances of dynamic feedback, and can spur further interactions [@bornstein2015mother; @broesch2016similarities; @warlaumont2014social]. Because our measure is a novel one, we cannot directly compare Tseltal children's data with those of children growing up in other communities. That said, contingent responses are rare across the day---more rare than TCDS in general. The rarity of contingent responses may be due to the fact that the children did not vocalize very often: preliminary analyses showed that they only produced an average of `r round(mean(chi.nvocs$n_vocs)/60,2)` vocalizations per minute (median = `r round(median(chi.nvocs$n_vocs)/60,2)`; range = `r round(min(chi.nvocs$n_vocs)/60,2)`--`r round(max(chi.nvocs$n_vocs)/60,2)`) during their full one hour of annotated audio (including the high vocal activity minutes), much of which was crying and laughter. Interestingly, children tended to only vocalize 3.75 times per sequence (mean duration = `r round(mean(turn.sequences.rand$seq.dur)*60,2)` seconds), with silence, TCDS, and ODS taking up the rest of the interactional time. In other words, interactional peaks---sometimes containing the bulk of children's directed speech for the day---were by longer streams of speech from an interlocutor, interspersed with occasional responses from the child.

In sum, our daylong recording results confirm prior claims that Tseltal children, like other Mayan children, are not often directly spoken to. When they are, much of their speech comes in interactional sequences in which children only play a minor part---directly contingent turn transitions between children and their interlocutors are relatively rare. However, we coarsely estimate that the typical child under age 3;0 experiences nearly two cumulative hours of high-intensity contingent interaction with TCDS per day. If child-directed speech quantity linearly feeds language development (such that more input begets more (advanced) output), then the estimates presented here would lead us to expect Tseltal to be delayed in their language development. However, our analyses suggest that Tseltal children demonstrate vocal maturity comparable to children from societies in which TCDS is known to be more frequent [@frankIPvariability; @kuhl2004early; @pine1993reanalysing; @slobin1970universals; @tomasello1999early; @warlaumont2014social]. How might Tseltal children manage this feat?

### Other-directed speech
One proposal is that Mayan children become experts at learning from observation during their daily interactions [@deleon2011language; @rogoff2003firsthand; @shneidman2010language; @shneidman2012language]. In the randomly selected clips, children were within hearing distance of other-directed speech for an average of  `r round(mean(quantity.rand.bychild$ods_mph),2)` minutes per hour. This large quantity of ODS is likely due to the fact that Tseltal children tend to live in households with more people compared to North American children [@shneidman2012language]. In our data, the presence of more speakers was associated with significantly more other-directed speech, both based on the number of individual voices present in the clip and on the number of people living in the household (for younger children). The presence of more speakers had no overall impact on the quantity of TCDS children experienced, but older children were more likely than younger children to hear TCDS when more speakers were present. These findings ring true with Brown's [-@brown2011cultural; -@brown2014interactional] claim that this Tseltal community is a non-child-centric; the presence of more people primarily increases talk amongst the other speakers (i.e., not to young children). But, as children become more sophisticated language users, they are more likely to participate in others' talk. However, given that an increase in the number of speakers is also likely associated with an increase in the amount of overlapping speech, we suggest that attention to ODS is unlikely to be the primary mechanism underlying the robustness of early vocal development in Tseltal. However, just because speech is hearable does not mean the children are attending to it. Follow-up work on the role of ODS in language development must better define what constitutes likely "listened to" speech by the child.

### Increased TCDS with age
Another possibility is that speakers more frequently address children who are more communicatively competent [i.e., increased TCDS with age, e.g.,@warlaumont2014social]. In their longitudinal study of Yucatec Mayan children, Shneidman and Goldin-Meadow [-@shneidman2012language] found that TCDS increased significantly with age, though most of the increase came from other children speaking to the target child. Their finding is consistent with other reports that Mayan children are more often cared for by their older siblings from later infancy onward [-@brown2014interactional; -@brown2011cultural]. In our data, there was no evidence for an overall increase in TCDS with age, neither from adult speakers nor from child speakers. This non-increase in TCDS with age may be due to the fact TCDS from other children was overall infrequent in our data, possibly because: (a) the children were relatively young and so spent much of their time with their mothers, (b) these particular children did not have many older siblings, and (c) in the daylong recording context more adults were present to talk to each other than would be typical in a short-format recording [as used in @shneidman2012language]. That aside, we conclude from these findings, that an increase in TCDS with age is also unlikely to explain the robust pattern of Tseltal vocal development.

### Learning during interactional bursts
A third possibility is that children learn effectively from short, routine language encounters. Bursty input appears to be the norm across a number of linguistic and interactive scales [e.g., @abney2017time; @blasiIPhuman], and experiment-based work suggests that children can benefit from massed presentation of new information [@schwab2016repetition]. We propose two mechanisms through which Tseltal children might capitalize on the distribution of speech input in their environment: (a) they experience most language input during routine activities and (b) they consolidate their language experiences during the downtime between interactive peaks. Neither of these mechanisms are proposed to be particular to Tseltal children, but might be employed to explain their efficient learning.

Tseltal children's linguistic input is not uniformly distributed over the day: children were most likely to encounter speech, particularly directed, contingent speech in the mornings and late afternoons, compared to midday. Older children, who are less often carried and were therefore more free to seek out interactions, showed these time of day effects most strongly, eliciting TCDS both in the mornings (when the entire household is present) and around midday (when many have dispersed for farming or other work). An afternoon dip in environmental speech, similar to what we report here, has been previously found for North American children's daylong recordings [@greenwood2011assessing; @soderstrom2013when]. The presence of a similar effect in Tseltal suggests that non-uniform distributions of linguistic input may be the norm for children in a variety of different cultural-economic contexts. Our findings here are the first to show that those time of day effects change with age in the first few years across a number of speech environment features (TCDS, TC--O transitions, O--TC transitions, and (marginally) ODS). These time of day effects likely arise from the activities that typically occur in the mornings and late afternoons---meal preparation and dining in particular---while short bouts of sleep could contribute to the afternoon dip [@soderstrom2013when]. That said, in data from North American children [@soderstrom2013when], the highest density speech input came during storytime and organized playtime (e.g., sing-alongs, painting), while mealtime was associated with less speech input. We expect that follow-up research tracking TCDS during activities in the Tseltal data will lead to very different conclusions: storytime and organized playtime are vanishingly rare in this non-child-centric community, and mealtime may represent a time of routine and rich linguistic experience. In both cases, however, the underlying association with activity (not hour) implies a role for action routines that help children optimally extract information about what words, agents, objects, and actions they will encounter and what they are expected to do in response [see, e.g., @bruner1983childs; @tamislemonda2018routine].

A more speculative possibility is that Tseltal children learn language on a natural input-consolidation cycle: the rarity of interactional peaks throughout the day may be complemented by an opportunity to consolidate new information. Sleep has been shown to benefit language learning tasks in both adults [@frost2017sleep; @mirkovic2016does] and children [@horvath2016daytime; @hupbach2009nap; @gomez2006naps], including word learning, phonotactic constraints, and syntactic structure. Our impression, both from the recordings and informal observations made during visits to the community, is that young Tseltal children frequently sleep for short periods throughout the day, particularly at younger ages when they spend much of their day wrapped within the shawl on their mother's back. Mayan children tend to pick their own resting times; there are no formalized "sleep" times, even at bedtime [@morelli1992cultural], and Mayan mothers take special care to keep infants in a calm and soothing environment in the first few months of life [e.g., @deleon2011language; @pye1986quiche]. There is little quantitative data on Mayan children's daytime and nighttime sleeping patterns, but one study estimates that Yucatec Mayan children between 0;0 and 2;0 sleep or rest nearly 15% of the time between morning and evening [@gaskins2000childrens], doing so at times that suited the child [@morelli1992cultural]. If Tseltal children's interactional peaks are bookended by short sleeping periods, it could contribute to efficient consolidation of new information encountered. How often Tseltal children sleep, how deeply, and how their sleeping patterns may relate to their linguistic development is an important topic for future research.

## Limitations and Future Work {#disc-limfut}
The current findings are based on a cross-sectional analysis of 600 annotated recording minutes, divided among only ten children. The data are limited mainly to verbal activity; we cannot analyze gaze and gestural behavior. We have also used overall vocal maturity as an index of language development, but further work should include receptive and productive measures of linguistic skill with both experiment- and questionnaire- based measures, as well as more in-depth analyses of children's spontaneous speech, building on past work [@brown2014interactional; @brown2014language; @brown2011cultural; @brown1998conversational].  In short, more and more diverse data are needed to enrich this initial description of Tseltal children's language environments. Importantly, the current analyses are based on a corpus that is still under active development: as new data are added, up-to-date versions of these analyses will be available with the current data and analysis scripts at: https://<retracted for review>.shinyapps.io/<retracted for review>/<!--https://middycasillas.shinyapps.io/Tseltal_Child_Language_Environment/-->.
<!--To fully understand the extent to which language learning mechanisms are shared across ethnolinguistically diverse samples we cannot simply continue to compare developmental benchmarks. More promising long-term approaches include a focus on how within-community differences and/or cross-linguistic differences for related languages drive variation in learning [e.g., @pye2017comparative; @weisleder2013talking]-->

## Conclusion {#disc-conclusion}
We estimate that, over the course of a waking day, Tseltal children under age 3;0 hear an average of `r round(mean(quantity.rand.bychild$tds_mph),2)` minutes of directed speech per hour, typically embedded in peak interactions that take up approximately `r round(mean(ttrGEpeaks.summary$pkdur.mph),2)` minutes per hour. Contingent turn taking tends to occur in sparsely distributed bursts often with a dip in the mid- to late-afternoon, particularly for older children. Tseltal children's vocal maturity is on track with prior estimates from populations in which child-directed speech is much more frequent, raising a challenge for future work: how do Tseltal children efficiently extract information from their linguistic environments? In our view, a promising avenue for continued research is to more closely investigate how directed speech is distributed over activities over the course of the day and to explore a possible input-consolidation cycle for language exposure in early development. By better understanding how Tseltal children learn language, we hope to help uncover how human language learning mechanisms are adaptive to the many thousands of ethnolinguistic environments in which children develop.

<!--Notes and bits of text to hold on to-->
<!--A large meta-analysis of children's sleep across non-industrial and industrialized cultures suggests that between 0;0 and 2;0, children take an average number of 1.7 naps with no differences across the countries compared [@galland2012normal]. At an estimated ~2 hours per nap and assuming an observation window of 12 hours (i.e., morning to evening, as in @gaskins2000childrens), the average proportion of time spent napping during the day is 28% for children from industrialized and non-industrial societies. That is, nearly two times as much sleep as the Mayan children are reported to get. Is that really the case? This needs checking up on :)-->

<!--Morelli and colleagues' -@morelli1992cultural investigation of children's sleep in a Mayan community in Guatemala, suggests that bed-sharing, on-demand breastfeeding, and no bedtime routine (i.e., children fall asleep when they are ready, typically in someone's arms) contributes to a stronger similarity between daytime and nighttime sleep in Mayan children compared to US children. If the Tseltal children are similar, we would expect to see more daytime sleeping (because of shorter night-->

<!--Work on children acquiring Tseltal in this same community has previously suggested somewhat later early vocal development. The in-depth study of two Tseltal children's early language production during longitudinal, short-format, at-home recordings showed that their first intelligible words emerged around 1;6 and their first verbs with an argument (one type of multi-word utterance) appeared at ages 1;10 and 2;1, repsectively [@brown1998childrens; @brown1998early; @brown1997isolating]. That said, low-frequency events, such as first words and first multi-word sequences, are less likely to be captured during short-format naturalistic recordings than they are during daylong recordings. Particularly considering that we include utterances manually selected as the child's most mature vocal activity over the entire day, it is unsurprising that children in the current analysis look slightly more precocious than those studied previously.-->

<!--One serious issue is how we define adult-like linguistic competence, especially within models in which we consider that adults still continue learning and that individual differences are rampant between adults in both linguistic knowledge and skill at every level, from phonetics to syntax to pragmatics, and of course vocabulary too. When we talk about language acquisition, especially cross-culturally, we have to be careful about what we think the "target" is and what are considered to be the developmental benchmarks children achieve. The focus recently has been on vocabulary acquisition, for some of the reasons outline above. However, vocabulary is a particularly literacy-centric view of language development. If we were to go back in time and set the seed of developmental language science in another culture, we might be much more concerned about the acquisition of kinship systems and other complex relational language, or in the ability to design elaborately indirect speech acts. Acquiring a language involves the mastery of a shockingly diverse array of skills and knowledge: not just linguistic symbols and systems, but also the infrastructure underlying their use (e.g., interactional skills), the cognitive-general skills supporting those systems. There's no reason _a priori_ to believe that every aspect of language acquisition is equally influenced by environmental features. For example, children's pointing frequency is influenced by the amount of pointing in their environment, but the age of pointing onset---the age which they first begin to point---appears unaffected by the frequency of pointing in their environment (REFS: Matthews, Liszkowski).-->

<!--Mayan work not yet mentioned:
de Leon, 1998??
Gaskins, 1990??
Gaskins, 1999??
Redfield & Villa Rojas, 1934??
Rogoff et al., 1993??-->

# Acknowledgements {#acknowledgements}
<Retracted for review>
<!--We thank and ackowledge Rebeca Guzmán López, Humbertina Gómez Pérez, Juan Méndez Girón, and Antun Gusman Osil, who made the collection and annotation of these recordings possible. We are also enormously grateful to the participating families and to the community at large for their support. Thanks also go to Maartje Weenink and Daphne Jansen for their help with manual clip selection and vocal maturity annotation. This work is supported by a NWO Veni Innovational Scheme grant (275-89-033) to MC and by an ERC Advanced Grant (269484 INTERACT) to SCL. This paper was written using the papaja library in RStudio [@R-papaja].-->

\newpage

# References {#refs}

```{r create_r-references}
r_refs(file = "Tseltal-CLE.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
