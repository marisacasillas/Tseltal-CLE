---
title             : "The title"
shorttitle        : "Title"

author: 
  - name          : "First Author"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Ernst-August Doelle"
    affiliation   : "1,2"

affiliation:
  - id            : "1"
    institution   : "Wilhelm-Wundt-University"
  - id            : "2"
    institution   : "Konstanz Business School"

author_note: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  Enter abstract here. Each new line herein must be indented, like this line.
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

figsintext        : no
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : yes
mask              : no

class             : "man"
output            : papaja::apa6_pdf
---

```{r load_packages, include = FALSE}
library("papaja")
```

```{r analysis_preferences}
# Seed for random number generation
set.seed(42)
```



# Methods
We report how we determined our sample size, all data exclusions (if any), all manipulations, and all measures in the study. <!-- 21-word solution (Simmons, Nelson & Simonsohn, 2012; retrieved from http://ssrn.com/abstract=2160588) -->

## Participants

## Material

## Procedure

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.


# Results

# Discussion


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```


## Target-child-to-other turn transitions (TC--O)
Contingent responses by or to the target child are likely to occur at moments in which the child and another speaker are attentionally aligned, and so the rate at which these responses occur is a partial index of children's experience with joint moments of high-quality linguistic evidence. We measured two types of contingent responses: target-child-to-other and other-to-target-child. We detect these contingent turn transitions based on utterance onset and offset times and the annotations of intended addressee for each non-target-child utterance (the solid and dashed lines connecting vocalizations in [Figure 6](#fig6)). If a child's vocalization is followed by a target-child-directed utterance within -`r allowed.overlap` msec to `r allowed.gap` msec after its end [@casillas2016turn; @hilbrink2015early], it is counted as a contingent response (i.e., a TC--O transition). We use the same idea to find other-to-target-child transitions  (i.e., a target-child-directed utterance followed by a target child vocalization with the same timing restrictions). In our analysis, each target child vocalization can have maximally one prompt and one response, and each target-child-directed utterance can maximally count once as a prompt and once as a response (e.g., in a TC--O--TC sequence, the 'O' is both a response and a prompt). These timing restrictions are based on prior studies of infant and young children's spontaneous turn taking [e.g., @bornstein2015mother; @broesch2016similarities; @casillas2016turn; @hilbrink2015early]. 
<!--We have slightly widened the timing margins from these studies for the current dataset because the prior estimates come from relatively short, intense bouts of interaction in American English middle-class parental contexts. Much prior work has used maximum gaps of similar or greater length as ours to detect verbal contingencies in  caregiver-child interaction [e.g., @bergelsoncasillas2019what; @kuchirko2018becoming; @romeo2018beyond; @warlaumont2014social; @vanegeren2001mother].-->

```{r interaction_prep, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# All segment info
all.segments <- all.rand.segments %>%
  mutate(sample = "random", sample_type = "random") %>%
  bind_rows(all.nonrand.segments) %>%
  arrange(aclew_child_id, segment)

# Number of speakers per clip
spkrs.per.seg.all <- all.data %>%
  filter(speaker != "CHI" &
           !(grepl("@", tier))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker))) %>%
  full_join(all.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(n_spkrs_clip = 0)) %>%
  arrange(aclew_child_id, segment)

# Turn transitions:
# other-to-child and child-to-other
turn.transitions <- tibble()
for (i in 1:nrow(all.segments)) {
  subdata <- all.data %>%
    filter(aclew_child_id == all.segments$aclew_child_id[i] &
             segment == all.segments$segment[i])
  c_utt <- subdata %>%
    filter(tier == "CHI")
  used.tm1s <- c()
  used.tp1s <- c()
  child <- all.segments$aclew_child_id[i]
  # Save turn-by-turn info
  chi.turn.info <- c_utt %>%
    select(aclew_child_id, segment, tier, speaker, start, stop) %>%
    mutate(tm1.tier = NA, tm1.speaker = NA, tm1.start = NA, tm1.stop = NA, tm1.val = NA,
           tp1.tier = NA, tp1.speaker = NA, tp1.start = NA, tp1.stop = NA, tp1.val = NA)
  for (j in 1:nrow(c_utt)) {
    # Find CHI-OTH transitions
    # "T" responses that start:
    #    - earliest: when the child starts vocalizing, with a limit on vocal overlap
    #    - latest: before the maximum allowed gap after the child's voc ends
    tp1.start <- max((c_utt$stop[j] - allowed.overlap), c_utt$start[j])
    tp1.stop <- c_utt$stop[j] + allowed.gap
    t.plus1 <- which(subdata$speaker != "CHI" &
                    (subdata$val == "T") &
                    subdata$start >= tp1.start &
                    subdata$start <= tp1.stop)
    # Find OTH-CHI transitions
    # "T" prompts that start:
    #    - earliest: within the maximum gap allowed before the child begins vocalizing
    #    - latest: when the child stops vocalizing, with a limit on vocal overlap
    tm1.start <- c_utt$start[j] - allowed.gap
    tm1.stop <- min((c_utt$start[j] + allowed.overlap), c_utt$stop[j])
    t.minus1 <- which(subdata$speaker != "CHI" &
                    (subdata$val == "T") &
                    subdata$stop <= tm1.stop &
                    subdata$stop >= tm1.start)
    if(length(t.plus1) > 0) {
      tp1.match <- 0
      for (turn in t.plus1) {
        # Each OTH turn can only be a response once 
        if (!(turn %in% used.tp1s) & tp1.match == 0) {
          used.tp1s <- c(used.tp1s, turn)
          chi.turn.info$tp1.tier[j] <- subdata$tier[turn]
          chi.turn.info$tp1.speaker[j] <- subdata$speaker[turn]
          chi.turn.info$tp1.start[j] <- subdata$start[turn]
          chi.turn.info$tp1.stop[j] <- subdata$stop[turn]
          chi.turn.info$tp1.val[j] <- subdata$val[turn]
          tp1.match <- 1
        }
      }
    }
    if(length(t.minus1) > 0) {
      tm1.match <- 0
      for (turn in t.minus1) {
        # Each OTH turn can only be a prompt once 
        if (!(turn %in% used.tm1s) & tm1.match == 0) {
          used.tm1s <- c(used.tm1s, turn)
          chi.turn.info$tm1.tier[j] <- subdata$tier[turn]
          chi.turn.info$tm1.speaker[j] <- subdata$speaker[turn]
          chi.turn.info$tm1.start[j] <- subdata$start[turn]
          chi.turn.info$tm1.stop[j] <- subdata$stop[turn]
          chi.turn.info$tm1.val[j] <- subdata$val[turn]
          tm1.match <- 1
        }
      }
    }
  }
  turn.transitions <- bind_rows(turn.transitions, chi.turn.info)
}

turn.transitions.overview.o_c <- turn.transitions %>%
  filter(!(is.na(tm1.val))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n.o_c.tts = n()) %>%
  full_join(all.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(n.o_c.tts = 0)) %>%
  arrange(aclew_child_id, segment) %>%
  mutate(duration = ifelse(grepl('extension', sample_type), 5,
                           ifelse(grepl('random', sample_type), 5, 1)))

turn.transitions.overview.c_o <- turn.transitions %>%
  filter(!(is.na(tp1.val))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n.c_o.tts = n()) %>%
  full_join(all.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(n.c_o.tts = 0)) %>%
  arrange(aclew_child_id, segment) %>%
  mutate(duration = ifelse(grepl('extension', sample_type), 5,
                           ifelse(grepl('random', sample_type), 5, 1)))

# Combine the turn-taking info into one table
turn.transitions.overview <- turn.transitions.overview.o_c %>%
  full_join(dplyr::select(turn.transitions.overview.c_o,
                          c("aclew_child_id", "segment", "n.c_o.tts")),
            by = c("aclew_child_id", "segment")) %>%
  mutate(n.o_c.tpm = n.o_c.tts/duration,
         n.c_o.tpm = n.c_o.tts/duration) %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  left_join(spkrs.per.seg.all, by = c("aclew_child_id", "segment",
                                      "sample", "sample_type")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName"))

# Summaries of turn taking by sample
turn.taking.by.sample <- turn.transitions.overview %>%
  group_by(sample) %>%
  summarise(mean.n.o_c.tpm = mean(n.o_c.tpm),
         median.n.o_c.tpm = median(n.o_c.tpm),
         min.n.o_c.tpm = min(n.o_c.tpm),
         max.n.o_c.tpm = max(n.o_c.tpm),
         mean.n.c_o.tpm = mean(n.c_o.tpm),
         median.n.c_o.tpm = median(n.c_o.tpm),
         min.n.c_o.tpm = min(n.c_o.tpm),
         max.n.c_o.tpm = max(n.c_o.tpm))
turn.taking.by.child.bysample <- turn.transitions.overview %>%
  group_by(aclew_child_id, sample) %>%
  summarise(mean.n.o_c.tpm = mean(n.o_c.tpm),
         median.n.o_c.tpm = median(n.o_c.tpm),
         min.n.o_c.tpm = min(n.o_c.tpm),
         max.n.o_c.tpm = max(n.o_c.tpm),
         mean.n.c_o.tpm = mean(n.c_o.tpm),
         median.n.c_o.tpm = median(n.c_o.tpm),
         min.n.c_o.tpm = min(n.c_o.tpm),
         max.n.c_o.tpm = max(n.c_o.tpm))

# Interactional sequences:
# continuous sequences only including target-child vocalization and
# target-child-directed talk
turn.sequences <- tibble()
for (i in 1:nrow(all.segments)) {
  # retrieve all the target child vocs and xds == T vocalizations
  subdata.tcds <- all.data %>%
    filter(aclew_child_id == all.segments$aclew_child_id[i] &
             segment == all.segments$segment[i] &
             grepl('xds@', tier) &
             val == "T") %>%
    mutate(uttid = paste0(speaker, start))
  subdata.chi <- all.data %>%
    filter(aclew_child_id == all.segments$aclew_child_id[i] &
             segment == all.segments$segment[i] &
             tier == "CHI") %>%
    mutate(uttid = paste0(speaker, start))
  subdata <- bind_rows(subdata.tcds, subdata.chi) %>%
    arrange(start)
  # work through each target child voc in the clip
  if (nrow(subdata) > 0) {
    if (nrow(subdata.chi) > 0) {
      chi.vocs <- mutate(subdata.chi,
          seq.num = rep(NA,nrow(subdata.chi)),
          seq.start = rep(NA,nrow(subdata.chi)),
          seq.start.spkr = rep(NA,nrow(subdata.chi)),
          seq.stop = rep(NA,nrow(subdata.chi)),
          seq.stop.spkr = rep(NA,nrow(subdata.chi)))
      seq.num <- 1
      for (j in 1:nrow(chi.vocs)) {
        curr.start <- chi.vocs$start[j]
        curr.stop <- chi.vocs$stop[j]
        curr.spk <- "CHI"
        curr.utt <- chi.vocs$uttid[j]
        # First check if this chi voc is already in a sequence. If so, skip it
        if (seq.num > 1) {
          prev.seq <- which(chi.vocs$seq.num == seq.num - 1)[1]
          prev.seq.start <- chi.vocs$seq.start[prev.seq]
          prev.seq.stop <- chi.vocs$seq.stop[prev.seq]
          if (curr.start >= prev.seq.start & curr.stop <= prev.seq.stop) {
            chi.vocs$seq.start[j] <- chi.vocs$seq.start[prev.seq]
            chi.vocs$seq.start.spkr[j] <- chi.vocs$seq.start.spkr[prev.seq]
            chi.vocs$seq.stop[j] <- chi.vocs$seq.stop[prev.seq]
            chi.vocs$seq.stop.spkr[j] <- chi.vocs$seq.stop.spkr[prev.seq]
            chi.vocs$seq.num[j] <- chi.vocs$seq.num[prev.seq]
            next
          }
        }
        # We start a loop to look for related utterances to the LEFT
        stop.looking.left <- FALSE
        # Look first for prior turns from that STOP
        #    - earliest: within the maximum gap allowed before the curr utt begins
        #    - latest: up to the limit on vocal overlap or the end of
        #              the curr utt (whichever comes first)
        while (stop.looking.left == FALSE) {
          candidate.vocs <- subdata %>%
            filter(uttid != curr.utt &
                     start <= curr.start &
                     stop >= curr.start - allowed.gap &
                     stop <= min(curr.stop, (curr.start + allowed.overlap))) %>%
            arrange(start)
          if (nrow(candidate.vocs) > 0) {
            # continue with the earliest (first occurring) candidate
            curr.start <- candidate.vocs$start[1]
            curr.stop <- candidate.vocs$stop[1]
            curr.spk <- candidate.vocs$speaker[1]
            curr.utt <- candidate.vocs$uttid[1]
          } else {
            stop.looking.left <- TRUE
          }
        }
        seq.start <- curr.start
        seq.start.spkr <- curr.spk

        # We start a loop to look for related utterances to the RIGHT
        curr.start <- chi.vocs$start[j]
        curr.stop <- chi.vocs$stop[j]
        curr.spk <- "CHI"
        stop.looking.right <- FALSE
        # Look first for turn transitions that START
        #    - earliest: within the allowed vocal overlap over the current utt,
        #              up to its start time (whichever comes later)
        #    - latest: before the maximum allowed gap after the curr utt ends
        while(stop.looking.right == FALSE) {
          candidate.vocs <- subdata %>%
            filter(uttid != curr.utt &
                     stop >= curr.stop &
                     start >= max(curr.start, (curr.stop - allowed.overlap)) &
                     start <= curr.stop + allowed.gap) %>%
            arrange(-stop)
          if (nrow(candidate.vocs) > 0) {
            # continue with the earliest (first occurring) candidate
            curr.start <- candidate.vocs$start[1]
            curr.stop <- candidate.vocs$stop[1]
            curr.spk <- candidate.vocs$speaker[1]
            curr.utt <- candidate.vocs$uttid[1]
          } else {
            stop.looking.right <- TRUE
          }
        }
        seq.stop <- curr.stop
        seq.stop.spkr <- curr.spk

        # Check if the "sequence" is actually just 1+ CHI utterances
        if (seq.start == chi.vocs$start[j] & seq.stop == chi.vocs$stop[j]) {
          chi.vocs$seq.stop[j] <-  0
          chi.vocs$seq.stop.spkr[j] <- "NONE"
          chi.vocs$seq.start[j] <- 0
          chi.vocs$seq.start.spkr[j] <- "NONE"
        } else if (length(unique(subset(subdata, start >= seq.start &
                                        stop <= seq.stop)$speaker)) == 1) {
          chi.vocs$seq.stop[j] <-  0
          chi.vocs$seq.stop.spkr[j] <- "NONE"
          chi.vocs$seq.start[j] <- 0
          chi.vocs$seq.start.spkr[j] <- "NONE"
        } else {
          chi.vocs$seq.stop[j] <- seq.stop
          chi.vocs$seq.stop.spkr[j] <- seq.stop.spkr
          chi.vocs$seq.start[j] <- seq.start
          chi.vocs$seq.start.spkr[j] <- seq.start.spkr
          # Write the sequence number
          chi.vocs$seq.num[j] <- seq.num
          seq.num <- seq.num + 1
        }
      }
      turn.sequences <- bind_rows(turn.sequences, chi.vocs)
    }
  }
}

# Sequence duration summary
turn.sequences <- turn.sequences %>%
  filter(!(is.na(seq.num))) %>%
  mutate(seq.dur = (seq.stop - seq.start)/60000)
turn.sequences.overview <- turn.sequences %>%
  group_by(aclew_child_id, sample, segment, seq.num, seq.start, seq.stop, seq.dur) %>%
  summarise(n_cvcs_seq = n()) %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  left_join(spkrs.per.seg.all, by = c("aclew_child_id", "segment", "sample")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName"))
turn.seq.by.sample <- turn.sequences.overview %>%
  group_by(sample) %>%
  summarise(mean.tsq_dur = mean(seq.dur),
            median.tsq_dur = median(seq.dur),
            min.tsq_dur = min(seq.dur),
            max.tsq_dur = max(seq.dur),
            mean.cvcs = mean(n_cvcs_seq),
            median.cvcs = median(n_cvcs_seq),
            min.cvcs = min(n_cvcs_seq),
            max.cvcs = max(n_cvcs_seq))
turn.seq.by.sample.by.child <- turn.sequences.overview %>%
  group_by(aclew_child_id, sample) %>%
  summarise(mean.tsq_dur = mean(seq.dur),
            median.tsq_dur = median(seq.dur),
            min.tsq_dur = min(seq.dur),
            max.tsq_dur = max(seq.dur),
            mean.cvcs = mean(n_cvcs_seq),
            median.cvcs = median(n_cvcs_seq),
            min.cvcs = min(n_cvcs_seq),
            max.cvcs = max(n_cvcs_seq))

# Delta of chi voc and TCDS minutes
cvc.ovc.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker == "CHI" & speaker == tier) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(cvc_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 5, cvc_min = 0)) %>%
  mutate(cvc_mph = (cvc_min/segment_dur)*60) %>%
  left_join(dplyr::select(tds.per.seg.rand, c("aclew_child_id", "segment", "tds_mph")),
            by = c("aclew_child_id", "segment")) %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  mutate(cvc.ovc.delta = cvc_mph-tds_mph,
         cvc.ovc.delta.norm = cvc.ovc.delta/(cvc_mph+tds_mph)) %>%
  left_join(spkrs.per.seg.all, by = c("aclew_child_id", "segment")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName")) %>%
  arrange(aclew_child_id, segment)

cvc.ovc.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker == "CHI" & speaker == tier) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(cvc_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = 5, cvc_min = 0)) %>%
  mutate(cvc_mph = (cvc_min/segment_dur)*60) %>%
  left_join(dplyr::select(tds.per.seg.nonrand, c("aclew_child_id", "segment", "tds_mph")),
            by = c("aclew_child_id", "segment")) %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  mutate(cvc.ovc.delta = cvc_mph-tds_mph,
         cvc.ovc.delta.norm = cvc.ovc.delta/(cvc_mph+tds_mph)) %>%
  left_join(spkrs.per.seg.all,
            by = c("aclew_child_id", "segment", "sample", "sample_type")) %>%
  left_join(dplyr::select(seg.info, c("aclew_id", "CodeName", "start.hr")),
            by = c("aclew_child_id" = "aclew_id", "segment" = "CodeName")) %>%
  arrange(aclew_child_id, segment)

# Subset the samples for analysis
turn.transitions.rand_and_tt <- filter(turn.transitions.overview,
                                       sample == "random" | sample == "turn-taking")
turn.sequences.rand_and_tt <- filter(turn.sequences.overview,
                                     sample == "random" | sample == "turn-taking")
cvc.ovc.per.seg.rand_and_tt <- bind_rows(mutate(cvc.ovc.per.seg.rand, sample = "random"),
                                         filter(cvc.ovc.per.seg.nonrand,
                                                sample == "turn-taking"))
cvc.ovc.per.seg.rand_and_tt.nonas <- filter(cvc.ovc.per.seg.rand_and_tt,
                                            !(is.na(cvc.ovc.delta.norm)))

## Prepare variables for modeling
turn.transitions.rand <- filter(turn.transitions.rand_and_tt, sample == "random")
turn.transitions.rand$child_sex <- as.factor(turn.transitions.rand$child_sex)
turn.transitions.rand$mat_ed <- as.factor(turn.transitions.rand$mat_ed)
nspkrs.m <- mean(turn.transitions.rand$n_spkrs_clip)
nspkrs.sd <- sd(turn.transitions.rand$n_spkrs_clip)
turn.transitions.rand <- turn.transitions.rand %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
turn.transitions.rand$stthr.tri <- factor(turn.transitions.rand$stthr.tri,
                                          levels = c("midday", "morning", "afternoon"))
turn.transitions.rand$stthr.tri.a <- factor(turn.transitions.rand$stthr.tri,
                                            levels = c("afternoon", "midday", "morning"))

turn.sequences.rand <- filter(turn.sequences.rand_and_tt, sample == "random")
turn.sequences.rand$child_sex <- as.factor(turn.sequences.rand$child_sex)
turn.sequences.rand$mat_ed <- as.factor(turn.sequences.rand$mat_ed)
nspkrs.m <- mean(turn.sequences.rand$n_spkrs_clip)
nspkrs.sd <- sd(turn.sequences.rand$n_spkrs_clip)
turn.sequences.rand <- turn.sequences.rand %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
turn.sequences.rand$stthr.tri <- factor(turn.sequences.rand$stthr.tri,
                                        levels = c("midday", "morning", "afternoon"))
turn.sequences.rand$stthr.tri.a <- factor(turn.sequences.rand$stthr.tri,
                                          levels = c("afternoon", "midday", "morning"))

cvc.ovc.per.seg.randnonas <- filter(cvc.ovc.per.seg.rand_and_tt.nonas, sample == "random")
cvc.ovc.per.seg.randnonas$child_sex <- as.factor(cvc.ovc.per.seg.randnonas$child_sex)
cvc.ovc.per.seg.randnonas$mat_ed <- as.factor(cvc.ovc.per.seg.randnonas$mat_ed)
nspkrs.m <- mean(turn.sequences.rand$n_spkrs_clip)
nspkrs.sd <- sd(turn.sequences.rand$n_spkrs_clip)
cvc.ovc.per.seg.randnonas <- cvc.ovc.per.seg.randnonas %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12)

cvc.ovc.per.seg.randnonas.bychild <- cvc.ovc.per.seg.randnonas %>%
  group_by(aclew_child_id) %>%
  summarise(mean.ratio = mean(cvc.ovc.delta.norm))

# tt clips
turn.transitions.tt <- filter(turn.transitions.rand_and_tt, sample == "turn-taking")
turn.transitions.tt$child_sex <- as.factor(turn.transitions.tt$child_sex)
turn.transitions.tt$mat_ed <- as.factor(turn.transitions.tt$mat_ed)
nspkrs.m <- mean(turn.transitions.tt$n_spkrs_clip)
nspkrs.sd <- sd(turn.transitions.tt$n_spkrs_clip)
turn.transitions.tt <- turn.transitions.tt %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
turn.transitions.tt$stthr.tri <- factor(turn.transitions.tt$stthr.tri,
                                        levels = c("midday", "morning", "afternoon"))
turn.transitions.tt$stthr.tri.a <- factor(turn.transitions.tt$stthr.tri,
                                          levels = c("afternoon", "midday", "morning"))

turn.sequences.tt <- filter(turn.sequences.rand_and_tt, sample == "turn-taking")
turn.sequences.tt$child_sex <- as.factor(turn.sequences.tt$child_sex)
turn.sequences.tt$mat_ed <- as.factor(turn.sequences.tt$mat_ed)
nspkrs.m <- mean(turn.sequences.tt$n_spkrs_clip)
nspkrs.sd <- sd(turn.sequences.tt$n_spkrs_clip)
turn.sequences.tt <- turn.sequences.tt %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
turn.sequences.tt$stthr.tri <- factor(turn.sequences.tt$stthr.tri,
                                      levels = c("midday", "morning", "afternoon"))
turn.sequences.tt$stthr.tri.a <- factor(turn.sequences.tt$stthr.tri,
                                        levels = c("afternoon", "midday", "morning"))

cvc.ovc.per.seg.ttnonas <- filter(cvc.ovc.per.seg.rand_and_tt.nonas,
                                  sample == "turn-taking")
cvc.ovc.per.seg.ttnonas$child_sex <- as.factor(cvc.ovc.per.seg.ttnonas$child_sex)
cvc.ovc.per.seg.ttnonas$mat_ed <- as.factor(cvc.ovc.per.seg.ttnonas$mat_ed)
nspkrs.m <- mean(cvc.ovc.per.seg.ttnonas$n_spkrs_clip)
nspkrs.sd <- sd(cvc.ovc.per.seg.ttnonas$n_spkrs_clip)
cvc.ovc.per.seg.ttnonas <- cvc.ovc.per.seg.ttnonas %>%
  mutate(
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
                              "none" = "none", "primary" = "primary",
                              "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-5", "primary" = "0-5",
                              "secondary" = "6+", "preparatory" = "6+"),
    motyr.std = ((mother_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12)

cvc.ovc.per.seg.ttnonas.bychild <- cvc.ovc.per.seg.ttnonas %>%
  group_by(aclew_child_id) %>%
  summarise(mean.ratio = mean(cvc.ovc.delta.norm))
```

```{r interaction_plots, message=FALSE, warning=FALSE, paged.print=FALSE}
# Graph the basic turn taking rate info
# CHI-OTH transitions per minute
chi.oth.tts.rand_and_tt <- ggplot(turn.transitions.rand_and_tt,
                          aes(x = age_mo_round, y = n.c_o.tpm, lty = sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, sample),
                   color = sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = sample, color = sample), method = "lm") +
  ylab("CHI-OTH tts/min") + xlab("")	+
  ggtitle("TC-O transitions") +
  scale_y_continuous(limits=c(0,30),
                     breaks=seq(0,30,5)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,30),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

# OTH-CHI transitions per minute
oth.chi.tts.rand_and_tt <- ggplot(turn.transitions.rand_and_tt,
                          aes(x = age_mo_round, y = n.o_c.tpm, lty = sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, sample),
                   color = sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = sample, color = sample), method = "lm") +
  ylab("OTH-CHI tts/min") + xlab("Child age (mo)")	+
  ggtitle("O-TC transitions") +
  scale_y_continuous(limits=c(0,30),
                     breaks=seq(0,30,5)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,30),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

# Graph the basic sequence duration info
# plot per-clip averages so it's consistent with the rest
turn.sequences.rand_and_tt.byclip <- turn.sequences.rand_and_tt %>%
  group_by(aclew_child_id, age_mo_round, sample, segment) %>%
  summarise(m.seqdur.sec = mean(seq.dur*60))
seq.dur.rand_and_tt <- ggplot(turn.sequences.rand_and_tt.byclip,
                          aes(x = age_mo_round, y = m.seqdur.sec, lty = sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, sample),
                   color = sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = sample, color = sample), method = "lm") +
  ylab("Seq. dur. (sec)") + xlab("")	+
  ggtitle("Sequence duration") +
  scale_y_continuous(limits=c(0,60),
                     breaks=seq(0,60,20)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,60),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))
```

```{r fig7, echo=FALSE, fig.cap="By-child estimates of target-child-to-other contingent responses (left), other-to-target-child contingent responses (middle), and the duration of interactional sequences (right). Each boxplot represents the variance across clips within the random (dark purple; solid) or turn taking (light green; dashed) samples for each child. Bands on the linear trends show 95% confidence intervals.", message=FALSE, warning=FALSE, fig.height=2}
grid.arrange(chi.oth.tts.rand_and_tt, oth.chi.tts.rand_and_tt,
             seq.dur.rand_and_tt, nrow=1, ncol=3)
```

```{r tc-ott_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## CHI-OTH tts/min random sample ####
c_o.tpm.random.distribution <- ggplot(turn.transitions.rand,
                            aes(round(n.c_o.tpm,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("TC-O transitions/min") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "c_o_tpm_random_distribution.png"),
       plot = c_o.tpm.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(turn.transitions.rand$n.c_o.tpm,0))^2
#mean(round(turn.transitions.rand$n.c_o.tpm,0))
# mean isn't much smaller than variance
# zero inflated
c_o.tpm.rand.zinb <- glmmTMB(round(n.c_o.tpm,0) ~
                               tchiyr.std +
                               stthr.tri +
                               hsz.std +
                               nsk.std +
                               tchiyr.std:stthr.tri +
                               tchiyr.std:hsz.std +
                               tchiyr.std:nsk.std +
                               (1|aclew_child_id),
                             data=turn.transitions.rand,
                             ziformula=~nsk.std,
                             family="nbinom1")
#c_o.tpm.rand.zinb.res = simulateResiduals(c_o.tpm.rand.zinb)
#plot(c_o.tpm.rand.zinb.res, rank = T) # (manually saved)
#summary(c_o.tpm.rand.zinb)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)  
#(Intercept)                    -0.1257     0.5037  -0.250   0.8029  
#tchiyr.std                      0.8867     0.6063   1.462   0.1436  
#stthr.trimorning                0.4825     0.4500   1.072   0.2836  
#stthr.triafternoon              0.3405     0.3993   0.853   0.3938  
#hsz.std                        -0.1728     0.4541  -0.381   0.7035  
#nsk.std                        -0.1769     0.1746  -1.014   0.3107  
#tchiyr.std:stthr.trimorning    -0.1398     0.4751  -0.294   0.7686  
#tchiyr.std:stthr.triafternoon  -1.0820     0.4443  -2.436   0.0149 *
#tchiyr.std:hsz.std              0.1109     0.5569   0.199   0.8421  
#tchiyr.std:nsk.std              0.5639     0.2270   2.484   0.0130 *
#---
#Zero-inflation model:
#            Estimate Std. Error z value Pr(>|z|)
#(Intercept)   -116.7    53056.2  -0.002    0.998
#nsk.std       -100.0    52343.8  -0.002    0.998
# save for reporting
c_o.tpm.rand.zinb.COEF.age.morn <-
  coef(summary(c_o.tpm.rand.zinb))[[1]]["tchiyr.std:stthr.trimorning",] 
c_o.tpm.rand.zinb.COEF.age.aft <-
  coef(summary(c_o.tpm.rand.zinb))[[1]]["tchiyr.std:stthr.triafternoon",] 
c_o.tpm.rand.zinb.COEF.age.nsk <-
  coef(summary(c_o.tpm.rand.zinb))[[1]]["tchiyr.std:nsk.std",]

# test the other two-way effects of time of day
c_o.tpm.rand.zinb.v2 <- glmmTMB(round(n.c_o.tpm,0) ~
                                  tchiyr.std +
                                  stthr.tri.a +
                                  hsz.std +
                                  nsk.std +
                                  tchiyr.std:stthr.tri.a +
                                  tchiyr.std:hsz.std +
                                  tchiyr.std:nsk.std +
                                  (1|aclew_child_id),
                                data=turn.transitions.rand,
                                ziformula=~nsk.std,
                                family="nbinom1")
#summary(c_o.tpm.rand.zinb.v2)
#stthr.tri.amidday              -0.3405     0.3993  -0.853   0.3938  
#stthr.tri.amorning              0.1420     0.3254   0.436   0.6626  
#tchiyr.std:stthr.tri.amidday    1.0820     0.4443   2.436   0.0149 *
#tchiyr.std:stthr.tri.amorning   0.9422     0.3746   2.515   0.0119 *
# save for reporting
c_o.tpm.rand.zinb.v2.COEF.aft.vs.morn <-
  coef(summary(c_o.tpm.rand.zinb.v2))[[1]]["stthr.tri.amorning",] 
c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn <-
  coef(summary(c_o.tpm.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",] 
c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd <-
  coef(summary(c_o.tpm.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amidday",] 

## CHI-OTH tts/min tt sample ####
c_o.tpm.tt.distribution <- ggplot(turn.transitions.tt,
                            aes(round(n.c_o.tpm,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("TC-O transitions/min") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "c_o_tpm_turntaking_distribution.png"),
       plot = c_o.tpm.tt.distribution,
       width = 8, height = 6, dpi = 300)
#ggplot(turn.transitions.tt, aes(round(n.c_o.tpm,0))) + geom_histogram()
#sd(round(turn.transitions.tt$n.c_o.tpm,0))^2
#mean(round(turn.transitions.tt$n.c_o.tpm,0))
# mean isn't much smaller than variance
# not zero-inflated (nature of sample)
c_o.tpm.tt.nb <- glmmTMB(round(n.c_o.tpm,0) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=turn.transitions.tt,
                         family="nbinom1")
#c_o.tpm.tt.nb.res = simulateResiduals(c_o.tpm.tt.nb)
#plot(c_o.tpm.tt.nb.res, rank = T) # (manually saved)
#summary(c_o.tpm.tt.nb)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    1.78448    0.28828   6.190 <0.0001 ***
#tchiyr.std                     0.11866    0.29273   0.405 0.6852    
#stthr.trimorning               0.05827    0.31932   0.182 0.8552    
#stthr.triafternoon             0.11001    0.26991   0.408 0.6836    
#hsz.std                       -0.03938    0.22998  -0.171 0.8640    
#nsk.std                       -0.21384    0.11634  -1.838 0.0661 .  
#tchiyr.std:stthr.trimorning   -0.03954    0.29729  -0.133 0.8942    
#tchiyr.std:stthr.triafternoon -0.18839    0.25152  -0.749 0.4539    
#tchiyr.std:hsz.std            -0.19196    0.28233  -0.680 0.4966    
#tchiyr.std:nsk.std             0.05446    0.13186   0.413 0.6796    
# save for reporting
c_o.tpm.tt.nb.COEF.nsk <-
  coef(summary(c_o.tpm.tt.nb))[[1]]["nsk.std",] 

# test the other two-way effects of time of day
c_o.tpm.tt.nb.v2 <- glmmTMB(round(n.c_o.tpm,0) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=turn.transitions.tt,
                            family="nbinom1")
#summary(c_o.tpm.tt.nb.v2)
#stthr.tri.amidday             -0.11002    0.26991  -0.408              0.6835    
#stthr.tri.amorning            -0.05176    0.24239  -0.214              0.8309    
#tchiyr.std:stthr.tri.amidday   0.18840    0.25152   0.749              0.4538    
#tchiyr.std:stthr.tri.amorning  0.14885    0.26612   0.559              0.5759    
# no results to save for reporting
```

```{r tc-ott_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## CHI-OTH tts/min random sample ####
c_o.tpm.rand.gaus <- glmmTMB(log(n.c_o.tpm+2) ~
                               tchiyr.std +
                               stthr.tri +
                               hsz.std +
                               nsk.std +
                               tchiyr.std:stthr.tri +
                               tchiyr.std:hsz.std +
                               tchiyr.std:nsk.std +
                               (1|aclew_child_id),
                             data=turn.transitions.rand)
#c_o.tpm.rand.gaus.res = simulateResiduals(c_o.tpm.rand.gaus)
#plot(c_o.tpm.rand.gaus.res, rank = T) # (manually saved)
#summary(c_o.tpm.rand.gaus)
#Conditional model:
#                               Estimate Std. Error z value           Pr(>|z|)    
#(Intercept)                    1.056534   0.135493   7.798 0.0000000000000063 ***
#tchiyr.std                     0.250150   0.157480   1.588            0.11218    
#stthr.trimorning               0.137954   0.116248   1.187            0.23534    
#stthr.triafternoon             0.013519   0.102405   0.132            0.89498    
#hsz.std                       -0.110842   0.135817  -0.816            0.41444    
#nsk.std                        0.087300   0.056058   1.557            0.11940    
#tchiyr.std:stthr.trimorning   -0.025362   0.125456  -0.202            0.83979    
#tchiyr.std:stthr.triafternoon -0.303130   0.111001  -2.731            0.00632 ** 
#tchiyr.std:hsz.std             0.002589   0.164390   0.016            0.98744    
#tchiyr.std:nsk.std             0.094462   0.070742   1.335            0.18178
# DIFFERENCES?
# broadly similar to z-i nb model; no age * nsk effect

# test the other two-way effects of time of day
c_o.tpm.rand.gaus.v2 <- glmmTMB(log(n.c_o.tpm+2) ~
                                  tchiyr.std +
                                  stthr.tri.a +
                                  hsz.std +
                                  nsk.std +
                                  tchiyr.std:stthr.tri.a +
                                  tchiyr.std:hsz.std +
                                  tchiyr.std:nsk.std +
                                  (1|aclew_child_id),
                                data=turn.transitions.rand)
#summary(c_o.tpm.rand.gaus.v2)
#stthr.tri.amidday             -0.013520   0.102406  -0.132 0.89496    
#stthr.tri.amorning             0.124433   0.100790   1.235 0.21699    
#tchiyr.std:stthr.tri.amidday   0.303131   0.111001   2.731 0.00632 ** 
#tchiyr.std:stthr.tri.amorning  0.277769   0.107167   2.592 0.00954 ** 
# DIFFERENCES
# very similar to z-i nb model


## CHI-OTH tts/min tt sample ####
c_o.tpm.tt.gaus <- glmmTMB(log(n.c_o.tpm+2) ~
                           tchiyr.std +
                           stthr.tri.a +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri.a +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=turn.transitions.tt)
#c_o.tpm.tt.gaus.res = simulateResiduals(c_o.tpm.tt.gaus)
#plot(c_o.tpm.tt.gaus.res, rank = T) # (manually saved)
#summary(c_o.tpm.tt.gaus)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    2.06738    0.20284  10.192 <0.0001 ***
#tchiyr.std                    -0.01995    0.22908  -0.087 0.9306    
#stthr.tri.amidday             -0.10853    0.20987  -0.517 0.6050    
#stthr.tri.amorning            -0.08067    0.20332  -0.397 0.6915    
#hsz.std                       -0.02492    0.20253  -0.123 0.9021    
#nsk.std                       -0.17907    0.09640  -1.857 0.0632 .  
#tchiyr.std:stthr.tri.amidday   0.11148    0.20262   0.550 0.5822    
#tchiyr.std:stthr.tri.amorning  0.09163    0.21556   0.425 0.6708    
#tchiyr.std:hsz.std            -0.16794    0.24828  -0.676 0.4988    
#tchiyr.std:nsk.std             0.09030    0.11495   0.786 0.4321  
# DIFFERENCES
# very similar to nb model

# test the other two-way effects of time of day
c_o.tpm.tt.gaus.v2 <- glmmTMB(log(n.c_o.tpm+2) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=turn.transitions.tt)
#summary(c_o.tpm.tt.gaus.v2)
#stthr.tri.amidday             -0.10853    0.20987  -0.517  0.6050    
#stthr.tri.amorning            -0.08067    0.20332  -0.397  0.6915    
#tchiyr.std:stthr.tri.amidday   0.11148    0.20262   0.550  0.5822    
#tchiyr.std:stthr.tri.amorning  0.09163    0.21556   0.425  0.6708    
# DIFFERENCES?
# very similar to nb model

# Write model results out for input to shiny
c_o.tpm.models <- bind_rows(
  broom.mixed::tidy(c_o.tpm.rand.zinb) %>%
    mutate(model = "c_o.tpm_random_z-inb"),
  broom.mixed::tidy(c_o.tpm.rand.zinb.v2) %>%
    mutate(model = "c_o.tpm_random_z-inb.v2"),
  broom.mixed::tidy(c_o.tpm.rand.gaus) %>%
    mutate(model = "c_o.tpm_random_log_gaus"),
  broom.mixed::tidy(c_o.tpm.rand.gaus.v2) %>%
    mutate(model = "c_o.tpm_random_log_gaus.v2"),
  broom.mixed::tidy(c_o.tpm.tt.nb) %>%
    mutate(model = "c_o.tpm_turntaking_nb"),
  broom.mixed::tidy(c_o.tpm.tt.nb.v2) %>%
    mutate(model = "c_o.tpm_turntaking_nb.v2"),
  broom.mixed::tidy(c_o.tpm.tt.gaus) %>%
    mutate(model = "c_o.tpm_turntaking_log_gaus"),
  broom.mixed::tidy(c_o.tpm.tt.gaus.v2) %>%
    mutate(model = "c_o.tpm_turntaking_log_gaus.v2"))
```

Other speakers responded contingently to the target children's vocalizations at an average rate of `r round(mean(turn.transitions.rand$n.c_o.tpm),2)` turn transitions per minute (median = `r round(median(turn.transitions.rand$n.c_o.tpm),2)`; range = `r round(min(turn.transitions.rand$n.c_o.tpm),2)`--`r round(max(turn.transitions.rand$n.c_o.tpm),2)`; [Figure 7](#fig7)). We modeled TC--O transitions per minute in the random clips with a zero-inflated negative binomial regression. The rate of contingent responses to target child vocalizations varied across the day by target child age: older children heard significantly more contingent responses around midday (B = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd[[1]],2)`, SD = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd[[2]],2)`, z = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd[[3]],2)`, p = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.midd[[4]],2)`) and in the morning (B = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn[[1]],2)`, SD = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn[[2]],2)`, z = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn[[3]],2)`, p = `r round(c_o.tpm.rand.zinb.v2.COEF.age.aft.vs.morn[[4]],2)`), compared to the afternoon, with no significant difference between morning and midday (p = `r round(c_o.tpm.rand.zinb.COEF.age.morn[[4]],2)`). Older target children also heard significantly more contingent responses then younger ones when there were more speakers present (B = `r round(c_o.tpm.rand.zinb.COEF.age.nsk[[1]],2)`, SD = `r round(c_o.tpm.rand.zinb.COEF.age.nsk[[2]],2)`, z = `r round(c_o.tpm.rand.zinb.COEF.age.nsk[[3]],2)`, p = `r round(c_o.tpm.rand.zinb.COEF.age.nsk[[4]],2)`). There were no further significant effects in the count or zero-inflation models.

```{r o-tctt_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## OTH-CHI tts/min random sample ####
o_c.tpm.random.distribution <- ggplot(turn.transitions.rand,
                            aes(round(n.o_c.tpm,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("O-TC transitions/min") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "o_c_tpm_random_distribution.png"),
       plot = o_c.tpm.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(turn.transitions.rand$n.o_c.tpm,0))^2
#mean(round(turn.transitions.rand$n.o_c.tpm,0))
# mean isn't much smaller than variance
# zero-inflated
o_c.tpm.rand.zinb <- glmmTMB(round(n.o_c.tpm,0) ~
                               tchiyr.std +
                               stthr.tri +
                               hsz.std +
                               nsk.std +
                               tchiyr.std:stthr.tri +
                               tchiyr.std:hsz.std +
                               tchiyr.std:nsk.std +
                               (1|aclew_child_id),
                             data=turn.transitions.rand,
                             ziformula=~nsk.std,
                             family="nbinom1")
#o_c.tpm.rand.zinb.res = simulateResiduals(o_c.tpm.rand.zinb)
#plot(o_c.tpm.rand.zinb.res, rank = T) # (saved manually)
#summary(o_c.tpm.rand.zinb)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)   
#(Intercept)                    -0.4586     0.5436  -0.844  0.39890   
#tchiyr.std                      1.1417     0.6570   1.738  0.08226 . 
#stthr.trimorning                0.3179     0.4878   0.652  0.51462   
#stthr.triafternoon              0.4948     0.4082   1.212  0.22542   
#hsz.std                        -0.2025     0.4947  -0.409  0.68226   
#nsk.std                        -0.1414     0.1784  -0.793  0.42796   
#tchiyr.std:stthr.trimorning    -0.1238     0.5059  -0.245  0.80671   
#tchiyr.std:stthr.triafternoon  -1.4569     0.4647  -3.135  0.00172 **
#tchiyr.std:hsz.std              0.1412     0.6070   0.233  0.81610   
#tchiyr.std:nsk.std              0.5175     0.2247   2.303  0.02130 * 
#---
#Zero-inflation model:
#            Estimate Std. Error z value Pr(>|z|)
#(Intercept)  -115.46   43943.60  -0.003    0.998
#nsk.std       -98.63   42142.48  -0.002    0.998
# save for reporting
o_c.tpm.rand.zinb.COEF.age <-
  coef(summary(o_c.tpm.rand.zinb))[[1]]["tchiyr.std",]
o_c.tpm.rand.zinb.COEF.age.morn <-
  coef(summary(o_c.tpm.rand.zinb))[[1]]["tchiyr.std:stthr.trimorning",]
o_c.tpm.rand.zinb.COEF.age.aft <-
  coef(summary(o_c.tpm.rand.zinb))[[1]]["tchiyr.std:stthr.triafternoon",]
o_c.tpm.rand.zinb.COEF.age.nsk <-
  coef(summary(o_c.tpm.rand.zinb))[[1]]["tchiyr.std:nsk.std",]

# test the other two-way effects of time of day
o_c.tpm.rand.zinb.v2 <- glmmTMB(round(n.o_c.tpm,0) ~
                                  tchiyr.std +
                                  stthr.tri.a +
                                  hsz.std +
                                  nsk.std +
                                  tchiyr.std:stthr.tri.a +
                                  tchiyr.std:hsz.std +
                                  tchiyr.std:nsk.std +
                                  (1|aclew_child_id),
                                data=turn.transitions.rand,
                                ziformula=~nsk.std,
                                family="nbinom1")
#summary(o_c.tpm.rand.zinb.v2)
#stthr.tri.amidday             -0.49479    0.40816  -1.212  0.22542   
#stthr.tri.amorning            -0.17693    0.36072  -0.490  0.62379   
#tchiyr.std:stthr.tri.amidday   1.45689    0.46472   3.135  0.00172 **
#tchiyr.std:stthr.tri.amorning  1.33312    0.41759   3.192  0.00141 **
# save for reporting
o_c.tpm.rand.zinb.v2.COEF.morn <-
  coef(summary(o_c.tpm.rand.zinb.v2))[[1]]["stthr.tri.amorning",]
o_c.tpm.rand.zinb.v2.COEF.age.morn <-
  coef(summary(o_c.tpm.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",]
o_c.tpm.rand.zinb.v2.COEF.age.midd <-
  coef(summary(o_c.tpm.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amidday",]

## OTH-CHI tts/min tt sample ####
o_c.tpm.tt.distribution <- ggplot(turn.transitions.tt,
                            aes(round(n.o_c.tpm,0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("O-TC transitions/min") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "o_c_tpm_turntaking_distribution.png"),
       plot = o_c.tpm.tt.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(turn.transitions.tt$n.o_c.tpm,0))^2
#mean(round(turn.transitions.tt$n.o_c.tpm,0))
# mean is much smaller than variance
# not really zero-inflated
o_c.tpm.tt.nb <- glmmTMB(round(n.o_c.tpm,0) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=turn.transitions.tt,
                         family="nbinom1")
#o_c.tpm.tt.nb.res = simulateResiduals(o_c.tpm.tt.nb)
#plot(o_c.tpm.tt.nb.res, rank = T) # (manually saved)
#summary(o_c.tpm.tt.nb)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    1.84121    0.29135   6.319 < 0.0001 ***
#tchiyr.std                     0.05962    0.29556   0.202 0.8401    
#stthr.trimorning              -0.04921    0.33317  -0.148 0.8826    
#stthr.triafternoon             0.02709    0.28235   0.096 0.9236    
#hsz.std                       -0.03631    0.23216  -0.156 0.8757    
#nsk.std                       -0.22871    0.12170  -1.879 0.0602 .  
#tchiyr.std:stthr.trimorning    0.12037    0.30574   0.394 0.6938    
#tchiyr.std:stthr.triafternoon -0.07718    0.26007  -0.297 0.7667    
#tchiyr.std:hsz.std            -0.18813    0.28410  -0.662 0.5078    
#tchiyr.std:nsk.std             0.08522    0.13646   0.624 0.5323
# save for reporting
o_c.tpm.tt.nb.COEF.nsk <-
  coef(summary(o_c.tpm.tt.nb))[[1]]["nsk.std",]

# test the other two-way effects of time of day
o_c.tpm.tt.nb.v2 <- glmmTMB(round(n.o_c.tpm,0) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=turn.transitions.tt,
                            family="nbinom1")
#summary(o_c.tpm.tt.nb.v2)
#stthr.tri.amidday             -0.02712    0.28236  -0.096             0.9235    
#stthr.tri.amorning            -0.07632    0.25647  -0.298             0.7660    
#tchiyr.std:stthr.tri.amidday   0.07718    0.26007   0.297             0.7666    
#tchiyr.std:stthr.tri.amorning  0.19755    0.27015   0.731             0.4646    
# no results to save for reporting
```

```{r o-tctt_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## OTH-CHI tts/min random sample ####
o_c.tpm.rand.gaus <- glmmTMB(log(n.o_c.tpm+2) ~
                               tchiyr.std +
                               stthr.tri +
                               hsz.std +
                               nsk.std +
                               tchiyr.std:stthr.tri +
                               tchiyr.std:hsz.std +
                               tchiyr.std:nsk.std +
                               (1|aclew_child_id),
                             data=turn.transitions.rand)
#o_c.tpm.rand.gaus.res = simulateResiduals(o_c.tpm.rand.gaus)
#plot(o_c.tpm.rand.gaus.res, rank = T) # (saved manually)
#summary(o_c.tpm.rand.gaus)
#Conditional model:
#                                 Estimate  Std. Error z value Pr(>|z|)    
#(Intercept)                    1.00641393  0.12448510   8.085 <0.0001 ***
#tchiyr.std                     0.22740872  0.14462973   1.572 0.11587    
#stthr.trimorning               0.10010749  0.10843729   0.923 0.35591    
#stthr.triafternoon             0.00009137  0.09549393   0.001 0.99924    
#hsz.std                       -0.11953003  0.12408216  -0.963 0.33539    
#nsk.std                        0.06939389  0.05214713   1.331 0.18328    
#tchiyr.std:stthr.trimorning   -0.01939578  0.11702461  -0.166 0.86836    
#tchiyr.std:stthr.triafternoon -0.28596439  0.10350542  -2.763 0.00573 ** 
#tchiyr.std:hsz.std            -0.02916843  0.15025795  -0.194 0.84608    
#tchiyr.std:nsk.std             0.07454357  0.06594419   1.130 0.25831 
# DIFFERENCES?
# broadly similar to z-i nb model, but with no age * nsk interaction

# test the other two-way effects of time of day
o_c.tpm.rand.gaus.v2 <- glmmTMB(log(n.o_c.tpm+2) ~
                                  tchiyr.std +
                                  stthr.tri.a +
                                  hsz.std +
                                  nsk.std +
                                  tchiyr.std:stthr.tri.a +
                                  tchiyr.std:hsz.std +
                                  tchiyr.std:nsk.std +
                                  (1|aclew_child_id),
                                data=turn.transitions.rand)
#summary(o_c.tpm.rand.gaus.v2)
#stthr.tri.amidday             -0.00009122  0.09549413  -0.001 0.99924    
#stthr.tri.amorning             0.10001752  0.09406177   1.063 0.28764    
#tchiyr.std:stthr.tri.amidday   0.28596268  0.10350565   2.763 0.00573 ** 
#tchiyr.std:stthr.tri.amorning  0.26656607  0.10003252   2.665 0.00770 ** 
# DIFFERENCES?
# very similar to z-i nb model

## OTH-CHI tts/min tt sample ####
o_c.tpm.tt.gaus <- glmmTMB(log(n.o_c.tpm+2) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:hsz.std +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=turn.transitions.tt)
#o_c.tpm.tt.gaus.res = simulateResiduals(o_c.tpm.tt.gaus)
#plot(o_c.tpm.tt.gaus.res, rank = T) # (manually saved)
#summary(o_c.tpm.tt.gaus)
#Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    2.007746   0.247768   8.103 <0.0001 ***
#tchiyr.std                     0.039817   0.246349   0.162 0.8716    
#stthr.trimorning              -0.091549   0.270425  -0.339 0.7350    
#stthr.triafternoon             0.035551   0.223546   0.159 0.8736    
#hsz.std                       -0.002974   0.208196  -0.014 0.9886    
#nsk.std                       -0.202931   0.102724  -1.975 0.0482 *  
#tchiyr.std:stthr.trimorning    0.166181   0.253668   0.655 0.5124    
#tchiyr.std:stthr.triafternoon -0.003735   0.213868  -0.017 0.9861    
#tchiyr.std:hsz.std            -0.131678   0.255391  -0.516 0.6061    
#tchiyr.std:nsk.std             0.083365   0.121167   0.688 0.4914
# DIFFERENCES?
# very similar to nb model

# test the other two-way effects of time of day
o_c.tpm.tt.gaus.v2 <- glmmTMB(log(n.o_c.tpm+2) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:hsz.std +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=turn.transitions.tt)
#summary(o_c.tpm.tt.gaus.v2)
#stthr.tri.amidday             -0.035550   0.223546  -0.159              0.8736    
#stthr.tri.amorning            -0.127097   0.215122  -0.591              0.5546    
#tchiyr.std:stthr.tri.amidday   0.003734   0.213868   0.017              0.9861    
#tchiyr.std:stthr.tri.amorning  0.169912   0.227402   0.747              0.4550    
# DIFFERENCES?
# very similar to nb model

# Write model results out for input to shiny
o_c.tpm.models <- bind_rows(
  broom.mixed::tidy(o_c.tpm.rand.zinb) %>%
    mutate(model = "o_c.tpm_random_z-inb"),
  broom.mixed::tidy(o_c.tpm.rand.zinb.v2) %>%
    mutate(model = "o_c.tpm_random_z-inb.v2"),
  broom.mixed::tidy(o_c.tpm.rand.gaus) %>%
    mutate(model = "o_c.tpm_random_log_gaus"),
  broom.mixed::tidy(o_c.tpm.rand.gaus.v2) %>%
    mutate(model = "o_c.tpm_random_log_gaus.v2"),
  broom.mixed::tidy(o_c.tpm.tt.nb) %>%
    mutate(model = "o_c.tpm_turntaking_nb"),
  broom.mixed::tidy(o_c.tpm.tt.nb.v2) %>%
    mutate(model = "o_c.tpm_turntaking_nb.v2"),
  broom.mixed::tidy(o_c.tpm.tt.gaus) %>%
    mutate(model = "o_c.tpm_turntaking_log_gaus"),
  broom.mixed::tidy(o_c.tpm.tt.gaus.v2) %>%
    mutate(model = "o_c.tpm_turntaking_log_gaus.v2"))
```

## Other-to-target-child turn transitions (O--TC)
The children in our sample responded contingently to others' target-child vocalizations at an average rate of `r round(mean(turn.transitions.rand$n.o_c.tpm),2)` turn transitions per minute (median = `r round(median(turn.transitions.rand$n.o_c.tpm),2)`; range = `r round(min(turn.transitions.rand$n.o_c.tpm),2)`--`r round(max(turn.transitions.rand$n.o_c.tpm),2)`; [Figure 7](#fig7)). We modeled O--TC transtions per minute in the random clips with a zero-inflated negative binomial regression. The rate at which target children responded contingently to others (O--TC turn transitions per minute) was similarly influenced by child age and time of day: older children responded contingently to others' utterances significantly more often around midday (B = `r round(o_c.tpm.rand.zinb.v2.COEF.age.midd[[1]],2)`, SD = `r round(o_c.tpm.rand.zinb.v2.COEF.age.midd[[2]],2)`, z = `r round(o_c.tpm.rand.zinb.v2.COEF.age.midd[[3]],2)`, p = `r round(o_c.tpm.rand.zinb.v2.COEF.age.midd[[4]],3)`) and in the morning (B = `r round(o_c.tpm.rand.zinb.v2.COEF.age.morn[[1]],2)`, SD = `r round(o_c.tpm.rand.zinb.v2.COEF.age.morn[[2]],2)`, z = `r round(o_c.tpm.rand.zinb.v2.COEF.age.morn[[3]],2)`, p = `r round(o_c.tpm.rand.zinb.v2.COEF.age.morn[[4]],3)`), compared to the afternoon, with no significant difference between morning and midday (p = `r round(o_c.tpm.rand.zinb.COEF.age.morn[[4]],2)`). Overall, older children responded to others' utterances at a marginally higher rate (B = `r round(o_c.tpm.rand.zinb.COEF.age[[1]],2)`, SD = `r round(o_c.tpm.rand.zinb.COEF.age[[2]],2)`, z = `r round(o_c.tpm.rand.zinb.COEF.age[[3]],2)`, p = `r round(o_c.tpm.rand.zinb.COEF.age[[4]],2)`). Older target children also gave significantly more contingent responses then younger ones when there were more speakers present (B = `r round(o_c.tpm.rand.zinb.COEF.age.nsk[[1]],2)`, SD = `r round(o_c.tpm.rand.zinb.COEF.age.nsk[[2]],2)`, z = `r round(o_c.tpm.rand.zinb.COEF.age.nsk[[3]],2)`, p = `r round(o_c.tpm.rand.zinb.COEF.age.nsk[[4]],2)`). There were no further significant effects in the count or zero-inflation models.

```{r seqdur_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## Sequence duration random sample ####
seqdur.random.distribution <- ggplot(turn.sequences.rand,
                            aes(round((seq.dur*60),0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("Sequence duration (sec)") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "seqdur_random_distribution.png"),
       plot = seqdur.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round((turn.sequences.rand$seq.dur*60),0))^2
#mean(round((turn.sequences.rand$seq.dur*60),0))
# mean is much smaller than variance
# non-zero values -- no zero inflation
turn.sequences.rand$uniq.segment <- paste0(turn.sequences.rand$aclew_child_id, "-",
                                          turn.sequences.rand$segment)
seqdur.sec.rand.nb <- glmmTMB(round((seq.dur*60),0) ~
                                tchiyr.std +
                                stthr.tri +
                                hsz.std +
                                nsk.std +
                                tchiyr.std:stthr.tri +
                                tchiyr.std:hsz.std +
                                tchiyr.std:nsk.std +
                                (1|uniq.segment) +
                                (1|aclew_child_id),
                              data=turn.sequences.rand,
                              family="nbinom1")
#seqdur.sec.rand.nb.res = simulateResiduals(seqdur.sec.rand.nb)
#plot(seqdur.sec.rand.nb.res, rank = T) # (manually saved)
#summary(seqdur.sec.rand.nb) # (no significant effects)
#Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                    2.216674   0.142451  15.561 <0.0001 ***
#tchiyr.std                     0.105663   0.193521   0.546 0.585    
#stthr.trimorning               0.136008   0.174476   0.780 0.436    
#stthr.triafternoon             0.128729   0.160016   0.804 0.421    
#hsz.std                        0.010461   0.083797   0.125 0.901    
#nsk.std                        0.006317   0.048557   0.130 0.896    
#tchiyr.std:stthr.trimorning    0.196619   0.188012   1.046 0.296    
#tchiyr.std:stthr.triafternoon  0.045138   0.176905   0.255 0.799    
#tchiyr.std:hsz.std             0.142867   0.113612   1.257 0.209    
#tchiyr.std:nsk.std            -0.032344   0.063522  -0.509 0.611 
# no results to save for reporting

# test the other two-way effects of time of day
seqdur.sec.rand.nb.v2 <- glmmTMB(round((seq.dur*60),0) ~
                                   tchiyr.std +
                                   stthr.tri.a +
                                   hsz.std +
                                   nsk.std +
                                   tchiyr.std:stthr.tri.a +
                                   tchiyr.std:hsz.std +
                                   tchiyr.std:nsk.std +
                                   (1|uniq.segment) +
                                   (1|aclew_child_id),
                                 data=turn.sequences.rand,
                                 family="nbinom1")
#summary(seqdur.sec.rand.nb.v2) # (no significant effects)
#stthr.tri.amidday             -0.128729   0.160016  -0.804  0.421    
#stthr.tri.amorning             0.007280   0.116200   0.063  0.950    
#tchiyr.std:stthr.tri.amidday  -0.045138   0.176905  -0.255  0.799    
#tchiyr.std:stthr.tri.amorning  0.151481   0.129067   1.174  0.241    
# no results to save for reporting

## Sequence duration tt sample ####
seqdur.tt.distribution <- ggplot(turn.sequences.tt,
                            aes(round((seq.dur*60),0))) +
  geom_histogram() +
  ylab("# of clips") +
  xlab ("Sequence duration (sec)") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "seqdur_turntaking_distribution.png"),
       plot = seqdur.tt.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round((turn.sequences.tt$seq.dur*60),0))^2
#mean(round((turn.sequences.tt$seq.dur*60),0))
# mean is much smaller than variance
# non-zero values
turn.sequences.tt$uniq.segment <- paste0(turn.sequences.tt$aclew_child_id, "-",
                                          turn.sequences.tt$segment)
seqdur.sec.tt.nb <- glmmTMB(round((seq.dur*60),0) ~
                                tchiyr.std +
                                stthr.tri +
                                hsz.std +
                                nsk.std +
                                tchiyr.std:stthr.tri +
                                tchiyr.std:hsz.std +
                                tchiyr.std:nsk.std +
                                (1|uniq.segment) +
                                (1|aclew_child_id),
                              data=turn.sequences.tt,
                              family="nbinom1")
#seqdur.sec.tt.nb.res = simulateResiduals(seqdur.sec.tt.nb)
#plot(seqdur.sec.tt.nb.res, rank = T) # (manually saved)
#summary(seqdur.sec.tt.nb)
#Conditional model:
#                              Estimate Std. Error z value  Pr(>|z|)    
#(Intercept)                    2.24687    0.13586  16.539  < 0.0001 ***
#tchiyr.std                    -0.18273    0.12115  -1.508  0.13149    
#stthr.trimorning               0.05915    0.16101   0.367  0.71336    
#stthr.triafternoon             0.37875    0.14522   2.608  0.00911 ** 
#hsz.std                       -0.17315    0.09966  -1.737  0.08233 .  
#nsk.std                       -0.01070    0.05785  -0.185  0.85333    
#tchiyr.std:stthr.trimorning   -0.02062    0.16977  -0.121  0.90331    
#tchiyr.std:stthr.triafternoon  0.01937    0.14365   0.135  0.89271    
#tchiyr.std:hsz.std            -0.17535    0.12841  -1.366  0.17207    
#tchiyr.std:nsk.std             0.03003    0.07884   0.381  0.70327
# save for reporting
seqdur.sec.tt.nb.COEF.morn <-
  coef(summary(seqdur.sec.tt.nb))[[1]]["stthr.trimorning",]
seqdur.sec.tt.nb.COEF.aft <-
  coef(summary(seqdur.sec.tt.nb))[[1]]["stthr.triafternoon",]
seqdur.sec.tt.nb.COEF.hsz <-
  coef(summary(seqdur.sec.tt.nb))[[1]]["hsz.std",]

# test the other two-way effects of time of day
seqdur.sec.tt.nb.v2 <- glmmTMB(round((seq.dur*60),0) ~
                                 tchiyr.std +
                                 stthr.tri.a +
                                 hsz.std +
                                 nsk.std +
                                 tchiyr.std:stthr.tri.a +
                                 tchiyr.std:hsz.std +
                                 tchiyr.std:nsk.std +
                                 (1|uniq.segment) +
                                 (1|aclew_child_id),
                               data=turn.sequences.tt,
                               family="nbinom1")
#summary(seqdur.sec.tt.nb.v2)
#stthr.tri.amidday             -0.37875    0.14522  -2.608              0.00911 ** 
#stthr.tri.amorning            -0.31960    0.15110  -2.115              0.03442 *  
#tchiyr.std:stthr.tri.amidday  -0.01937    0.14365  -0.135              0.89271    
#tchiyr.std:stthr.tri.amorning -0.04000    0.16605  -0.241              0.80965    
# save for reporting
seqdur.sec.tt.nb.v2.COEF.morn <-
  coef(summary(seqdur.sec.tt.nb.v2))[[1]]["stthr.tri.amorning",]
seqdur.sec.tt.nb.v2.COEF.age.morn <-
  coef(summary(seqdur.sec.tt.nb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",]
```

```{r seqdur_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## Sequence duration random sample ####
seqdur.sec.rand.gaus <- glmmTMB(log(seq.dur) ~
                                tchiyr.std +
                                stthr.tri +
                                hsz.std +
                                nsk.std +
                                tchiyr.std:stthr.tri +
                                tchiyr.std:hsz.std +
                                tchiyr.std:nsk.std +
                                (1|uniq.segment) +
                                (1|aclew_child_id),
                              data=turn.sequences.rand)
#seqdur.sec.rand.gaus.res = simulateResiduals(seqdur.sec.rand.gaus)
#plot(seqdur.sec.rand.gaus.res, rank = T) # (manually saved)
#summary(seqdur.sec.rand.gaus) # (no significant effects)
#Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                   -2.238598   0.179612 -12.464 <0.0001 ***
#tchiyr.std                     0.101763   0.247126   0.412 0.680    
#stthr.trimorning               0.079977   0.222088   0.360 0.719    
#stthr.triafternoon             0.132569   0.203187   0.652 0.514    
#hsz.std                        0.007682   0.107943   0.071 0.943    
#nsk.std                        0.010111   0.060352   0.168 0.867    
#tchiyr.std:stthr.trimorning    0.334872   0.241382   1.387 0.165    
#tchiyr.std:stthr.triafternoon  0.109382   0.223645   0.489 0.625    
#tchiyr.std:hsz.std             0.166068   0.144025   1.153 0.249    
#tchiyr.std:nsk.std            -0.059959   0.080566  -0.744 0.457
# DIFFERENCES?
# very similar to nb model

# test the other two-way effects of time of day
seqdur.sec.rand.gaus.v2 <- glmmTMB(log(seq.dur) ~
                                   tchiyr.std +
                                   stthr.tri.a +
                                   hsz.std +
                                   nsk.std +
                                   tchiyr.std:stthr.tri.a +
                                   tchiyr.std:hsz.std +
                                   tchiyr.std:nsk.std +
                                   (1|uniq.segment) +
                                   (1|aclew_child_id),
                                 data=turn.sequences.rand)
#summary(seqdur.sec.rand.gaus) # (no significant effects)
#stthr.tri.amidday             -0.132569   0.203187  -0.652  0.514    
#stthr.tri.amorning            -0.052592   0.146310  -0.359  0.719    
#tchiyr.std:stthr.tri.amidday  -0.109382   0.223645  -0.489  0.625    
#tchiyr.std:stthr.tri.amorning  0.225490   0.167873   1.343  0.179    
# DIFFERENCES?
# very similar to nb model


## Sequence duration tt sample ####
seqdur.sec.tt.gaus <- glmmTMB(log(seq.dur) ~
                                tchiyr.std +
                                stthr.tri +
                                hsz.std +
                                nsk.std +
                                tchiyr.std:stthr.tri +
                                tchiyr.std:hsz.std +
                                tchiyr.std:nsk.std +
                                (1|uniq.segment) +
                                (1|aclew_child_id),
                              data=turn.sequences.tt)
#seqdur.sec.tt.gaus.res = simulateResiduals(seqdur.sec.tt.gaus)
#plot(seqdur.sec.tt.gaus.res, rank = T) # (manually saved)
#summary(seqdur.sec.tt.gaus)
#Conditional model:
#                              Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                   -2.32810    0.15565 -14.957 <0.0001 ***
#tchiyr.std                    -0.20332    0.14515  -1.401 0.1613    
#stthr.trimorning               0.07604    0.19411   0.392 0.6953    
#stthr.triafternoon             0.57536    0.18525   3.106 0.0019 ** 
#hsz.std                       -0.23223    0.11533  -2.014 0.0441 *  
#nsk.std                       -0.02348    0.07391  -0.318 0.7507    
#tchiyr.std:stthr.trimorning    0.01534    0.20032   0.077 0.9390    
#tchiyr.std:stthr.triafternoon -0.01424    0.18700  -0.076 0.9393    
#tchiyr.std:hsz.std            -0.19712    0.14911  -1.322 0.1862    
#tchiyr.std:nsk.std             0.04998    0.10153   0.492 0.6226
# DIFFERENCES?
# broadly similar to nb model

# test the other two-way effects of time of day
seqdur.sec.tt.gaus.v2 <- glmmTMB(log(seq.dur) ~
                                 tchiyr.std +
                                 stthr.tri.a +
                                 hsz.std +
                                 nsk.std +
                                 tchiyr.std:stthr.tri.a +
                                 tchiyr.std:hsz.std +
                                 tchiyr.std:nsk.std +
                                 (1|uniq.segment) +
                                 (1|aclew_child_id),
                               data=turn.sequences.tt)
#summary(seqdur.sec.tt.gaus.v2)
#stthr.tri.amidday             -0.57536    0.18525  -3.106              0.0019 ** 
#stthr.tri.amorning            -0.49932    0.19388  -2.575              0.0100 *  
#tchiyr.std:stthr.tri.amidday   0.01424    0.18700   0.076              0.9393    
#tchiyr.std:stthr.tri.amorning  0.02958    0.21021   0.141              0.8881    
# DIFFERENCES?
# very similar to nb model

# Write model results out for input to shiny
seqdur.sec.models <- bind_rows(
  broom.mixed::tidy(seqdur.sec.rand.nb) %>%
    mutate(model = "seqdur.sec_random_nb"),
  broom.mixed::tidy(seqdur.sec.rand.nb.v2) %>%
    mutate(model = "seqdur.sec_random_nb.v2"),
  broom.mixed::tidy(seqdur.sec.rand.gaus) %>%
    mutate(model = "seqdur.sec_random_log_gaus"),
  broom.mixed::tidy(seqdur.sec.rand.gaus.v2) %>%
    mutate(model = "seqdur.sec_random_log_gaus.v2"),
  broom.mixed::tidy(seqdur.sec.tt.nb) %>%
    mutate(model = "seqdur.sec_turntaking_nb"),
  broom.mixed::tidy(seqdur.sec.tt.nb.v2) %>%
    mutate(model = "seqdur.sec_turntaking_nb.v2"),
  broom.mixed::tidy(seqdur.sec.tt.gaus) %>%
    mutate(model = "seqdur.sec_turntaking_log_gaus"),
  broom.mixed::tidy(seqdur.sec.tt.gaus.v2) %>%
    mutate(model = "seqdur.sec_turntaking_log_gaus.v2"))
```

## Sequence duration
We defined sequences of interaction as periods of contingent turn taking with at least one target child vocalization and one target-child-directed prompt or response from another speaker. To detect sequences of interaction, we used the same mechanism as before to detect contingent TC--O and O--TC transitions, but also allowed for speakers to continue speaking with multiple vocalizations in a row (e.g., TC--O--O--TC--OTH; [Figure 6](#fig6)). We bounded sequences by the earliest and latest vocalization for which there was no contingent prompt or response, respectively. In our analysis, each target child vocalization could only appear in one sequence (i.e., each sequence had a unique set of vocalizations). We modeled these sequence durations in the random clips with negative binomial regression alone (i.e., with no zero-inflation model). We detected `r nrow(turn.sequences.rand)` interactional sequences in the 90 randomly selected clips, with an average sequence duration of `r round(mean(turn.sequences.rand$seq.dur)*60,2)` seconds (median = `r round(median(turn.sequences.rand$seq.dur)*60,2)`; range = `r round(min(turn.sequences.rand$seq.dur)*60,2)`--`r round(max(turn.sequences.rand$seq.dur)*60,2)`; [Figure 7](#fig7)). The average number of child vocalizations within these sequences was `r round(mean(turn.sequences.rand$n_cvcs_seq),2)` (range = `r round(min(turn.sequences.rand$n_cvcs_seq),2)`--`r round(max(turn.sequences.rand$n_cvcs_seq),2)`; median = `r round(median(turn.sequences.rand$n_cvcs_seq),2)`). None of the predictors significantly impacted sequence duration (all _p_ $$\ge$$ `r round(min(coef(summary(seqdur.sec.rand.nb))[[1]][2:nrow(coef(summary(seqdur.sec.rand.nb))[[1]]),"Pr(>|z|)"]),2)`).

## Language experience in the turn-taking clips (including TCDS and ODS)
As expected, the high-quality turn-taking clips featured a much higher rate of contingent turn transitions: the average TC--O transition rate was `r round(mean(turn.transitions.tt$n.c_o.tpm),2)` transitions per minute (~5.5x the random sample rate; median = `r round(median(turn.transitions.tt$n.c_o.tpm),2)`; range = `r round(min(turn.transitions.tt$n.c_o.tpm),2)`--`r round(max(turn.transitions.tt$n.c_o.tpm),2)`) and the average O--TC rate was `r round(mean(turn.transitions.tt$n.o_c.tpm),2)` transitions per minute (~6.5x the random sample rate; median = `r round(median(turn.transitions.tt$n.o_c.tpm),2)`; range = `r round(min(turn.transitions.tt$n.o_c.tpm),2)`--`r round(max(turn.transitions.tt$n.o_c.tpm),2)`). The interactional sequences were also slightly longer on average: `r round(mean(turn.sequences.tt$seq.dur)*60,2)` seconds (~1.2x the random sample rate; median = `r round(median(turn.sequences.tt$seq.dur)*60,2)`; range = `r round(min(turn.sequences.tt$seq.dur)*60,2)`--`r round(max(turn.sequences.tt$seq.dur)*60,2)`). Crucially, children also heard much more TCDS in the turn-taking clips---`r round(mean(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)` min/hr (nearly 4x the random sample rate; median = `r round(median(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)`; range = `r round(min(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)`--`r round(max(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)`)---while also hearing less ODS---`r round(mean(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)` min/hr (nearly half the random sample rate; median = `r round(median(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)`; range = `r round(min(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)`--`r round(max(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)`).

We analyzed each of these speech environment measures with parallel models to those used for the random sample, though this time we did not include a zero-inflation model for TCDS, TC--O, and O--TC rates because, given the criteria for selecting a turn-taking clip, the child is never alone, and so there are no extra-zero cases. As a whole, children's speech environments appeared quite different when viewed through the lens of interactional peaks rather than randomly sampled clips ([Figures 3](#fig3), [5](#fig5), and [7](#fig7)), particularly with respect to time-of-day effects and the number of speakers present, which we focus on here. Full model outputs are available in the Supplementary Materials.

Time-of-day effects were consistently weaker or non-existent in the turn-taking sample. TCDS rates showed no time-of-day effects and no interaction between time-of-day and age, and ODS rates _did_ show a dip, but later in the day than what we saw in the random sample (i.e., afternoon, not midday; afternoon-vs.-midday: B = `r round(ods.tt.zinb.v2.COEF.aft.vs.midd[[1]],2)`, SD = `r round(ods.tt.zinb.v2.COEF.aft.vs.midd[[2]],2)`, z = `r round(ods.tt.zinb.v2.COEF.aft.vs.midd[[3]],2)`, p = `r round(ods.tt.zinb.v2.COEF.aft.vs.midd[[4]],2)`, afternoon-vs.-morning: B = `r round(ods.tt.zinb.v2.COEF.aft.vs.morn[[1]],2)`, SD = `r round(ods.tt.zinb.v2.COEF.aft.vs.morn[[2]],2)`, z = `r round(ods.tt.zinb.v2.COEF.aft.vs.morn[[3]],2)`, p < 0.01). Older children were also significantly more likely to hear ODS around midday compared to the morning (midday-vs.-morning: B = `r round(ods.tt.zinb.COEF.age.morn[[1]],2)`, SD = `r round(ods.tt.zinb.COEF.age.morn[[2]],2)`, z = `r round(ods.tt.zinb.COEF.age.morn[[3]],2)`, p = `r round(ods.tt.zinb.COEF.age.morn[[4]],2)`), but heard significantly less ODS overall than younger children (B = `r round(ods.tt.zinb.COEF.age[[1]],2)`, SD = `r round(ods.tt.zinb.COEF.age[[2]],2)`, z = `r round(ods.tt.zinb.COEF.age[[3]],2)`, p = `r round(ods.tt.zinb.COEF.age[[4]],2)`). There were no time-of-day effects at all on contingent response rates (TC--O and O--TC) in the turn-taking sample. However, running counter to this overall pattern, sequence duration in the turn-taking sample did show significant time-of-day effects not found in the random sample: sequences were significantly longer in the afternoon compared to morning and midday (afternoon-vs.-morning: B = `r round(seqdur.sec.tt.nb.v2.COEF.morn[[1]],2)`, SD = `r round(seqdur.sec.tt.nb.v2.COEF.morn[[2]],2)`, z = `r round(seqdur.sec.tt.nb.v2.COEF.morn[[3]],2)`, p = `r round(seqdur.sec.tt.nb.v2.COEF.morn[[4]],2)`; midday-vs.-afternoon: B = `r round(seqdur.sec.tt.nb.COEF.aft[[1]],2)`, SD = `r round(seqdur.sec.tt.nb.COEF.aft[[2]],2)`, z = `r round(seqdur.sec.tt.nb.COEF.aft[[3]],2)`, p = `r round(seqdur.sec.tt.nb.COEF.aft[[4]],2)`). 

Effects relating to the number of speakers present were also somewhat weaker in the turn-taking sample, though inconsistently. In the turn taking sample, none of TCDS min/hr, TC--O transitions/min, or O--TC transitions/min were significantly impacted by the number of speakers present. On the other hand, the number of speakers present was associated with significantly more ODS in both the random and turn-taking samples (random sample: B = `r round(ods.tt.zinb.COEF.nsk[[1]],2)`, SD = `r round(ods.tt.zinb.COEF.nsk[[2]],2)`, z = `r round(ods.tt.zinb.COEF.nsk[[3]],2)`, p < 0.001), suggesting that the number of speakers is a robust predictor of ODS quantity across different contexts.

### Peak minutes in the day
```{r peakmins_prep, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# get average overall turn transition rate
ttrate.all.avg.bychild <- turn.transitions %>%
  filter(grepl("tt", segment)) %>%
  replace_na(list(tm1.tier = 0, tp1.tier = 0)) %>%
  mutate(tm1.bin = ifelse(tm1.tier == 0, 0, 1),
         tp1.bin = ifelse(tp1.tier == 0, 0, 1)) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(oct.raw = sum(tm1.bin), cot.raw = sum(tp1.bin)) %>%
  mutate(segdur = ifelse(grepl('ext', segment), 5, 1)) %>%
  group_by(aclew_child_id) %>%
  summarise (alltts = sum(oct.raw + cot.raw), sampledur = sum(segdur)) %>%
  mutate(peakttrate = alltts/sampledur)
ttrate.all.avg <- mean(ttrate.all.avg.bychild$peakttrate)

# set up a table of tt onset times within the randomly sampled segments
tts.all.rand <- turn.transitions %>%
  filter(grepl("rand", segment)) %>%
  select(aclew_child_id, segment, tm1.stop, tp1.start)
rand.seg.starts <- seg.info %>%
  filter(grepl("rand", CodeName)) %>%
  select(aclew_id, CodeName, clipoffset.sec)
rand.seg.secs <- tibble()
for (i in 1:nrow(rand.seg.starts)) {
  seg.secs <- tibble(
    aclew_child_id = rand.seg.starts$aclew_id[i],
    segment = rand.seg.starts$CodeName[i],
    segoffset.sec = c(0:299), # seconds in a (5-min) random clip
    segtime.sec = seq(rand.seg.starts$clipoffset.sec[i],
                      (rand.seg.starts$clipoffset.sec[i] + 299), 1),
    bin.tt = 0
  )
  tts.all.rand.chi <- tts.all.rand %>%
    filter(aclew_child_id == rand.seg.starts$aclew_id[i],
           segment == rand.seg.starts$CodeName[i])
  # add in tm1s
  tts.all.rand.chi.tm1 <- tts.all.rand.chi$tm1.stop[!is.na(tts.all.rand.chi$tm1.stop)]
  if (length(tts.all.rand.chi.tm1) > 0) {
    tm1.onsets.sec <- tts.all.rand.chi.tm1/1000
    # REMINDER: example use of findInterval:
    # findInterval(c(2,5,7,8), c(4,5,6,8,9,10)) => [1] 0 2 3 4
    tt.idx <- findInterval(tm1.onsets.sec, seg.secs$segtime.sec)
    seg.secs$bin.tt[tt.idx] <- seg.secs$bin.tt[tt.idx] + 1
  }
  # add in tp1s
  tts.all.rand.chi.tp1 <- tts.all.rand.chi$tp1.start[!is.na(tts.all.rand.chi$tp1.start)]
  if (length(tts.all.rand.chi.tp1) > 0) {
    tp1.onsets.sec <- tts.all.rand.chi.tp1/1000
    tt.idx <- findInterval(tp1.onsets.sec, seg.secs$segtime.sec)
    seg.secs$bin.tt[tt.idx] <- seg.secs$bin.tt[tt.idx] + 1
  }
  rand.seg.secs <- bind_rows(rand.seg.secs, seg.secs)
}

# get average tt rates in 1-min windows
rand.window.tts <- rand.seg.secs %>%
  filter(segoffset.sec >= 59) %>%
  select(-bin.tt) %>%
  mutate(ttr.min = 0)
for (chi in unique(rand.seg.secs$aclew_child_id)) {
  for (seg in unique(rand.seg.secs$segment)) {
    for (minstart in c(1:241)) {
      rand.window.tts$ttr.min[which(rand.window.tts$aclew_child_id == chi &
                              rand.window.tts$segment == seg &
                              rand.window.tts$segoffset.sec == minstart+59-1)] <-
        sum(subset(rand.seg.secs, aclew_child_id == chi &
                     segment == seg)$bin.tt[(minstart:(minstart+59))])
    }
  }
}
rand.window.tts <- rand.window.tts %>%
  left_join(select(ttrate.all.avg.bychild, c(aclew_child_id, peakttrate))) %>%
  mutate(GE.chipeak = ifelse(ttr.min >= peakttrate, 1, 0),
         GE.allpeak = ifelse(ttr.min >= ttrate.all.avg, 1, 0))
write_csv(rand.window.tts,
          paste0(metadata.path, "ttr.random.1minwindow.csv"))

# calculate # seconds in "peak" tt rates and duration of peaks
ttrGEpeak.segs <- rand.window.tts %>%
  filter(GE.allpeak == 1)
ttrGEpeak.segs$prevpeak <- c(-1, ttrGEpeak.segs$segoffset.sec[1:nrow(ttrGEpeak.segs)-1])
ttrGEpeak.segs$newstreak <- ifelse(ttrGEpeak.segs$prevpeak ==
                                        (ttrGEpeak.segs$segoffset.sec - 1), 0, 1)
ttrGEpeak.segs <- select(ttrGEpeak.segs, -prevpeak)
ttrGEpeaks <- filter(ttrGEpeak.segs, newstreak == 1)
ttrGEpeaks$end.sec <- 0
for (i in 1:nrow(ttrGEpeaks)) {
  chi <- ttrGEpeaks$aclew_child_id[i]
  seg <- ttrGEpeaks$segment[i]
  start <- ttrGEpeaks$segoffset.sec[i]
  start.idx <- which(ttrGEpeak.segs$aclew_child_id == chi &
                       ttrGEpeak.segs$segment == seg &
                       ttrGEpeak.segs$segoffset.sec == start)
  newstreaks <- which(ttrGEpeak.segs$aclew_child_id == chi &
                        ttrGEpeak.segs$segment == seg &
                        ttrGEpeak.segs$segoffset.sec > start &
                        ttrGEpeak.segs$newstreak == 1)
  if (length(newstreaks) > 0) {
    end.sec <- ttrGEpeak.segs$segoffset.sec[newstreaks[1] - 1]
  } else {
    end.sec <- ttrGEpeak.segs$segoffset.sec[max(
      which(ttrGEpeak.segs$aclew_child_id == chi &
              ttrGEpeak.segs$segment == seg &
              ttrGEpeak.segs$segoffset.sec >= start))]
  }
  ttrGEpeaks$end.sec[i] <- end.sec + 1
}
ttrGEpeaks <- ttrGEpeaks %>%
  mutate(start.sec = segoffset.sec - 59,
         peak.dur = end.sec - start.sec)
ttrGEpeaks.summary <- ttrGEpeaks %>%
  group_by(aclew_child_id) %>%
  summarise(npeaks = n(),
            pkdur.mean = mean(peak.dur),
            pkdur.sum = sum(peak.dur),
            pkdur.mph = ((pkdur.sum/60)/45) * 60) %>% # (peak mns/45 poss mns) * 60 mn/hr
  # add back zero estimates for children with no tt peaks in the random data
  full_join(select(ptcp.info, aclew_child_id)) %>%
  replace_na(list(npeaks = 0, pkdur.mean = 0, pkdur.sum = 0, pkdur.mph = 0))

ttrGEpeak.segs.chi <- rand.window.tts %>%
  filter(GE.chipeak == 1)

avg.random.peak.durs <- ttrGEpeaks %>%
  group_by(aclew_child_id) %>%
  summarise(meandur = mean(peak.dur), 
            meddur = median(peak.dur))
```

```{r peakmins_plots, message=FALSE, warning=FALSE, paged.print=FALSE}
rand.window.tts <- rand.window.tts %>%
  mutate(endoffsetsec = segoffset.sec + 1,
         delta.allpeak = ttr.min - ttrate.all.avg) %>%
  left_join(ptcp.info)
write_csv(rand.window.tts, paste0(shiny.input.path, "random_window_tts.csv"))
ttr.random <- ggplot(rand.window.tts,
                          aes(x = as.factor(age_mo_round), y = ttr.min)) +
  geom_jitter(color = "gray80", size = 0.3) +
  geom_violin(color = "black", fill = "black") + 
  ylab("High-tt secs/min") + xlab("Age (months)")	+
  scale_y_continuous(limits=c(-1, round(max(rand.window.tts$ttr.min) + 5, -1)),
                     breaks=seq(0, round(max(rand.window.tts$ttr.min) + 5, -1), 10)) +
  coord_cartesian(ylim=c(0, round(max(rand.window.tts$ttr.min) + 5, -1))) +
  geom_hline(yintercept = ttrate.all.avg, color = "red") +
  geom_point(color = "red", size = 2.5, aes(y = peakttrate)) +
#  scale_color_manual(values = viridis(3)) +
#  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))
```

Having now established the interactional timing characteristics of the "high" turn-taking clips, we looked for similarly temporally contingent 1-minute sections of interaction in the random samples in order to estimate the number of high interactivity minutes in the whole day. To do this, we scanned each 60-second window (e.g., 0--60 sec, 1--61 sec, etc.) of each random clip and recorded the observed turn-transition rate. We then compared the resulting 1-minute transition rates to those typical for the high turn-taking sample.

In total, `r sum(ttrGEpeaks.summary$npeaks > 0)` of the 10 children showed at least one minute of their random sample that equaled or exceeded the combined average contingent transition rate (`r ttrate.all.avg` transitions/min), and `r length(unique(ttrGEpeak.segs.chi$aclew_child_id))` of the 10 children showed at least one minute equaling or exceeding their _own_ average turn transition rate from their turn-taking sample. Across the `r sum(ttrGEpeaks.summary$npeaks > 0)` children who did show turn-taking "peaks" in their random data, peak periods were relatively long, at an average of `r round(mean(avg.random.peak.durs$meandur),2)` seconds (median = `r round(median(avg.random.peak.durs$meandur),2)` seconds; range = `r round(min(avg.random.peak.durs$meandur),2)`--`r round(max(avg.random.peak.durs$meandur),2)` seconds). Overall, children spent an average of `r round(mean(ttrGEpeaks.summary$pkdur.mph),2)` minutes per hour (median = `r round(median(ttrGEpeaks.summary$pkdur.mph),2)`; range = `r round(min(ttrGEpeaks.summary$pkdur.mph),2)`--`r round(max(ttrGEpeaks.summary$pkdur.mph),2)`) in these peak interactions during the 45 scanned minutes. Assuming approximately `r waking.hours` waking hours [@hart1995meaningful], we therefore very roughly estimate that the average Tseltal child under 3;0 spends an average of `r mean(ttrGEpeaks.summary$pkdur.mph)*waking.hours` minutes (`r round((mean(ttrGEpeaks.summary$pkdur.mph)*waking.hours)/60,2)` hours) in high turn-taking, dyadic interaction during their day. Crucially, however, the range in the quantity of high turn-taking interaction varies enormously across children, starting at just a few minutes per day and topping out at more than `r max(ttrGEpeaks.summary$pkdur.mph)*waking.hours` minutes (`r round((max(ttrGEpeaks.summary$pkdur.mph)*waking.hours)/60,2)` hours) in our 10-child sample. Much more data, particularly from other Tseltal children in this age range, is required to get stable estimates for the typical quantity and variance in peak interactional minutes experienced in a waking day.


\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
